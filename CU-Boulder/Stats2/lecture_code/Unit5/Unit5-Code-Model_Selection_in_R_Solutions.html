<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Dr.&nbsp;Osita Onyejekwe">

<title>Model selection in R - Solutions</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Unit5-Code-Model_Selection_in_R_Solutions_files/libs/clipboard/clipboard.min.js"></script>
<script src="Unit5-Code-Model_Selection_in_R_Solutions_files/libs/quarto-html/quarto.js"></script>
<script src="Unit5-Code-Model_Selection_in_R_Solutions_files/libs/quarto-html/popper.min.js"></script>
<script src="Unit5-Code-Model_Selection_in_R_Solutions_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Unit5-Code-Model_Selection_in_R_Solutions_files/libs/quarto-html/anchor.min.js"></script>
<link href="Unit5-Code-Model_Selection_in_R_Solutions_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Unit5-Code-Model_Selection_in_R_Solutions_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Unit5-Code-Model_Selection_in_R_Solutions_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Unit5-Code-Model_Selection_in_R_Solutions_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Unit5-Code-Model_Selection_in_R_Solutions_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#aic-bic-and-adjusted-r2" id="toc-aic-bic-and-adjusted-r2" class="nav-link active" data-scroll-target="#aic-bic-and-adjusted-r2">AIC, BIC, and adjusted <span class="math inline">\(R^2\)</span></a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Model selection in R - Solutions</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Dr.&nbsp;Osita Onyejekwe </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<p>In this lesson, we will implement various model selection methods on real data in R.</p>
<p>Let’s use the <code>fabric</code> data to illustrate the implementation of model selection techniques. This dataset contains the acoustic absorption coefficients of 24 woven fabrics with different air gap distances (<span class="math inline">\(d=0,1,2,3cm\)</span>). There are four different possible response variables based on these air gap distances:</p>
<ol type="1">
<li><p><code>acoustic0</code>: air gap distance <span class="math inline">\(d=0 cm\)</span></p></li>
<li><p><strong><code>acoustic1</code>: air gap distance</strong> <span class="math inline">\(d=1 cm\)</span></p></li>
<li><p><code>acoustic2</code>: air gap distance <span class="math inline">\(d=2 cm\)</span></p></li>
<li><p><code>acoustic3</code>: air gap distance <span class="math inline">\(d=3 cm\)</span></p></li>
</ol>
<p>For simplicity, we’ll focus on <code>acoustic1</code>. The following predictors are given:</p>
<ol start="5" type="1">
<li><p><code>thickness</code>: the thickness of the woven fabric, in mm</p></li>
<li><p><code>diameter</code>: the diameter of the woven fabric, in mm</p></li>
<li><p><code>perforation</code>: perforation was measured as a percentage, and is related to the pore width and yarn width of the woven fabric</p></li>
<li><p><code>weight</code>: the weight of the woven fabric, measured in g/m^2</p></li>
<li><p><code>stiffness</code>: the weight of the woven fabric, measured in mN x cm</p></li>
<li><p><code>airPerm</code>: the air permeability of the woven fabric, measured in mm/s</p></li>
</ol>
<p>According to Tang, Kong, and Yan, “It has been found that the acoustic absorption properties” of a woven fabric are “mainly determined by the perforation ratio and air permeability.” The goal of this analysis is to see if other fabric properties can be vuseful in predicting the absorption coefficient with <span class="math inline">\(d = 1\)</span>, i.e., <code>acoustic1</code>. We’ll use several different model selection techniques to show how they are implemented and how they might differ from one another.</p>
<p>Source: X. Tang, D. Kong, X. Yan (2018). “Multiple Regression Analysis of a Woven Fabric Sound Absorber,” Textile Research Journal, <a href="https://doi.org/10.1177/0040517518758001" class="uri">https://doi.org/10.1177/0040517518758001</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Another way to read the data:</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co">#fabric = read.table("http://users.stat.ufl.edu/~winner/data/fabricsoundabsorb.csv", header = TRUE, sep = ",")</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RCurl) <span class="co">#a package that includes the function getURL(), which allows for reading data from github.</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>url <span class="ot">=</span> <span class="fu">getURL</span>(<span class="fu">paste0</span>(<span class="st">"https://raw.githubusercontent.com/bzaharatos/"</span>,</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"-Statistical-Modeling-for-Data-Science-Applications/"</span>,</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"master/Modern%20Regression%20Analysis%20/"</span>,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Datasets/fabricsoundabsorb.csv"</span>))</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>fabric <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="at">text =</span> url, <span class="at">sep =</span> <span class="st">","</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co">#names(hprice) = c("price", "area", "bath", "bed","fireplace","lot", "age","fireplace_yn")</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(fabric)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  sampleID thickness diameter perforation weight stiffness airPerm acoustic0
1        1     0.547    0.269        6.14    247    181.90   805.4     0.076
2        2     0.541    0.378        6.08    253     74.40   887.8     0.092
3        3     0.875    0.584        4.97    366     71.41   598.4     0.129
4        4     0.640    0.527        4.87    319    161.50   799.2     0.115
5        5     0.750    0.534        4.51    292    156.20   753.2     0.095
6        6     0.539    0.368        4.39    232    171.50   704.0     0.073
  acoustic1 acoustic2 acoustic3
1     0.330     0.413     0.313
2     0.339     0.347     0.261
3     0.455     0.411     0.316
4     0.433     0.427     0.321
5     0.362     0.382     0.273
6     0.371     0.422     0.312</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fabric)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    sampleID       thickness         diameter       perforation   
 Min.   : 1.00   Min.   :0.5260   Min.   :0.2200   Min.   :1.210  
 1st Qu.: 6.75   1st Qu.:0.6438   1st Qu.:0.3395   1st Qu.:2.460  
 Median :12.50   Median :0.7685   Median :0.4705   Median :3.110  
 Mean   :12.50   Mean   :0.7302   Mean   :0.4320   Mean   :3.378  
 3rd Qu.:18.25   3rd Qu.:0.8097   3rd Qu.:0.5340   3rd Qu.:4.195  
 Max.   :24.00   Max.   :0.9310   Max.   :0.5840   Max.   :6.140  
     weight        stiffness         airPerm        acoustic0     
 Min.   :228.0   Min.   : 49.60   Min.   :401.5   Min.   :0.0730  
 1st Qu.:251.8   1st Qu.: 81.91   1st Qu.:510.4   1st Qu.:0.0905  
 Median :303.5   Median :139.41   Median :600.6   Median :0.1120  
 Mean   :302.0   Mean   :134.81   Mean   :601.4   Mean   :0.1163  
 3rd Qu.:347.8   3rd Qu.:171.40   3rd Qu.:685.7   3rd Qu.:0.1355  
 Max.   :373.0   Max.   :275.56   Max.   :887.8   Max.   :0.1890  
   acoustic1        acoustic2        acoustic3     
 Min.   :0.3300   Min.   :0.3470   Min.   :0.2610  
 1st Qu.:0.4412   1st Qu.:0.4203   1st Qu.:0.3175  
 Median :0.4775   Median :0.4800   Median :0.3625  
 Mean   :0.4793   Mean   :0.4834   Mean   :0.3699  
 3rd Qu.:0.5420   3rd Qu.:0.5355   3rd Qu.:0.4148  
 Max.   :0.6170   Max.   :0.6260   Max.   :0.4830  </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrplot)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>col4 <span class="ot">=</span> <span class="fu">colorRampPalette</span>(<span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"darkgrey"</span>, <span class="st">"grey"</span>,<span class="st">"#CFB87C"</span>))</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(<span class="fu">cor</span>(fabric[<span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">7</span>,<span class="dv">9</span>)]), <span class="at">method =</span> <span class="st">"ellipse"</span>, <span class="at">col =</span> <span class="fu">col4</span>(<span class="dv">100</span>),  <span class="at">addCoef.col =</span> <span class="st">"black"</span>, <span class="at">tl.col =</span> <span class="st">"black"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Unit5-Code-Model_Selection_in_R_Solutions_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Let’s start with the full model, which uses <code>acoustic1</code> as the response and <code>thickness</code>, <code>diameter</code>, <code>perforation</code>, <code>weight</code>, <code>stiffness</code>, and <code>airPerm</code> as predictors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>lm_fabric <span class="ot">&lt;-</span> <span class="fu">lm</span>(acoustic1 <span class="sc">~</span> thickness <span class="sc">+</span> diameter <span class="sc">+</span> perforation <span class="sc">+</span> weight <span class="sc">+</span> stiffness <span class="sc">+</span> airPerm , <span class="at">data  =</span> fabric)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm_fabric)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = acoustic1 ~ thickness + diameter + perforation + 
    weight + stiffness + airPerm, data = fabric)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.062713 -0.021894 -0.002938  0.020573  0.065304 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  0.5858162  0.0896400   6.535 5.09e-06 ***
thickness   -0.0288504  0.1606300  -0.180   0.8596    
diameter    -0.1340331  0.1192525  -1.124   0.2767    
perforation -0.0215229  0.0128301  -1.678   0.1117    
weight       0.0008418  0.0004612   1.825   0.0856 .  
stiffness   -0.0002042  0.0001622  -1.258   0.2253    
airPerm     -0.0003019  0.0001228  -2.458   0.0250 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.03871 on 17 degrees of freedom
Multiple R-squared:  0.8393,    Adjusted R-squared:  0.7826 
F-statistic:  14.8 on 6 and 17 DF,  p-value: 6.511e-06</code></pre>
</div>
</div>
<p>Here, we see that several of the predictors have t-tests with high p-values (higher than the standard <span class="math inline">\(\alpha = 0.05\)</span>). Instead of just removing all of those, let’s perform backward selection, removing the predictor with the largest p-value greater than <span class="math inline">\(\alpha_0 = 0.15\)</span>, <code>thickness</code> in this case, and then refit the model. We can do this with the <code>update()</code> function. Remember that <span class="math inline">\(\alpha_0\)</span>, sometimes called the “p-to-remove”, is used as a cuttoff in backward selection, and if the goal is prediction, then <span class="math inline">\(0.15\)</span> or <span class="math inline">\(0.2\)</span> is thought to work well.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>lm_fabric <span class="ot">&lt;-</span> <span class="fu">update</span>(lm_fabric, .<span class="sc">~</span>. <span class="sc">-</span>thickness)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm_fabric)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = acoustic1 ~ diameter + perforation + weight + stiffness + 
    airPerm, data = fabric)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.061055 -0.024693 -0.003761  0.020839  0.064457 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  0.5766761  0.0717833   8.034 2.31e-07 ***
diameter    -0.1299283  0.1138523  -1.141   0.2687    
perforation -0.0211186  0.0122868  -1.719   0.1028    
weight       0.0007765  0.0002758   2.815   0.0115 *  
stiffness   -0.0001961  0.0001516  -1.293   0.2122    
airPerm     -0.0002959  0.0001150  -2.573   0.0192 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.03765 on 18 degrees of freedom
Multiple R-squared:  0.839, Adjusted R-squared:  0.7943 
F-statistic: 18.76 on 5 and 18 DF,  p-value: 1.416e-06</code></pre>
</div>
</div>
<p>Notice that our p-values have changed! For example, before, <code>weight</code> as not sigificant at the <span class="math inline">\(\alpha = 0.05\)</span> level and now it is. And, importantly, we still have p-values above <span class="math inline">\(\alpha_0 = 0.15\)</span>. So, let’s remove the predictor with the largest p-value, namely, <code>diameter</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>lm_fabric <span class="ot">&lt;-</span> <span class="fu">update</span>(lm_fabric, .<span class="sc">~</span>. <span class="sc">-</span>diameter)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm_fabric)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = acoustic1 ~ perforation + weight + stiffness + airPerm, 
    data = fabric)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.056134 -0.032975 -0.000806  0.025339  0.071500 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  0.6009065  0.0691148   8.694 4.76e-08 ***
perforation -0.0241498  0.0120914  -1.997  0.06032 .  
weight       0.0005408  0.0001842   2.935  0.00849 ** 
stiffness   -0.0001887  0.0001526  -1.236  0.23144    
airPerm     -0.0002958  0.0001159  -2.551  0.01950 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.03795 on 19 degrees of freedom
Multiple R-squared:  0.8274,    Adjusted R-squared:  0.791 
F-statistic: 22.77 on 4 and 19 DF,  p-value: 5.01e-07</code></pre>
</div>
</div>
<p>It looks like we have at least one more iteration, since <code>stiffness</code> has a p-value greater than <span class="math inline">\(\alpha_0\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>lm_fabric <span class="ot">&lt;-</span> <span class="fu">update</span>(lm_fabric, .<span class="sc">~</span>. <span class="sc">-</span>stiffness)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm_fabric)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = acoustic1 ~ perforation + weight + airPerm, data = fabric)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.074211 -0.025324  0.003821  0.020601  0.076329 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  0.6159414  0.0689289   8.936 2.03e-08 ***
perforation -0.0244787  0.0122470  -1.999   0.0594 .  
weight       0.0004294  0.0001628   2.638   0.0158 *  
airPerm     -0.0003053  0.0001172  -2.605   0.0169 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.03845 on 20 degrees of freedom
Multiple R-squared:  0.8135,    Adjusted R-squared:  0.7855 
F-statistic: 29.08 on 3 and 20 DF,  p-value: 1.717e-07</code></pre>
</div>
</div>
<p>Notice that each of our remaining predictors have a p-value less than <span class="math inline">\(\alpha_0 = 0.15\)</span>. This is the “best” model, according to backward selection. Of course, there’s nothing about backward selection that is consistent with statistical inference, so we should use this procedure with <strong>caution</strong>! The same is true for forward selection and other stepwise selection methods.</p>
<section id="aic-bic-and-adjusted-r2" class="level3">
<h3 class="anchored" data-anchor-id="aic-bic-and-adjusted-r2">AIC, BIC, and adjusted <span class="math inline">\(R^2\)</span></h3>
<p>Recall that AIC is defined as:</p>
<p><span class="math display">\[AIC\left(g\left(\mathbf{x}; \widehat{\boldsymbol\beta}\right) \right) = 2(p+1) + n\log(RSS/n).\]</span></p>
<p>We can use AIC (or BIC, or adjusted <span class="math inline">\(R^2\)</span>) to help us choose a “best” model. One way to do this would be:</p>
<ol type="1">
<li><p>Fit <em>all</em> simple linear regression models, and report the one with the lowest RSS. This is allowed because when the number of predictors is the same, RSS (and equivalently, <span class="math inline">\(R^2\)</span>) can be used to compare models.</p></li>
<li><p>Fit all two-predictor models, and report the one with the lowest RSS.</p></li>
<li><p>Continue this process: fit all <span class="math inline">\(k\)</span>-predictor models, and report the one with the lowest RSS.</p></li>
<li><p>At this point, we should have the “best” models (in terms of RSS) for all models of size <span class="math inline">\(k\)</span>, where <span class="math inline">\(k\)</span> ranges from <span class="math inline">\(1\)</span> to <span class="math inline">\(p\)</span>. We can no longer use RSS to compare across <em>these</em> models, since each is of a difference size. So, we use a criterion that takes into account the tradeoff between fit (RSS) and model size/complexity (<span class="math inline">\(p\)</span>).</p></li>
</ol>
<p>The <code>regsubsets()</code> function in the <code>leaps</code> library can help us streamline this process.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leaps)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>n <span class="ot">=</span> <span class="fu">dim</span>(fabric)[<span class="dv">1</span>]; </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>reg1 <span class="ot">=</span> <span class="fu">regsubsets</span>(acoustic1 <span class="sc">~</span> thickness <span class="sc">+</span> diameter <span class="sc">+</span> perforation <span class="sc">+</span> weight <span class="sc">+</span> stiffness <span class="sc">+</span> airPerm,</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> fabric)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>rs <span class="ot">=</span> <span class="fu">summary</span>(reg1)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>rs<span class="sc">$</span>which</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  (Intercept) thickness diameter perforation weight stiffness airPerm
1        TRUE     FALSE    FALSE       FALSE  FALSE     FALSE    TRUE
2        TRUE      TRUE    FALSE       FALSE  FALSE     FALSE    TRUE
3        TRUE     FALSE    FALSE        TRUE   TRUE     FALSE    TRUE
4        TRUE     FALSE    FALSE        TRUE   TRUE      TRUE    TRUE
5        TRUE     FALSE     TRUE        TRUE   TRUE      TRUE    TRUE
6        TRUE      TRUE     TRUE        TRUE   TRUE      TRUE    TRUE</code></pre>
</div>
</div>
<p>The table above provides the best model (in terms of RSS) of size <span class="math inline">\(k\)</span>, for <span class="math inline">\(k = 1,2,...,6\)</span>. For example, the best simple linear regression model is the model <code>acoustic1</code> = <span class="math inline">\(\widehat\beta_0 + \widehat\beta_1 \times\)</span> <code>airPerm</code>. Now, to compare these models with each other, we calculate AIC, and plot the AIC values as a function of model size.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>AIC <span class="ot">=</span> <span class="dv">2</span><span class="sc">*</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">7</span>) <span class="sc">+</span> n<span class="sc">*</span><span class="fu">log</span>(rs<span class="sc">$</span>rss<span class="sc">/</span> n)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(AIC <span class="sc">~</span> <span class="fu">I</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>), <span class="at">xlab =</span> <span class="st">"number of predictors"</span>, <span class="at">ylab =</span> <span class="st">"AIC"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Unit5-Code-Model_Selection_in_R_Solutions_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>In this plot, we see that the model of size <span class="math inline">\(k=3\)</span> has the lowest AIC. That means that our model selection procedure chosen: <code>acoustic1</code> = <span class="math inline">\(\widehat{\beta_0}\)</span> <span class="math inline">\(+\)</span> <span class="math inline">\(\widehat{\beta_1}\)</span> <span class="math inline">\(\times\)</span><code>perforation</code> <span class="math inline">\(+\)</span> <span class="math inline">\(\widehat{\beta_2}\)</span><span class="math inline">\(\times\)</span><code>weigh</code> <span class="math inline">\(+\)</span> <span class="math inline">\(\widehat{\beta_3}\)</span><span class="math inline">\(\times\)</span><code>airPerm</code>.</p>
<p>Interestingly, using</p>
<p><span class="math display">\[R_{a}^{2} = 1 - \frac { \frac {RSS} {(n-(p+1))} } { \frac {TSS} {(n-1)} }\]</span></p>
<p>we get a different model, namely the model with five predictors (<code>diameter</code>, <code>perforation</code>, <code>weight</code>, <code>stiffness</code>, <code>airPerm</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, rs<span class="sc">$</span>adjr2, <span class="at">xlab =</span> <span class="st">"numbetr of predictors"</span>  , <span class="at">ylab =</span> <span class="st">"adjusted R Squared"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Unit5-Code-Model_Selection_in_R_Solutions_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>And BIC, which is given as</p>
<p><span class="math display">\[BIC\left(g\left(\mathbf{x}; \widehat{\boldsymbol\beta}\right) \right) = (p+1)\log(n) -2\log L\left(\widehat{\boldsymbol\beta} \right),\]</span></p>
<p>chooses the same model as AIC.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>BIC <span class="ot">=</span> <span class="fu">log</span>(n)<span class="sc">*</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">7</span>) <span class="sc">+</span> n<span class="sc">*</span><span class="fu">log</span>(rs<span class="sc">$</span>rss<span class="sc">/</span>n) </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(BIC <span class="sc">~</span> <span class="fu">I</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>), <span class="at">xlab =</span> <span class="st">"number of predictors"</span>, <span class="at">ylab =</span> <span class="st">"BIC"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Unit5-Code-Model_Selection_in_R_Solutions_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Is there evidence of collinearity in the data using the full model? How about using the model chosen by AIC?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car) <span class="co">#for the vif() function</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>lm_fabric_full <span class="ot">=</span> <span class="fu">lm</span>(acoustic1 <span class="sc">~</span> thickness <span class="sc">+</span> diameter <span class="sc">+</span> perforation <span class="sc">+</span> weight <span class="sc">+</span> stiffness <span class="sc">+</span> airPerm, <span class="at">data =</span> fabric)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(lm_fabric_full)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  thickness    diameter perforation      weight   stiffness     airPerm 
   5.717772    2.990249    4.253145    8.217969    1.458591    4.285540 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kappa</span>(lm_fabric_full)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 12045.9</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(<span class="fu">model.matrix</span>(lm_fabric_full)[,<span class="sc">-</span><span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             thickness  diameter perforation      weight stiffness     airPerm
thickness    1.0000000 0.4577137 -0.39698942  0.78997738 0.2176814 -0.48123411
diameter     0.4577137 1.0000000  0.26253154  0.76666870 0.3832821  0.14997886
perforation -0.3969894 0.2625315  1.00000000  0.01141017 0.1414211  0.85896316
weight       0.7899774 0.7666687  0.01141017  1.00000000 0.4833248 -0.08765898
stiffness    0.2176814 0.3832821  0.14142111  0.48332484 1.0000000  0.10339666
airPerm     -0.4812341 0.1499789  0.85896316 -0.08765898 0.1033967  1.00000000</code></pre>
</div>
</div>
<p>For the full model, we see:</p>
<ol type="1">
<li><p>The VIF for the estimators associated with <code>thickness</code> and <code>weight</code> are in the “some evidence of collinearity” range (i.e., <span class="math inline">\(5 &lt; VIF &lt; 10\)</span>).</p></li>
<li><p>The condition number is very high (<span class="math inline">\(&gt;&gt; 30\)</span>), suggesting collinearity is an issue.</p></li>
<li><p>The correlation matrix for the predictors shows high pairwise correlations.</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>lm_fabric_aic <span class="ot">&lt;-</span> <span class="fu">lm</span>(acoustic1 <span class="sc">~</span> perforation <span class="sc">+</span> weight <span class="sc">+</span> airPerm , <span class="at">data =</span> fabric)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(lm_fabric_aic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>perforation      weight     airPerm 
   3.927635    1.037730    3.957534 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kappa</span>(lm_fabric_aic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4531.029</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(<span class="fu">model.matrix</span>(lm_fabric_aic)[,<span class="sc">-</span><span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            perforation      weight     airPerm
perforation  1.00000000  0.01141017  0.85896316
weight       0.01141017  1.00000000 -0.08765898
airPerm      0.85896316 -0.08765898  1.00000000</code></pre>
</div>
</div>
<p>For the full model, we see:</p>
<ol type="1">
<li><p>The VIF for the estimators are now below <span class="math inline">\(5\)</span>, which is not evidence of collinearity.</p></li>
<li><p>The condition number is still very high (<span class="math inline">\(&gt;&gt; 30\)</span>), suggesting collinearity is an issue.</p></li>
<li><p>The correlation matrix for the predictors shows high pairwise correlations. Specifically, <code>airPerm</code> and <code>perforation</code> are highly correlated. We might remove one and refit the model. (do on your own for practice).</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>lm_fabric_aic <span class="ot">&lt;-</span> <span class="fu">lm</span>(acoustic1 <span class="sc">~</span> perforation <span class="sc">+</span> weight  , <span class="at">data =</span> fabric)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(lm_fabric_aic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>perforation      weight 
    1.00013     1.00013 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kappa</span>(lm_fabric_aic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1677.848</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(<span class="fu">model.matrix</span>(lm_fabric_aic)[,<span class="sc">-</span><span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            perforation     weight
perforation  1.00000000 0.01141017
weight       0.01141017 1.00000000</code></pre>
</div>
</div>
<p><strong><em>REGULARIZATION</em></strong></p>
<p>PCA RIDGE LASSO STAT 5600 : STAT LEARNING</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>