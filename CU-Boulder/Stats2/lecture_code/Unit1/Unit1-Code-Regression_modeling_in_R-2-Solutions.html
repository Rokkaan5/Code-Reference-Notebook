<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Dr.&nbsp;Osita Onyejekwe">

<title>Regression modeling in R - a second pass (Solutions)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Unit1-Code-Regression_modeling_in_R-2-Solutions_files/libs/clipboard/clipboard.min.js"></script>
<script src="Unit1-Code-Regression_modeling_in_R-2-Solutions_files/libs/quarto-html/quarto.js"></script>
<script src="Unit1-Code-Regression_modeling_in_R-2-Solutions_files/libs/quarto-html/popper.min.js"></script>
<script src="Unit1-Code-Regression_modeling_in_R-2-Solutions_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Unit1-Code-Regression_modeling_in_R-2-Solutions_files/libs/quarto-html/anchor.min.js"></script>
<link href="Unit1-Code-Regression_modeling_in_R-2-Solutions_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Unit1-Code-Regression_modeling_in_R-2-Solutions_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Unit1-Code-Regression_modeling_in_R-2-Solutions_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Unit1-Code-Regression_modeling_in_R-2-Solutions_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Unit1-Code-Regression_modeling_in_R-2-Solutions_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#linear-regression-modeling" id="toc-linear-regression-modeling" class="nav-link active" data-scroll-target="#linear-regression-modeling">Linear regression modeling</a>
  <ul class="collapse">
  <li><a href="#sums-of-squares-and-r2-for-simple-linear-regression" id="toc-sums-of-squares-and-r2-for-simple-linear-regression" class="nav-link" data-scroll-target="#sums-of-squares-and-r2-for-simple-linear-regression">Sums of squares and <span class="math inline">\(R^2\)</span> for simple linear regression</a></li>
  </ul></li>
  <li><a href="#multiple-linear-regression" id="toc-multiple-linear-regression" class="nav-link" data-scroll-target="#multiple-linear-regression">Multiple linear regression</a>
  <ul class="collapse">
  <li><a href="#sums-of-squares-and-r2-for-multiple-linear-regression" id="toc-sums-of-squares-and-r2-for-multiple-linear-regression" class="nav-link" data-scroll-target="#sums-of-squares-and-r2-for-multiple-linear-regression">Sums of squares and <span class="math inline">\(R^2\)</span> for multiple linear regression</a></li>
  </ul></li>
  <li><a href="#non-identifiability-a-simulation" id="toc-non-identifiability-a-simulation" class="nav-link" data-scroll-target="#non-identifiability-a-simulation">Non-identifiability: a simulation</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Regression modeling in R - a second pass (Solutions)</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Dr.&nbsp;Osita Onyejekwe </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<p>The following dataset containts measurements related to the impact of three advertising medias on sales of a product, <span class="math inline">\(P\)</span>. The variables are:</p>
<ul>
<li><p><code>youtube</code>: the advertising budget allocated to YouTube. Measured in thousands of dollars;</p></li>
<li><p><code>facebook</code>: the advertising budget allocated to Facebook. Measured in thousands of dollars; and</p></li>
<li><p><code>newspaper</code>: the advertising budget allocated to a local newspaper. Measured in thousands of dollars.</p></li>
<li><p><code>sales</code>: the value in the <span class="math inline">\(i^{th}\)</span> row of the sales column is a measurement of the sales (in thousands of units) for product <span class="math inline">\(P\)</span> for company <span class="math inline">\(i\)</span>.</p></li>
</ul>
<p>The advertising data treat “a company selling product <span class="math inline">\(P\)</span>” as the statistical unit, and “all companies selling product <span class="math inline">\(P\)</span>” as the population. We assume that the <span class="math inline">\(n = 200\)</span> companies in the dataset were chosen at random from the population (a strong assumption!).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>marketing <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="fu">url</span>(<span class="st">"https://raw.githubusercontent.com/CUBuffs/Statistical-Learning-/main/Modern%20Regression%20Analysis/Datasets/marketing.txt"</span>), <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(marketing)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(marketing)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  youtube facebook newspaper sales
1  276.12    45.36     83.04 26.52
2   53.40    47.16     54.12 12.48
3   20.64    55.08     83.16 11.16
4  181.80    49.56     70.20 22.20
5  216.96    12.96     70.08 15.48
6   10.44    58.68     90.00  8.64</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">=</span> <span class="fu">dim</span>(marketing)[<span class="dv">1</span>]; p <span class="ot">=</span> <span class="fu">dim</span>(marketing)[<span class="dv">2</span>] <span class="sc">-</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that, before an analysis, one should explore the data. We did this in “Regression modeling in R - a first pass”.</p>
<section id="linear-regression-modeling" class="level2">
<h2 class="anchored" data-anchor-id="linear-regression-modeling">Linear regression modeling</h2>
<section id="sums-of-squares-and-r2-for-simple-linear-regression" class="level3">
<h3 class="anchored" data-anchor-id="sums-of-squares-and-r2-for-simple-linear-regression">Sums of squares and <span class="math inline">\(R^2\)</span> for simple linear regression</h3>
<p>First, let’s fit the same model that we fit in the previous notebook (but to the entire dataset, rather than just a training set). In addition to running a summary of the model (using <code>summary()</code>), we’ll also run an “analysis of variance”, using the <code>anova()</code> function. The analysis of variance decomposes the total variability (<span class="math inline">\(TSS\)</span>) into the explained variability (<span class="math inline">\(ESS\)</span>), and the residual/unexplained variability (<span class="math inline">\(RSS\)</span>). It also produces an “F-test” that we’ll learn how to interpret in the next module.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>lm_marketing <span class="ot">=</span> <span class="fu">lm</span>(sales <span class="sc">~</span> facebook, <span class="at">data =</span> marketing)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm_marketing)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = sales ~ facebook, data = marketing)

Residuals:
     Min       1Q   Median       3Q      Max 
-18.8766  -2.5589   0.9248   3.3330   9.8173 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 11.17397    0.67548  16.542   &lt;2e-16 ***
facebook     0.20250    0.02041   9.921   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 5.13 on 198 degrees of freedom
Multiple R-squared:  0.332, Adjusted R-squared:  0.3287 
F-statistic: 98.42 on 1 and 198 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(lm_marketing)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: sales
           Df Sum Sq Mean Sq F value    Pr(&gt;F)    
facebook    1 2590.1 2590.08  98.422 &lt; 2.2e-16 ***
Residuals 198 5210.6   26.32                      
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>From the output, we see that:</p>
<ul>
<li><span class="math inline">\(ESS \approx 2,590.1\)</span></li>
<li><span class="math inline">\(RSS \approx 5,210.6\)</span></li>
<li><span class="math inline">\(TSS \approx 2,590.1 + 5,210.6 = 7,800.7\)</span></li>
</ul>
<section id="computing-regression-quantities-by-hand" class="level4">
<h4 class="anchored" data-anchor-id="computing-regression-quantities-by-hand">Computing regression quantities “by hand”</h4>
<p>Let’s connect the <code>lm()</code> function output to the computations that we studied in a previous video.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>ess <span class="ot">=</span> <span class="fu">sum</span>((<span class="fu">fitted</span>(lm_marketing) <span class="sc">-</span> <span class="fu">mean</span>(marketing<span class="sc">$</span>sales))<span class="sc">^</span><span class="dv">2</span>); </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>rss <span class="ot">=</span> <span class="fu">sum</span>(<span class="fu">residuals</span>(lm_marketing)<span class="sc">^</span><span class="dv">2</span>);</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>tss <span class="ot">=</span> <span class="fu">with</span>(marketing, <span class="fu">sum</span>((sales <span class="sc">-</span> <span class="fu">mean</span>(sales))<span class="sc">^</span><span class="dv">2</span>)); </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>r2 <span class="ot">=</span> <span class="dv">1</span><span class="sc">-</span>rss<span class="sc">/</span>tss; </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">=</span> <span class="fu">sqrt</span>(rss<span class="sc">/</span>(n <span class="sc">-</span> p <span class="sc">-</span> <span class="dv">1</span>)); sigma</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5.15604</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">paste</span>(<span class="st">"The explained sum of squares is"</span>, <span class="fu">round</span>(ess,<span class="dv">2</span>), <span class="st">"."</span>),</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">paste</span>(<span class="st">"The residual sum of squares is "</span>, <span class="fu">round</span>(rss,<span class="dv">2</span>), <span class="st">"."</span>),</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">paste</span>(<span class="st">"The total sum of squares is "</span>, <span class="fu">round</span>(tss,<span class="dv">2</span>), <span class="st">"."</span>),</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">paste</span>(<span class="st">"The coefficient of determination is"</span>, <span class="fu">round</span>(r2,<span class="dv">2</span>), <span class="st">"."</span>),</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">paste</span>(<span class="st">"The estimate of the error standard deviation is"</span>, <span class="fu">round</span>(sigma,<span class="dv">2</span>), <span class="st">"."</span>),</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">sep =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>           )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The explained sum of squares is 2590.08 .
The residual sum of squares is  5210.61 .
The total sum of squares is  7800.69 .
The coefficient of determination is 0.33 .
The estimate of the error standard deviation is 5.16 .</code></pre>
</div>
</div>
<p>5.15603992489615</p>
<p>Note that you can extract these quantities from the <code>lm()</code> object:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">paste</span>(<span class="st">"Explained sum of squares:"</span>, <span class="fu">round</span>(<span class="fu">anova</span>(lm_marketing)[[<span class="dv">2</span>]][<span class="dv">1</span>],<span class="dv">2</span>)),</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste</span>(<span class="st">"Residual sum of squares:"</span>,<span class="fu">round</span>(<span class="fu">anova</span>(lm_marketing)[[<span class="dv">2</span>]][<span class="dv">2</span>],<span class="dv">2</span>)),</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste</span>(<span class="st">"Total sum of squares:"</span>,<span class="fu">round</span>(<span class="fu">anova</span>(lm_marketing)[[<span class="dv">2</span>]][<span class="dv">1</span>] <span class="sc">+</span> <span class="fu">anova</span>(lm_marketing)[[<span class="dv">2</span>]][<span class="dv">2</span>],<span class="dv">2</span>)),</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste</span>(<span class="st">"Coefficient of determination:"</span>,<span class="fu">round</span>(<span class="fu">summary</span>(lm_marketing)<span class="sc">$</span>r.squared,<span class="dv">2</span>)),</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">sep =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Explained sum of squares: 2590.08
Residual sum of squares: 5210.61
Total sum of squares: 7800.69
Coefficient of determination: 0.33</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="multiple-linear-regression" class="level2">
<h2 class="anchored" data-anchor-id="multiple-linear-regression">Multiple linear regression</h2>
<p>Now, let’s include the other predictors in our regression model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>lm_marketing_MLR <span class="ot">=</span> <span class="fu">lm</span>(sales <span class="sc">~</span> facebook <span class="sc">+</span> youtube <span class="sc">+</span> newspaper, <span class="at">data =</span> marketing)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm_marketing_MLR)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = sales ~ facebook + youtube + newspaper, data = marketing)

Residuals:
     Min       1Q   Median       3Q      Max 
-10.5932  -1.0690   0.2902   1.4272   3.3951 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  3.526667   0.374290   9.422   &lt;2e-16 ***
facebook     0.188530   0.008611  21.893   &lt;2e-16 ***
youtube      0.045765   0.001395  32.809   &lt;2e-16 ***
newspaper   -0.001037   0.005871  -0.177     0.86    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2.023 on 196 degrees of freedom
Multiple R-squared:  0.8972,    Adjusted R-squared:  0.8956 
F-statistic: 570.3 on 3 and 196 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>First, note that the intercept and <code>facebook</code> parameter estimates have changed. The reason for these changes is the fact that we’ve now introduced new variables that explain some variability in <code>sales</code>.</p>
<ul>
<li><p>If the model is correct, a company with no Facebook, YouTube, or newspaper advertising budget can expect to sell <span class="math inline">\(\widehat\beta_0 \times 1,000 \approx 3.53 \times 1,000 = 3,530\)</span> units of product <span class="math inline">\(P\)</span>. Notice that this is down from <span class="math inline">\(\approx 11,174\)</span> units in our previous simple linear regression model. Different models can have very different predictions and explanations, so it’s important to attempt to find a good model! We’ll focus more on the problem of model selection later in the course.</p></li>
<li><p>If the model is correct, then, for a <span class="math inline">\(\$1,000\)</span> increase in the Facebook advertising budget, a company can expect to sell roughly <span class="math inline">\(\widehat\beta_1 \times 1000 = 0.19 \times 1,000 = 190\)</span> more unts, on average, <em>adjusting for YouTube and newspaper advertising budgets.</em> The adjustment is important: what we mean here is that the YouTube and newspaper advertising budgets can be held at a constant value, and the <span class="math inline">\(190\)</span> unit change is the specific change associated with the Facebook advertising budget. (Similar interpretations can be made for <code>youtube</code> and <code>newspaper</code>.)</p></li>
<li><p>Recall the interpretation of “multiple R-squared”, <span class="math inline">\(R^2\)</span>: assuming the linear model is correct, <span class="math inline">\(R^2\)</span> is the proportion of observed variability in <code>sales</code> that can be explained by the linear regression model.</p>
<ul>
<li><p>For the simple linear regression model, <span class="math inline">\(R^2 \approx 0.33\)</span>. Assuming that the model is correct (but it likely isn’t!), only about <span class="math inline">\(33\%\)</span> of the variability in sales of <span class="math inline">\(P\)</span> can be explained by the Facebook advertising budget.</p></li>
<li><p>For the multiple linear regression model, <span class="math inline">\(R^2\)</span> increases sharply to <span class="math inline">\(0.90\)</span>. We should be caseful in comparing <span class="math inline">\(R^2\)</span> across models with a different number of predictors; <span class="math inline">\(R^2\)</span> will always increase when adding a predictor. What we’d really like to know is whether that increase is important enough to attribute to a real relationship between the added precitors and the response.</p></li>
<li><p>“Adjusted-<span class="math inline">\(R^2\)</span>”, which adjusts for the number of predictors in each model, is meant to compare models of different sizes. The sharp increase in the adjusted-<span class="math inline">\(R^2\)</span> suggests that adding <code>youtube</code> and <code>newspaper</code> did, in fact, explain significantly more of the variability. We’ll study the adjusted- <span class="math inline">\(R^2\)</span> more later in the course.</p></li>
</ul></li>
</ul>
<section id="sums-of-squares-and-r2-for-multiple-linear-regression" class="level3">
<h3 class="anchored" data-anchor-id="sums-of-squares-and-r2-for-multiple-linear-regression">Sums of squares and <span class="math inline">\(R^2\)</span> for multiple linear regression</h3>
<p>Note that we can compute the sums of squares for multiple linear regression in the same was as for simple linear regression.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(lm_marketing_MLR)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: sales
           Df Sum Sq Mean Sq   F value Pr(&gt;F)    
facebook    1 2590.1  2590.1  633.1235 &lt;2e-16 ***
youtube     1 4408.7  4408.7 1077.6574 &lt;2e-16 ***
newspaper   1    0.1     0.1    0.0312 0.8599    
Residuals 196  801.8     4.1                     
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>ess <span class="ot">=</span> <span class="fu">sum</span>((<span class="fu">fitted</span>(lm_marketing_MLR) <span class="sc">-</span> <span class="fu">mean</span>(marketing<span class="sc">$</span>sales))<span class="sc">^</span><span class="dv">2</span>); </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>rss <span class="ot">=</span> <span class="fu">sum</span>(<span class="fu">residuals</span>(lm_marketing_MLR)<span class="sc">^</span><span class="dv">2</span>);</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>tss <span class="ot">=</span> <span class="fu">with</span>(marketing, <span class="fu">sum</span>((sales <span class="sc">-</span> <span class="fu">mean</span>(sales))<span class="sc">^</span><span class="dv">2</span>)); </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>r2 <span class="ot">=</span> <span class="dv">1</span><span class="sc">-</span>rss<span class="sc">/</span>tss; </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">=</span> <span class="fu">sqrt</span>(rss<span class="sc">/</span>(n <span class="sc">-</span> p <span class="sc">-</span> <span class="dv">1</span>)); </span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">paste</span>(<span class="st">"The explained sum of squares is"</span>, <span class="fu">round</span>(ess,<span class="dv">2</span>), <span class="st">"."</span>),</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">paste</span>(<span class="st">"The residual sum of squares is "</span>, <span class="fu">round</span>(rss,<span class="dv">2</span>), <span class="st">"."</span>),</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">paste</span>(<span class="st">"The total sum of squares is "</span>, <span class="fu">round</span>(tss,<span class="dv">2</span>), <span class="st">"."</span>),</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>        <span class="fu">paste</span>(<span class="st">"The coefficient of determination is"</span>, <span class="fu">round</span>(r2,<span class="dv">2</span>), <span class="st">"."</span>),</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">paste</span>(<span class="st">"The estimate of the error standard deviation is"</span>, <span class="fu">round</span>(sigma,<span class="dv">2</span>), <span class="st">"."</span>),</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">sep =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>           )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The explained sum of squares is 6998.87 .
The residual sum of squares is  801.83 .
The total sum of squares is  7800.69 .
The coefficient of determination is 0.9 .
The estimate of the error standard deviation is 2.02 .</code></pre>
</div>
</div>
</section>
</section>
<section id="non-identifiability-a-simulation" class="level2">
<h2 class="anchored" data-anchor-id="non-identifiability-a-simulation">Non-identifiability: a simulation</h2>
<p>Recall that a linear regression model will have non-identifiable parameters when the matrix <span class="math inline">\(\left(X^TX\right)^{-1}\)</span> does not exist, where <span class="math inline">\(X\)</span> is the design matrix. <span class="math inline">\(\left(X^TX\right)^{-1}\)</span> does not exist when the columns of <span class="math inline">\(X\)</span> are linearly dependent.</p>
<p>Let’s simulate such a situation.</p>
<p><em>An aside: simulations are an invaluable tool in statistics and data science. In a simulation, we construct a dataset ourselves, rather than collect it from the world. In doing so, we know how the data were generated. With the simulated data (sometimes called “synthetic data”), we can fit various models - models that are correct, and models that are incorrect - and study how those models perform on data with known relationships.</em></p>
<p>Let’s start out by simulating data in the following way. Let <span class="math inline">\(Y_i = 2 + 3x_{i,1} + \varepsilon_i\)</span>, where <span class="math inline">\(\varepsilon_i \overset{iid}{\sim} N(0, 0.5^2)\)</span>, <span class="math inline">\(i = 1,...,n\)</span>, and <span class="math inline">\(n = 75\)</span>. We’ll generate the predictors, <span class="math inline">\(x_i\)</span> randomly from the interval <span class="math inline">\((0,1)\)</span>. This model will be identifiable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1989</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">=</span> <span class="dv">75</span>; beta0 <span class="ot">=</span> <span class="dv">2</span>; beta1 <span class="ot">=</span> <span class="dv">3</span>; sigma <span class="ot">=</span> <span class="fl">0.5</span>; e <span class="ot">=</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, sigma)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">=</span> <span class="fu">runif</span>(n, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> beta0 <span class="sc">+</span> beta1<span class="sc">*</span>x1 <span class="sc">+</span> e</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">x1 =</span> x1,<span class="at">y =</span> y)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> x1, <span class="at">y =</span> y)) <span class="sc">+</span> </span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Unit1-Code-Regression_modeling_in_R-2-Solutions_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Now that we’ve simulated the data, let’s fit a simple linear regression model to the data. We know that the model will be correct, because we know how the data were generated…we generated it!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>l <span class="ot">=</span> <span class="fu">lm</span>(y <span class="sc">~</span> x1, df)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(l)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x1, data = df)

Residuals:
     Min       1Q   Median       3Q      Max 
-1.20649 -0.35046 -0.04997  0.37729  1.03224 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   2.0192     0.1219   16.57   &lt;2e-16 ***
x1            2.8794     0.2126   13.54   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.5214 on 73 degrees of freedom
Multiple R-squared:  0.7154,    Adjusted R-squared:  0.7115 
F-statistic: 183.5 on 1 and 73 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>So far, there is nothing alarming in the summary output, because we’ve fit the correct linear model. Now, let’s add a second predictor, <span class="math inline">\(x_{i,2}\)</span>, such that <span class="math inline">\(x_{i,2} = 2x_{i,1}\)</span>, and <span class="math inline">\(Y_i = 2 + 3x_{i,1} + 2x_{i,2} + \varepsilon_i\)</span> (same assumptions on <span class="math inline">\(\varepsilon_i\)</span>). This model should be non-identifiable, since two columns in the design matrix will be a constant multiple of each other.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">=</span> x1<span class="sc">*</span><span class="dv">2</span>; beta2 <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> beta0 <span class="sc">+</span> beta1<span class="sc">*</span>x1 <span class="sc">+</span> beta2<span class="sc">*</span>x2 <span class="sc">+</span> e</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>x2 <span class="ot">=</span> x2</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>l_nonID <span class="ot">=</span> <span class="fu">lm</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2, <span class="at">data =</span> df)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(l_nonID)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x1 + x2, data = df)

Residuals:
     Min       1Q   Median       3Q      Max 
-1.20649 -0.35046 -0.04997  0.37729  1.03224 

Coefficients: (1 not defined because of singularities)
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   2.0192     0.1219   16.57   &lt;2e-16 ***
x1            2.8794     0.2126   13.54   &lt;2e-16 ***
x2                NA         NA      NA       NA    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.5214 on 73 degrees of freedom
Multiple R-squared:  0.7154,    Adjusted R-squared:  0.7115 
F-statistic: 183.5 on 1 and 73 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>Notice that the row of the cofficients table corresponding to <code>x2</code> is populated with <code>NA</code>. That is because the coefficient cannot be estimated due to non-identifiability.</p>
<p>The situation of “strict” non-identifiability is rare and easy to diagnose: if one column is a linear combination of others, it will show up in the coefficients table as <code>NA</code>. However, “near” non-identifiability, called <em>collinearity</em> or <em>multicollinearity</em>, is less rare, and a bit trickier to diagnose. Let’s simulate some collinear data. We’ll set <span class="math inline">\(x_3 = \gamma x_1\)</span>, where <span class="math inline">\(\gamma \overset{iid}{\sim}N(0,0.05^2)\)</span>. Then we’ll fit the model <span class="math inline">\(Y_i = \beta_0 + \beta_1x_{i,1} + \beta_2x_{i,3} + \varepsilon_i\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">88188</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>x3 <span class="ot">=</span> x1<span class="sc">*</span><span class="fu">rnorm</span>(n,<span class="dv">0</span>,<span class="fl">0.05</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>x3 <span class="ot">=</span> x3</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> beta0 <span class="sc">+</span> beta1<span class="sc">*</span>x1 <span class="sc">+</span> beta2<span class="sc">*</span>x3 <span class="sc">+</span> e</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>l_MC <span class="ot">=</span> <span class="fu">lm</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x3, <span class="at">data =</span> df)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(l_MC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x1 + x3, data = df)

Residuals:
     Min       1Q   Median       3Q      Max 
-1.20947 -0.34670 -0.00826  0.38816  1.00133 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   2.0175     0.1223  16.497   &lt;2e-16 ***
x1            2.8834     0.2133  13.516   &lt;2e-16 ***
x3           -1.5604     2.1481  -0.726     0.47    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.5231 on 72 degrees of freedom
Multiple R-squared:  0.7174,    Adjusted R-squared:  0.7096 
F-statistic: 91.41 on 2 and 72 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>Here, we notice that the coefficients table does not have any <code>NA</code> values. The reason for this is because, strictly speaking, the model is identifiable. However, there are problems with the fit. Notice that the estimate for <span class="math inline">\(\beta_2\)</span> is negative, but that the true <span class="math inline">\(\beta_2 = 2\)</span> is positive. This can easily happen with collinear data (for reasons that we will understand soon!), and is a sign that <code>x3</code> is a near constant multiple of <code>x1</code>.</p>
<p>Note that, if we were working with real data - data for which we didn’t know the data generating process - it wouldn’t necessarily be clear that that the sign of the estimate of the parameter is different from the true parameter. But, you may have reasons to believe that the sign is off, e.g., if you have good theoretical reasons to believe that <code>x3</code> and <code>y</code> ought to be positively correlated but the sign of the estimate is negative. There are other methods to diagnose and deal with collinear data, and we’ll look at some of them in a later lesson!</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>