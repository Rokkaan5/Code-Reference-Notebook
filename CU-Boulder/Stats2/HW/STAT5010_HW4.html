<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jasmine Kobayashi">

<title>STAT 5010: HW4</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="STAT5010_HW4_files/libs/clipboard/clipboard.min.js"></script>
<script src="STAT5010_HW4_files/libs/quarto-html/quarto.js"></script>
<script src="STAT5010_HW4_files/libs/quarto-html/popper.min.js"></script>
<script src="STAT5010_HW4_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="STAT5010_HW4_files/libs/quarto-html/anchor.min.js"></script>
<link href="STAT5010_HW4_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="STAT5010_HW4_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="STAT5010_HW4_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="STAT5010_HW4_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="STAT5010_HW4_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#a.-theoretical-problems" id="toc-a.-theoretical-problems" class="nav-link active" data-scroll-target="#a.-theoretical-problems">A. Theoretical Problems</a></li>
  <li><a href="#problem-a.1-causality-20-points" id="toc-problem-a.1-causality-20-points" class="nav-link" data-scroll-target="#problem-a.1-causality-20-points">Problem A.1 Causality (20 points)</a></li>
  <li><a href="#problem-a.2-causal-inference-and-ethics-20-points" id="toc-problem-a.2-causal-inference-and-ethics-20-points" class="nav-link" data-scroll-target="#problem-a.2-causal-inference-and-ethics-20-points">Problem A.2 Causal inference and ethics (20 Points)</a></li>
  <li><a href="#b.-computational-problems" id="toc-b.-computational-problems" class="nav-link" data-scroll-target="#b.-computational-problems">B. Computational Problems</a></li>
  <li><a href="#problem-b.1-extra-features-in-causal-models-include-or-not" id="toc-problem-b.1-extra-features-in-causal-models-include-or-not" class="nav-link" data-scroll-target="#problem-b.1-extra-features-in-causal-models-include-or-not">Problem B.1 Extra features in causal models: include or not?!</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">STAT 5010: HW4</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Jasmine Kobayashi </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<p><strong>See Canvas for HW #4 assignment due date</strong>. Complete all of the following problems. Ideally, the theoretical problems should be answered in a Markdown cell directly underneath the question. If you don’t know LaTex/Markdown, you may submit separate handwritten solutions to the theoretical problems. Please do not turn in messy work. Computational problems should be completed in this notebook (using the R kernel is preferred). Computational questions may require code, plots, analysis, interpretation, etc. Working in small groups is allowed, but it is important that you make an effort to master the material and hand in your own work.</p>
<section id="a.-theoretical-problems" class="level2">
<h2 class="anchored" data-anchor-id="a.-theoretical-problems">A. Theoretical Problems</h2>
</section>
<section id="problem-a.1-causality-20-points" class="level2">
<h2 class="anchored" data-anchor-id="problem-a.1-causality-20-points">Problem A.1 Causality (20 points)</h2>
<p><strong>Please answer the following three questions. Each answer should be clearly labeled, and a few sentences to a paragraph long.</strong></p>
<ol type="1">
<li><p>In your own words, describe the fundamental problem of causal inference. How is this problem related to the counterfactual definition of causality?</p></li>
<li><p>Describe the use of “close substitutes” as a solution to the fundamental problem of causal inference. How does this solve the problem?</p></li>
<li><p>What is the difference between a <em>deterministic</em> theory of causality and a <em>probabilistic</em> theory of causality?</p></li>
</ol>
<p><em>YOUR ANSWER HERE</em> 1. The fundamental problem of causal inference is that causal effect cannot be made directly because, while there are many potential outcomes that can come from an observed experimental or observational study only one of those can be observed for a given study. i.e.&nbsp;I think this means we can’t perfectly find out if something causes something (because there is usually the presence of other factors we can’t control.)</p>
<ol start="2" type="1">
<li></li>
<li>Deterministic theory causality is about the nature of causality where an effect follows from a cause. Probabilistic theory is about the nature of causality when the <em>existence</em> of a cause impacts the <strong><em>probability</em></strong> of an effect.</li>
</ol>
</section>
<section id="problem-a.2-causal-inference-and-ethics-20-points" class="level2">
<h2 class="anchored" data-anchor-id="problem-a.2-causal-inference-and-ethics-20-points">Problem A.2 Causal inference and ethics (20 Points)</h2>
<p>How we think about causality, and the statistical models that we use to learn about causal relationships, have ethical implications. The goal of this problem is to invite you to think through some of those issues and implications.</p>
<p>Statisticians, data scientists, researchers, etc., are not in agreement on the best ways to study and analyze important social problems, such as racial discrimination in the criminal justice system. Lily Hu, a PhD candidate in applied math and philosophy at Harvard, recently <a href="https://lpeproject.org/blog/law-liberation-and-causal-inference/">wrote</a> that disagreements about how to best study these problems “well illustrate how the nuts and bolts of causal inference…about the …‘effects of race’…feature a slurry of theoretical, empirical, and normative reasoning that is often displaced into debates about purely technical matters in methodology.”</p>
<p>Here are some resources that enter into or comment on this debate:</p>
<ol type="1">
<li><p><a href="https://statmodeling.stat.columbia.edu/2020/07/06/statistical-controversy-on-racial-bias-in-the-criminal-justice-system/">Statistical controversy on estimating racial bias in the criminal justice system</a></p></li>
<li><p><a href="https://dcknox.github.io/files/KnoxLoweMummolo_PostTreatmentSelectionPolicing.pdf">Can Racial Bias in Policing Be Credibly Estimated Using Data Contaminated by Post-Treatment Selection?</a></p></li>
<li><p><a href="https://5harad.com/papers/post-treatment-bias.pdf">A Causal Framework for Observational Studies of Discrimination</a></p></li>
</ol>
<p><strong>Please read Lily Hu’s Boston Review <a href="https://www.bostonreview.net/articles/race-policing-and-the-limits-of-social-science/">article</a> and Andrew Gelman’s blog post <a href="https://statmodeling.stat.columbia.edu/2020/07/06/statistical-controversy-on-racial-bias-in-the-criminal-justice-system/">“Statistical controversy on estimating racial bias in the criminal justice system”</a> (and feel free to continue on with the other two papers!) to familiarize yourself with some of the issues in this debate. Then, write a short essay (250-500 words) summarizing this debate. Some important items to consider:</strong></p>
<ol type="1">
<li><p>How does the “fundamental problem of causal inference” present itself in these discussions?</p></li>
<li><p>What are some “possible distortionary effect[s] of using arrest data from administrative police records to measure causal effects of race”? (See Lily Hu’s blog post for this quote.)</p></li>
<li><p>What role do assumptions (both statistical and otherwise) play in this debate? To what extent are assumptions made by different researchers falsifiable?</p></li>
</ol>
<p><em>YOUR ANSWER HERE</em></p>
<p>So the debate appears to be centered on whether determination of racial (or gender, etc.) bias and policing is something that can be determined and evaluated from statistical analysis (with data from the social masses). Or perhaps even more foundationally, whether causal inference (and/or causal effects) is valid regarding the type of data is being analyzed (“post treatment” data, like arrest data in which the arrest already happened vs.&nbsp;whether or not an arrest happens, and etc. etc.)</p>
</section>
<section id="b.-computational-problems" class="level2">
<h2 class="anchored" data-anchor-id="b.-computational-problems">B. Computational Problems</h2>
</section>
<section id="problem-b.1-extra-features-in-causal-models-include-or-not" class="level2">
<h2 class="anchored" data-anchor-id="problem-b.1-extra-features-in-causal-models-include-or-not">Problem B.1 Extra features in causal models: include or not?!</h2>
<p>Imagine that a team of researchers is investigating whether a pedagogical intervention causes an increase in students’ conversational skills in Italian. Including a properly-chosen “control variable” in the analysis is important in terms of statistical power and precision. (A control variable is a predictor/explanatory variable/feature that controls for variability.) As a result, the researchers decide to administer an Italian vocabulary test to students, and include their score on this test in their analyses as a control variable.</p>
<p>But if the researchers administer the vocabulary test <em>after</em> the pedagogical intervention (i.e., the vocabulary test is “post-treatment”), it’s possible that the vocabulary scores are themselves affected by the intervention as well. If the pedagogical intervention is “post-treatment”, controlling for it will negatively impact the regression model.</p>
<p>In this question, let’s simulate some data according to various causal models to see how causal assumptions will impact the regression model. Here’s a summary of the variables that we will simulate:</p>
<ul>
<li><p><code>x</code> refer to the causal variable, i.e., the pedagogical intervention. This is a binary variable (either the student received the pedagogical intervention or they did not)</p></li>
<li><p><code>y</code> is the effect/response variable, i.e., a student’s conversational skills in Italian. It is a continuous variable (perhaps an exam score)</p></li>
<li><p><code>z</code> refers to the post-treatment variable, i.e., the Italian vocabulary scores in our example.</p></li>
</ul>
<p>Since <code>z</code> is a post-treatment variable, it’s possible that it is itself influenced directly or indirectly by <code>x</code>. Let’s explore various options.</p>
<p><strong>B.1 (a) [5 points] Draw a causal diagram such that <code>x</code> affects both <code>y</code> and <code>z</code>, but <code>z</code> and <code>y</code> don’t influence each other.</strong></p>
<p><em>YOUR ANSWER HERE</em></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Capture.PNG" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">diagram</figcaption>
</figure>
</div>
<p>The cell directly below simulates data such that <code>x</code> causes both <code>y</code> and <code>z</code>, but <code>z</code> and <code>y</code> don’t influence each other. That is, <code>x</code> is a so-called “common cause” of <code>y</code> and <code>z</code>.</p>
<p><strong>B.1 (b) [15 points] Run two linear regressions, one with <em>both</em> <code>x</code> and <code>z</code> as predictors and one with only <code>x</code> as a predictor. Identify the average causal effect of <code>x</code> on <code>y</code>. Is it the same in each regression? If not, which one is the correct causal effect? That is, which regression is more appropriate and why?</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1983</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>B1b <span class="ot">=</span> <span class="cf">function</span>(n_per_group, <span class="at">beta_xy =</span> <span class="dv">1</span>, <span class="at">beta_xz =</span> <span class="fl">1.5</span>) {</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create x (with n_per_group 0s and n_per_group 1s)</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">=</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">each =</span> n_per_group)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">=</span> beta_xy<span class="sc">*</span>x <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">2</span><span class="sc">*</span>n_per_group)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># x affects z</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  z <span class="ot">=</span> beta_xz<span class="sc">*</span>x <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">2</span><span class="sc">*</span>n_per_group)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create data frame</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  dfr <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">as.factor</span>(x), y, z)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add info: z above or below median (for plotting)</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  dfr<span class="sc">$</span>z_split <span class="ot">=</span> <span class="fu">factor</span>(<span class="fu">ifelse</span>(dfr<span class="sc">$</span>z <span class="sc">&gt;</span> <span class="fu">median</span>(dfr<span class="sc">$</span>z), <span class="st">"above"</span>, <span class="st">"below"</span>))</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return data frame</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(dfr)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>df_B1b <span class="ot">=</span> <span class="fu">B1b</span>(<span class="at">n_per_group =</span> <span class="dv">100</span>)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Type 'df_case1' to inspect.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#YOUR CODE HERE</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_B1b)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  x           y           z z_split
1 0 -0.01705205  1.66417848   above
2 0 -0.78367184  0.95658409   above
3 0  1.32662703  0.83578491   above
4 0 -0.23171715  0.64025976   below
5 0 -1.66372191 -0.06495654   below
6 0  1.99692302  0.82945755   above</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>single_pred <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> df_B1b)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(single_pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x, data = df_B1b)

Residuals:
     Min       1Q   Median       3Q      Max 
-2.64053 -0.67116 -0.02387  0.70462  2.33518 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  0.04362    0.09725   0.449    0.654    
x1           1.01606    0.13753   7.388 4.07e-12 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.9725 on 198 degrees of freedom
Multiple R-squared:  0.2161,    Adjusted R-squared:  0.2121 
F-statistic: 54.58 on 1 and 198 DF,  p-value: 4.072e-12</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>mult_pred <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x <span class="sc">+</span> z, <span class="at">data =</span> df_B1b )</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mult_pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x + z, data = df_B1b)

Residuals:
     Min       1Q   Median       3Q      Max 
-2.59279 -0.65044 -0.03338  0.67875  2.34313 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  0.03971    0.09790   0.406    0.685    
x1           0.97478    0.16986   5.739 3.56e-08 ***
z            0.03071    0.07387   0.416    0.678    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.9745 on 197 degrees of freedom
Multiple R-squared:  0.2168,    Adjusted R-squared:  0.2088 
F-statistic: 27.26 on 2 and 197 DF,  p-value: 3.523e-11</code></pre>
</div>
</div>
<p>YOUR ANSWER HERE</p>
<p><strong>B.1 (c) [20 points] Now assume <code>x</code> causes <code>y</code> directly, and <code>y</code> in turns causes <code>z</code>. Draw a causal diagram and simulate data according to this causal graph (keep the effect of <code>x</code> on <code>y</code> equal to 1). Then run two linear regressions, one with <em>both</em> <code>x</code> and <code>z</code> as predictors and one with only <code>x</code> as a predictor. Identify the estimated average causal effect of <code>x</code> on <code>y</code>. Is it roughly the same in each regression? If not, which one is the correct causal effect? That is, which regression is more appropriate and why?</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#YOUR CODE HERE</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>B1c <span class="ot">=</span> <span class="cf">function</span>(n_per_group, <span class="at">beta_xy =</span> <span class="dv">1</span>, <span class="at">beta_yz =</span> <span class="fl">1.5</span>) {</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create x (with n_per_group 0s and n_per_group 1s)</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">=</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">each =</span> n_per_group)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">=</span> beta_xy<span class="sc">*</span>x <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">2</span><span class="sc">*</span>n_per_group)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># y affects z</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  z <span class="ot">=</span> beta_yz<span class="sc">*</span>y <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">2</span><span class="sc">*</span>n_per_group)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create data frame</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  dfr <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">as.factor</span>(x), y, z)</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add info: z above or below median (for plotting)</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  dfr<span class="sc">$</span>z_split <span class="ot">=</span> <span class="fu">factor</span>(<span class="fu">ifelse</span>(dfr<span class="sc">$</span>z <span class="sc">&gt;</span> <span class="fu">median</span>(dfr<span class="sc">$</span>z), <span class="st">"above"</span>, <span class="st">"below"</span>))</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return data frame</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(dfr)</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>df_B1c <span class="ot">=</span> <span class="fu">B1c</span>(<span class="at">n_per_group =</span> <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#YOUR CODE HERE</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>B1c_single <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> df_B1c)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(B1c_single)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x, data = df_B1c)

Residuals:
    Min      1Q  Median      3Q     Max 
-3.4720 -0.6244  0.0217  0.6738  2.9127 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  0.01082    0.09739   0.111    0.912    
x1           0.94155    0.13773   6.836 9.85e-11 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.9739 on 198 degrees of freedom
Multiple R-squared:  0.1909,    Adjusted R-squared:  0.1869 
F-statistic: 46.73 on 1 and 198 DF,  p-value: 9.849e-11</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>B1c_mult <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x <span class="sc">+</span> z, <span class="at">data =</span> df_B1c)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(B1c_mult)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x + z, data = df_B1c)

Residuals:
     Min       1Q   Median       3Q      Max 
-1.61382 -0.37233  0.00716  0.39178  1.65184 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -0.02164    0.05360  -0.404    0.687    
x1           0.34470    0.08076   4.268 3.06e-05 ***
z            0.42153    0.01972  21.381  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.5358 on 197 degrees of freedom
Multiple R-squared:  0.7563,    Adjusted R-squared:  0.7539 
F-statistic: 305.8 on 2 and 197 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p><em>YOUR ANSWER HERE</em></p>
<p>Causal diagram:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Capture2.PNG" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">xyz_diagram</figcaption>
</figure>
</div>
<p><strong>B.1 (d) [20 points] Now, let’s assume that <code>z</code> is caused by both <code>x</code> and <code>y</code>. <code>x</code> also still affects <code>y</code>. Draw a causal diagram and simulate data according to this causal graph (keep the effect of <code>x</code> on <code>y</code> equal to 1). Then run two linear regressions, one with <em>both</em> <code>x</code> and <code>z</code> as predictors and one with only <code>x</code> as a predictor. Identify the estimated average causal effect of <code>x</code> on <code>y</code>. Is it roughly the same in each regression? If not, which one is the correct causal effect? That is, which regression is more appropriate and why?</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">#YOUR CODE HERE</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>B1d <span class="ot">=</span> <span class="cf">function</span>(n_per_group, <span class="at">beta_xy =</span> <span class="dv">1</span>, <span class="at">beta_xz =</span> <span class="fl">1.5</span>, <span class="at">beta_yz=</span><span class="fl">1.5</span>) {</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create x (with n_per_group 0s and n_per_group 1s)</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">=</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">each =</span> n_per_group)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">=</span> beta_xy<span class="sc">*</span>x <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">2</span><span class="sc">*</span>n_per_group)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># x an y affects z</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  z <span class="ot">=</span> beta_xz<span class="sc">*</span>x <span class="sc">+</span> beta_yz<span class="sc">*</span>y <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">2</span><span class="sc">*</span>n_per_group)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create data frame</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  dfr <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">as.factor</span>(x), y, z)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add info: z above or below median (for plotting)</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>  dfr<span class="sc">$</span>z_split <span class="ot">=</span> <span class="fu">factor</span>(<span class="fu">ifelse</span>(dfr<span class="sc">$</span>z <span class="sc">&gt;</span> <span class="fu">median</span>(dfr<span class="sc">$</span>z), <span class="st">"above"</span>, <span class="st">"below"</span>))</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return data frame</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(dfr)</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>df_B1d <span class="ot">=</span> <span class="fu">B1d</span>(<span class="at">n_per_group =</span> <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#YOUR CODE HERE</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>B1d_single <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> df_B1d)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(B1d_single)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x, data = df_B1d)

Residuals:
    Min      1Q  Median      3Q     Max 
-3.5443 -0.5802 -0.0526  0.6966  2.3513 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  0.03469    0.10009   0.347    0.729    
x1           0.94983    0.14155   6.710    2e-10 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.001 on 198 degrees of freedom
Multiple R-squared:  0.1853,    Adjusted R-squared:  0.1812 
F-statistic: 45.03 on 1 and 198 DF,  p-value: 1.995e-10</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>B1d_mult <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x <span class="sc">+</span> z, <span class="at">data =</span> df_B1d)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(B1d_mult)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x + z, data = df_B1d)

Residuals:
    Min      1Q  Median      3Q     Max 
-1.7692 -0.3776 -0.0023  0.3763  1.5629 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  0.03174    0.05627   0.564  0.57338    
x1          -0.38697    0.10244  -3.777  0.00021 ***
z            0.43801    0.02114  20.723  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.5627 on 197 degrees of freedom
Multiple R-squared:  0.7438,    Adjusted R-squared:  0.7412 
F-statistic:   286 on 2 and 197 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p><em>YOUR ANSWER HERE</em></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Capture3.PNG" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">xzxyz_diagram</figcaption>
</figure>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>