<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jasmine Kobayashi">

<title>STAT 5010: HW5</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="STAT5010_HW5_files/libs/clipboard/clipboard.min.js"></script>
<script src="STAT5010_HW5_files/libs/quarto-html/quarto.js"></script>
<script src="STAT5010_HW5_files/libs/quarto-html/popper.min.js"></script>
<script src="STAT5010_HW5_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="STAT5010_HW5_files/libs/quarto-html/anchor.min.js"></script>
<link href="STAT5010_HW5_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="STAT5010_HW5_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="STAT5010_HW5_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="STAT5010_HW5_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="STAT5010_HW5_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#a.-theoretical-problems" id="toc-a.-theoretical-problems" class="nav-link active" data-scroll-target="#a.-theoretical-problems">A. Theoretical Problems</a>
  <ul class="collapse">
  <li><a href="#a.1-association-studies-given-causal-language" id="toc-a.1-association-studies-given-causal-language" class="nav-link" data-scroll-target="#a.1-association-studies-given-causal-language">A.1 Association studies given causal language?</a></li>
  </ul></li>
  <li><a href="#b.-computational-problems" id="toc-b.-computational-problems" class="nav-link" data-scroll-target="#b.-computational-problems">B. Computational Problems</a>
  <ul class="collapse">
  <li><a href="#b.1-35-points" id="toc-b.1-35-points" class="nav-link" data-scroll-target="#b.1-35-points">B.1 (35 points)</a>
  <ul class="collapse">
  <li><a href="#for-the-teengamb-data-fit-a-model-with-gamble-as-the-response-and-the-other-variables-as-predictors.-look-for-violations-of" id="toc-for-the-teengamb-data-fit-a-model-with-gamble-as-the-response-and-the-other-variables-as-predictors.-look-for-violations-of" class="nav-link" data-scroll-target="#for-the-teengamb-data-fit-a-model-with-gamble-as-the-response-and-the-other-variables-as-predictors.-look-for-violations-of">For the <code>teengamb</code> data, fit a model with <code>gamble</code> as the response and the other variables as predictors. Look for violations of:</a></li>
  </ul></li>
  <li><a href="#b.2-45-points" id="toc-b.2-45-points" class="nav-link" data-scroll-target="#b.2-45-points">B.2 (45 Points)</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">STAT 5010: HW5</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Jasmine Kobayashi </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<p><strong>See Canvas for HW #5 assignment due date</strong>. Complete all of the following problems. Ideally, the theoretical problems should be answered in a Markdown cell directly underneath the question. If you don’t know LaTex/Markdown, you may submit separate handwritten solutions to the theoretical problems. Please do not turn in messy work. Computational problems should be completed in this notebook (using the R kernel is preferred). Computational questions may require code, plots, analysis, interpretation, etc. Working in small groups is allowed, but it is important that you make an effort to master the material and hand in your own work.</p>
<section id="a.-theoretical-problems" class="level1">
<h1>A. Theoretical Problems</h1>
<section id="a.1-association-studies-given-causal-language" class="level2">
<h2 class="anchored" data-anchor-id="a.1-association-studies-given-causal-language">A.1 Association studies given causal language?</h2>
<p>Sometimes, researchers using non-causal models with observational data are careful to use associative, non-causal language. In some cases, these studies are picked up by media outlets and incorrectly interpreted causally.</p>
<p>Other times, researchers themselves are unintentionally using causal language with non-causal models and observational data.</p>
<p><strong>[20 points] Find a science or social science study reported in the news. Podcasts like <em>Hidden Brain</em> might be useful here! Does the report of the study make reference to a causal relationship? If so, based on the actual study, do you think that the causal claims are justified? Does it use phrases like “<span class="math inline">\(X\)</span> is associated with <span class="math inline">\(Y\)</span>”? Or “<span class="math inline">\(X\)</span> causes <span class="math inline">\(Y\)</span>” ?…</strong></p>
<p><em>YOUR ANSWER HERE</em></p>
<p>I can’t say I had time to go looking for a specific example, but I will say that I currently am in the possession of several books like “<em>Weapons of Math Destruction</em>” (by Cathy O’Neil), and other related books that keep me grounded on being wary and skeptical of putting too much confidence on placing causal language to non-causal models. (Which, quite frankly, I’ll probably consider all statistical models to be non-causal models. Just in my opinion, but that can be an entirely different conversation.) (Some of these books and resources I have touch into the territory of artificial <em>UN</em>intelligence of machine learning models and etc. which grows into the territory of AI ethics too, but that really is an entirely different conversation.)</p>
</section>
</section>
<section id="b.-computational-problems" class="level1">
<h1>B. Computational Problems</h1>
<section id="b.1-35-points" class="level2">
<h2 class="anchored" data-anchor-id="b.1-35-points">B.1 (35 points)</h2>
<section id="for-the-teengamb-data-fit-a-model-with-gamble-as-the-response-and-the-other-variables-as-predictors.-look-for-violations-of" class="level3">
<h3 class="anchored" data-anchor-id="for-the-teengamb-data-fit-a-model-with-gamble-as-the-response-and-the-other-variables-as-predictors.-look-for-violations-of">For the <a href="https://rdrr.io/cran/faraway/man/teengamb.html"><code>teengamb</code></a> data, fit a model with <code>gamble</code> as the response and the other variables as predictors. Look for violations of:</h3>
<ol type="1">
<li>[5 points] Constant Variance</li>
<li>[5 points] Normality</li>
<li>[5 points] Linearity</li>
<li>[5 points] Correlations</li>
<li>[5 points] Measurement validity</li>
<li><strong>[10 points] Look for (a) outliers, (b) leverage points, and (b) potentially influential points. This part of the problem requires some self-study about defining and identifying leverage points, and describing the relationship between leverage and influence. Chapter 6 of <em>Linear Models with R</em> (pdf on Canvas) may help!</strong></li>
</ol>
<p><strong>Write a short report detailing your findings.</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>teengamb <span class="ot">=</span> <span class="fu">read.csv</span>((<span class="st">"https://raw.githubusercontent.com/CUBuffs/Statistical-Learning-/main/Modern%20Regression%20Analysis/Datasets/teengamb.txt"</span>), <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(teengamb)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      sex             status          income           verbal     
 Min.   :0.0000   Min.   :18.00   Min.   : 0.600   Min.   : 1.00  
 1st Qu.:0.0000   1st Qu.:28.00   1st Qu.: 2.000   1st Qu.: 6.00  
 Median :0.0000   Median :43.00   Median : 3.250   Median : 7.00  
 Mean   :0.4043   Mean   :45.23   Mean   : 4.642   Mean   : 6.66  
 3rd Qu.:1.0000   3rd Qu.:61.50   3rd Qu.: 6.210   3rd Qu.: 8.00  
 Max.   :1.0000   Max.   :75.00   Max.   :15.000   Max.   :10.00  
     gamble     
 Min.   :  0.0  
 1st Qu.:  1.1  
 Median :  6.0  
 Mean   : 19.3  
 3rd Qu.: 19.4  
 Max.   :156.0  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#YOUR CODE HERE</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>tgmod <span class="ot">&lt;-</span> <span class="fu">lm</span>(gamble <span class="sc">~</span> ., <span class="at">data =</span> teengamb)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(tgmod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = gamble ~ ., data = teengamb)

Residuals:
    Min      1Q  Median      3Q     Max 
-51.082 -11.320  -1.451   9.452  94.252 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  22.55565   17.19680   1.312   0.1968    
sex         -22.11833    8.21111  -2.694   0.0101 *  
status        0.05223    0.28111   0.186   0.8535    
income        4.96198    1.02539   4.839 1.79e-05 ***
verbal       -2.95949    2.17215  -1.362   0.1803    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 22.69 on 42 degrees of freedom
Multiple R-squared:  0.5267,    Adjusted R-squared:  0.4816 
F-statistic: 11.69 on 4 and 42 DF,  p-value: 1.815e-06</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#YOUR CODE HERE</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">repr.plot.width =</span> <span class="dv">12</span>, <span class="at">repr.plot.height =</span> <span class="dv">12</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(tgmod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="STAT5010_HW5_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong>JK note:</strong> Can take a closer look at these plots individually with the following</p>
<section id="residual-vs.-fitted" class="level4">
<h4 class="anchored" data-anchor-id="residual-vs.-fitted">Residual vs.&nbsp;Fitted <a name="residVfit" href=""></a></h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(tgmod,<span class="at">which =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="STAT5010_HW5_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="normal-qq-plot" class="level4">
<h4 class="anchored" data-anchor-id="normal-qq-plot">Normal QQ plot <a name="QQplot" href=""></a></h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(tgmod, <span class="at">which =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="STAT5010_HW5_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="residuals-vs.-leverage" class="level4">
<h4 class="anchored" data-anchor-id="residuals-vs.-leverage">Residuals vs.&nbsp;Leverage <a name="residVlev" href=""></a></h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(tgmod, <span class="at">which =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="STAT5010_HW5_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><em>YOUR ANSWER HERE</em></p>
<p><strong>JK note:</strong> The links in the following text will take you to the anchor point of the plot that is being referenced. If viewing this html file on a web browser, you should be able to hit the “back” button to return to where you were before clicking the link to the anchor point (i.e.&nbsp;back to this point in the text).</p>
<p>A quantile-quantile plot (aka QQ plot) can give some potential insight into our normality assumption. The <a href="#QQplot">QQ Plot</a> produced for this model suggest some non-normality, particularly in the tails of the distribution.</p>
<p>A residual vs.&nbsp;fitted plot can give some information on linearity, and the random distribution and constant variance in the residuals. The <a href="#residVfit">Residual vs.&nbsp;Fitted plot</a> for this model shows some “fanning out” behavior when you analyze the plot from left-to-right. There may be a couple outliers as well. In any case the plot appears to suggest violations in constant variance in our residuals and our linearity assumptions.</p>
<p>As indicated in the assignment directions, I had to look up “leverage” a bit myself, but from what I understand “leverage” is in relation to how much a regression model would change with or without an observation. I’m still not entirely clear on how to read a residual vs.&nbsp;leverage plot, but I’m guessing according to the one <a href="#residVlev">here</a> there may be a few points that may have a lot of effect on the model depending on their presence in the dataset.</p>
</section>
</section>
</section>
<section id="b.2-45-points" class="level2">
<h2 class="anchored" data-anchor-id="b.2-45-points">B.2 (45 Points)</h2>
<p>Researchers at the National Institutes of Standards and Technology (NIST) collected <a href="https://rdrr.io/cran/faraway/man/pipeline.html">pipline data</a> on ultrasonic measurements of the depth of defects in the Alaska pipeline in the field. The depths of the defects were then remeasured in the laboratory. The laboratory measurements are more accurate than the field measurements, but more time consuming and expensive. We want to develop a regression model for correcting the in field measurements.</p>
<p><strong>B.2 (a) [10 points] Fit a regression model where <code>Lab</code> is the response and <code>Field</code> is the predictor and save this model as <code>lmodPipeline</code>. Check for non-constant variance.</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>pipeline <span class="ot">=</span> <span class="fu">read.csv</span>((<span class="st">"https://raw.githubusercontent.com/CUBuffs/Statistical-Learning-/main/Modern%20Regression%20Analysis/Datasets/pipeline.txt"</span>), <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pipeline)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Field            Lab            Batch      
 Min.   : 5.00   Min.   : 4.30   Min.   :1.000  
 1st Qu.:18.00   1st Qu.:18.35   1st Qu.:2.000  
 Median :35.00   Median :38.00   Median :3.000  
 Mean   :33.58   Mean   :39.10   Mean   :3.234  
 3rd Qu.:46.50   3rd Qu.:55.55   3rd Qu.:5.000  
 Max.   :85.00   Max.   :81.90   Max.   :6.000  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">#YOUR CODE HERE</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>lmodPipeline <span class="ot">&lt;-</span> <span class="fu">lm</span>(Lab <span class="sc">~</span> Field, <span class="at">data =</span> pipeline)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lmodPipeline)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Lab ~ Field, data = pipeline)

Residuals:
    Min      1Q  Median      3Q     Max 
-21.985  -4.072  -1.431   2.504  24.334 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -1.96750    1.57479  -1.249    0.214    
Field        1.22297    0.04107  29.778   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 7.865 on 105 degrees of freedom
Multiple R-squared:  0.8941,    Adjusted R-squared:  0.8931 
F-statistic: 886.7 on 1 and 105 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>YOUR ANSWER HERE</p>
<p><strong>B.2 (b) [10 points] Sometimes transforming the response and predictor helps in stabilizing variance. Find a transformation on <code>Lab</code> and/or <code>Field</code> so that in the transformed scale the relationship is approximately linear with constant variance. Restrict your choice of transformation to square root, log, and inverse. Save your transformed variables as <code>pipeline$LabTransform</code> and <code>pipeline$FieldTransform</code>. Then, regress the transformed<code>Lab</code> variable (response) onto the transformed <code>Field</code> variable (predictor), and save this as <code>lmodTr</code>.</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">#YOUR CODE HERE</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co">#log transform</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>pipeline<span class="sc">$</span>LabTransform <span class="ot">&lt;-</span> <span class="fu">log</span>(pipeline<span class="sc">$</span>Lab)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>pipeline<span class="sc">$</span>FieldTransform <span class="ot">&lt;-</span> <span class="fu">log</span>(pipeline<span class="sc">$</span>Field)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co"># #square-root transform</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co"># pipeline$LabTransform &lt;- sqrt(pipeline$Lab)</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co"># pipeline$FieldTransform &lt;- sqrt(pipeline$Field)</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pipeline)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Field            Lab            Batch        LabTransform  
 Min.   : 5.00   Min.   : 4.30   Min.   :1.000   Min.   :1.459  
 1st Qu.:18.00   1st Qu.:18.35   1st Qu.:2.000   1st Qu.:2.910  
 Median :35.00   Median :38.00   Median :3.000   Median :3.638  
 Mean   :33.58   Mean   :39.10   Mean   :3.234   Mean   :3.444  
 3rd Qu.:46.50   3rd Qu.:55.55   3rd Qu.:5.000   3rd Qu.:4.017  
 Max.   :85.00   Max.   :81.90   Max.   :6.000   Max.   :4.405  
 FieldTransform 
 Min.   :1.609  
 1st Qu.:2.890  
 Median :3.555  
 Mean   :3.330  
 3rd Qu.:3.839  
 Max.   :4.443  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>lmodTr <span class="ot">&lt;-</span> <span class="fu">lm</span>(LabTransform <span class="sc">~</span> FieldTransform,<span class="at">data =</span> pipeline)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lmodTr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = LabTransform ~ FieldTransform, data = pipeline)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.40212 -0.11853 -0.03092  0.13424  0.40209 

Coefficients:
               Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)    -0.06849    0.09305  -0.736    0.463    
FieldTransform  1.05483    0.02743  38.457   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.1837 on 105 degrees of freedom
Multiple R-squared:  0.9337,    Adjusted R-squared:  0.9331 
F-statistic:  1479 on 1 and 105 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p><strong>B.2 (c) [5 points] Now let’s try weighted least squares. The code below splits the range of <code>Field</code> into 12 groups of size nine (except for the last goup which has only eight values). Within each group, we compute the variance of <code>Lab</code> as varlab and the mean of <code>Field</code> as meanfield. Write comments for each line of the code to demonstrate what each line is doing.</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>i <span class="ot">=</span> <span class="fu">order</span>(pipeline<span class="sc">$</span>Field);  </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>npipe <span class="ot">=</span> pipeline[i,];       </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>ff <span class="ot">=</span> <span class="fu">gl</span>(<span class="dv">12</span>,<span class="dv">9</span>)[<span class="sc">-</span><span class="dv">108</span>];  </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>meanfield <span class="ot">=</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(<span class="fu">split</span>(npipe<span class="sc">$</span>Field,ff),mean));  </span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>varlab <span class="ot">=</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(<span class="fu">split</span>(npipe<span class="sc">$</span>Lab,ff),var)); </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">#YOUR CODE HERE</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">order</span>(pipeline<span class="sc">$</span>Field))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  85  95  71 102  14  16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(npipe)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Field  Lab Batch LabTransform FieldTransform
85      5  4.3     5     1.458615       1.609438
95      5  6.0     5     1.791759       1.609438
71      9 11.4     4     2.433613       2.197225
102     9  6.8     6     1.916923       2.197225
14     10 14.3     1     2.660260       2.302585
16     10 13.7     1     2.617396       2.302585</code></pre>
</div>
</div>
<p><em>JK Answer</em></p>
<ul>
<li><code>i = order(pipeline$Field)</code>
<ul>
<li><code>order(pipeline$Field)</code> extracts the indices of <code>pipeline</code> if it was arranged in ascending order with respect to <code>Field</code>, the in</li>
</ul></li>
<li><code>npipe = pipeline[i,]</code>
<ul>
<li>extracts <code>pipeline</code> in the order of <code>i</code> (ascending order with respect to <code>Field</code>) into variable <code>npipe</code></li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gl</span>(<span class="dv">12</span>,<span class="dv">9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] 1  1  1  1  1  1  1  1  1  2  2  2  2  2  2  2  2  2  3  3  3  3  3  3  3 
 [26] 3  3  4  4  4  4  4  4  4  4  4  5  5  5  5  5  5  5  5  5  6  6  6  6  6 
 [51] 6  6  6  6  7  7  7  7  7  7  7  7  7  8  8  8  8  8  8  8  8  8  9  9  9 
 [76] 9  9  9  9  9  9  10 10 10 10 10 10 10 10 10 11 11 11 11 11 11 11 11 11 12
[101] 12 12 12 12 12 12 12 12
Levels: 1 2 3 4 5 6 7 8 9 10 11 12</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gl</span>(<span class="dv">12</span>,<span class="dv">9</span>)[<span class="sc">-</span><span class="dv">108</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] 1  1  1  1  1  1  1  1  1  2  2  2  2  2  2  2  2  2  3  3  3  3  3  3  3 
 [26] 3  3  4  4  4  4  4  4  4  4  4  5  5  5  5  5  5  5  5  5  6  6  6  6  6 
 [51] 6  6  6  6  7  7  7  7  7  7  7  7  7  8  8  8  8  8  8  8  8  8  9  9  9 
 [76] 9  9  9  9  9  9  10 10 10 10 10 10 10 10 10 11 11 11 11 11 11 11 11 11 12
[101] 12 12 12 12 12 12 12
Levels: 1 2 3 4 5 6 7 8 9 10 11 12</code></pre>
</div>
</div>
<p><em>JK Answer</em></p>
<ul>
<li><code>ff = gl(12,9)[-108]</code>
<ul>
<li><code>gl(12,9)</code>
<ul>
<li>the <code>gl(n,k)</code> function generates “factor levels”
<ul>
<li>with <code>n</code> number of levels (int)</li>
<li><code>k</code> number of replications</li>
</ul></li>
<li><span class="math inline">\(\Rightarrow\)</span> <code>gl(12,9)</code> gives levels from 1 to 12, and there are 9 of each level</li>
</ul></li>
<li><code>[-108]</code>
<ul>
<li><span class="math inline">\(12 \times 9 = 108\)</span>, so there would normally be 108 elements in the object <code>gl(12,9)</code>
<ul>
<li>the <code>[-108]</code> portion removes the 108th element
<ul>
<li>(this is likely done due to the fact that last group is size 8 instead of size 9)</li>
</ul></li>
</ul></li>
</ul></li>
<li>(this is all stored in variable <code>ff</code>)</li>
<li><span class="math inline">\(\Rightarrow\)</span> <code>ff</code> has levels 1 to 12, where there are 9 of each level <em>except</em> level 12 in which there are only 8</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">split</span>(npipe<span class="sc">$</span>Field,ff)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`1`
[1]  5  5  9  9 10 10 10 10 10

$`2`
[1] 10 10 10 11 12 12 13 13 13

$`3`
[1] 15 15 15 15 15 15 15 16 18

$`4`
[1] 18 18 18 18 18 19 20 20 20

$`5`
[1] 20 20 20 20 21 22 23 25 25

$`6`
[1] 28 30 30 32 33 33 33 33 35

$`7`
[1] 35 35 36 36 36 36 37 38 38

$`8`
[1] 38 38 38 38 40 40 43 43 43

$`9`
[1] 43 43 45 45 45 45 45 45 48

$`10`
[1] 50 50 50 50 50 50 50 50 52

$`11`
[1] 53 53 53 56 58 58 60 63 63

$`12`
[1] 63 63 65 65 70 73 75 85</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(<span class="fu">split</span>(npipe<span class="sc">$</span>Field,ff),mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`1`
[1] 8.666667

$`2`
[1] 11.55556

$`3`
[1] 15.44444

$`4`
[1] 18.77778

$`5`
[1] 21.77778

$`6`
[1] 31.88889

$`7`
[1] 36.33333

$`8`
[1] 40.11111

$`9`
[1] 44.88889

$`10`
[1] 50.22222

$`11`
[1] 57.44444

$`12`
[1] 69.875</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unlist</span>(<span class="fu">lapply</span>(<span class="fu">split</span>(npipe<span class="sc">$</span>Field,ff),mean))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        1         2         3         4         5         6         7         8 
 8.666667 11.555556 15.444444 18.777778 21.777778 31.888889 36.333333 40.111111 
        9        10        11        12 
44.888889 50.222222 57.444444 69.875000 </code></pre>
</div>
</div>
<p><em>JK Answer</em></p>
<ul>
<li><code>meanfield = unlist(lapply(split(npipe$Field,ff),mean))</code>
<ul>
<li><code>split(npipe$Field,ff)</code>
<ul>
<li>splits <code>Field</code> in <code>npipe</code> into the 12 factor levels in <code>ff</code></li>
</ul></li>
<li><code>lapply(split(npipe$Field,ff),mean)</code>
<ul>
<li>replaces the contents of each level to the mean of each level</li>
</ul></li>
<li><code>unlist(lapply(split(npipe$Field,ff),mean))</code>
<ul>
<li>the <code>unlist()</code> function “flattens” a list or vector
<ul>
<li>so essentially changes the structure of the above so that it’s not levels but a list (or something similar datatype)?</li>
</ul></li>
</ul></li>
<li>in any case, <code>meanfield</code> is a list (or something) of means of the <code>Field</code> data split into 12 groups.</li>
</ul></li>
<li><code>varlab = unlist(lapply(split(npipe$Lab,ff),var))</code>
<ul>
<li>based on the above, I’m guessing <code>varlab</code> is similar to <code>meanfield</code> but obtaining the <em>variance</em> of the <code>Lab</code> data when it’s split into 12 groups (instead of the mean)</li>
</ul></li>
</ul>
<p><strong>B.2 (d) [20 points] Suppose that the variance in the repsonse is linked to the predictor in the following way: <span class="math display">\[ Var(Lab) = a_0Field^{a_1}.\]</span> Use simple linear regression on (transformations of) varlab and meanfield to estimate <span class="math inline">\(a_0\)</span> and <span class="math inline">\(a_1\)</span>. Call this regression <code>lmodVar</code>.Use these estimates to perform weighted least squares where the weights are the inverse of the variance of Lab. Call this regression <code>lmodwls</code>. Print a summary of this model and comment on the fit.</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co">#YOUR CODE HERE (hw help recieved from Dr. O)</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>lmodVar <span class="ot">=</span> <span class="fu">lm</span>(<span class="fu">log</span>(varlab[<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>]) <span class="sc">~</span> <span class="fu">log</span>(meanfield[<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>]))</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">log</span>(meanfield[<span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>]),<span class="fu">log</span>(varlab[<span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>]))</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(lmodVar)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="STAT5010_HW5_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lmodVar)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = log(varlab[1:12]) ~ log(meanfield[1:12]))

Residuals:
    Min      1Q  Median      3Q     Max 
-2.2038 -0.6729  0.1656  0.7205  1.1891 

Coefficients:
                     Estimate Std. Error t value Pr(&gt;|t|)  
(Intercept)           -0.3538     1.5715  -0.225   0.8264  
log(meanfield[1:12])   1.1244     0.4617   2.435   0.0351 *
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.018 on 10 degrees of freedom
Multiple R-squared:  0.3723,    Adjusted R-squared:  0.3095 
F-statistic: 5.931 on 1 and 10 DF,  p-value: 0.03513</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">=</span> <span class="fu">coef</span>(lmodVar)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>w <span class="ot">=</span> <span class="fu">with</span>(pipeline, <span class="fu">exp</span>(a[<span class="dv">1</span>])<span class="sc">*</span>Field<span class="sc">^</span>(a[<span class="dv">2</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>lmodwls <span class="ot">=</span> <span class="fu">lm</span>(Lab <span class="sc">~</span> Field, <span class="at">data =</span> pipeline, <span class="at">weights =</span> <span class="dv">1</span><span class="sc">/</span>w)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lmodwls)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Lab ~ Field, data = pipeline, weights = 1/w)

Weighted Residuals:
    Min      1Q  Median      3Q     Max 
-2.0826 -0.8102 -0.3189  0.6212  3.4429 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -1.49436    0.90707  -1.647    0.102    
Field        1.20828    0.03488  34.637   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.169 on 105 degrees of freedom
Multiple R-squared:  0.9195,    Adjusted R-squared:  0.9188 
F-statistic:  1200 on 1 and 105 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">fitted</span>(lmodwls), <span class="fu">resid</span>(lmodwls))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="STAT5010_HW5_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">fitted</span>(lmodwls), <span class="fu">resid</span>(lmodwls, <span class="at">type =</span> <span class="st">"pearson"</span>)) <span class="co">#students probably won't use pearson</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="STAT5010_HW5_files/figure-html/unnamed-chunk-17-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co">#residuals, because we didn't talk about them in class. In that case, the residuals will still</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co">#appear to have no-nconstant variance.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Using the regular residuals, we still see some evidence of non-constant variance.</p>
<p>Using the Pearson residuals, which standardizes the residuals, we see an improvement in fit (no strong evidence of non-constant variance).</p>
<p><em>YOUR ANSWER HERE</em> (reworded into own words)</p>
<p>Non-constant variance appears to be more apparent in the plot with the “regular” residuals (again with the “fanning out” behavior).</p>
<p>It’s not perfect, but the plot using the Pearson residuals shows “less” non-constant variance.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>