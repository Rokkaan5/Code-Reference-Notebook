<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Chapter 4 - Regression and Prediction</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Chapter4-Regression_and_Prediction_files/libs/clipboard/clipboard.min.js"></script>
<script src="Chapter4-Regression_and_Prediction_files/libs/quarto-html/quarto.js"></script>
<script src="Chapter4-Regression_and_Prediction_files/libs/quarto-html/popper.min.js"></script>
<script src="Chapter4-Regression_and_Prediction_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Chapter4-Regression_and_Prediction_files/libs/quarto-html/anchor.min.js"></script>
<link href="Chapter4-Regression_and_Prediction_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Chapter4-Regression_and_Prediction_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Chapter4-Regression_and_Prediction_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Chapter4-Regression_and_Prediction_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Chapter4-Regression_and_Prediction_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#practical-statistics-for-data-scientists-python" id="toc-practical-statistics-for-data-scientists-python" class="nav-link active" data-scroll-target="#practical-statistics-for-data-scientists-python">Practical Statistics for Data Scientists (Python)</a></li>
  <li><a href="#simple-linear-regression" id="toc-simple-linear-regression" class="nav-link" data-scroll-target="#simple-linear-regression">Simple Linear Regression</a>
  <ul class="collapse">
  <li><a href="#the-regression-equation" id="toc-the-regression-equation" class="nav-link" data-scroll-target="#the-regression-equation">The Regression Equation</a></li>
  <li><a href="#fitted-values-and-residuals" id="toc-fitted-values-and-residuals" class="nav-link" data-scroll-target="#fitted-values-and-residuals">Fitted Values and Residuals</a></li>
  </ul></li>
  <li><a href="#multiple-linear-regression" id="toc-multiple-linear-regression" class="nav-link" data-scroll-target="#multiple-linear-regression">Multiple linear regression</a>
  <ul class="collapse">
  <li><a href="#assessing-the-model" id="toc-assessing-the-model" class="nav-link" data-scroll-target="#assessing-the-model">Assessing the Model</a></li>
  <li><a href="#model-selection-and-stepwise-regression" id="toc-model-selection-and-stepwise-regression" class="nav-link" data-scroll-target="#model-selection-and-stepwise-regression">Model Selection and Stepwise Regression</a></li>
  <li><a href="#weighted-regression" id="toc-weighted-regression" class="nav-link" data-scroll-target="#weighted-regression">Weighted regression</a></li>
  </ul></li>
  <li><a href="#factor-variables-in-regression" id="toc-factor-variables-in-regression" class="nav-link" data-scroll-target="#factor-variables-in-regression">Factor variables in regression</a>
  <ul class="collapse">
  <li><a href="#dummy-variables-representation" id="toc-dummy-variables-representation" class="nav-link" data-scroll-target="#dummy-variables-representation">Dummy Variables Representation</a></li>
  <li><a href="#factor-variables-with-many-levels" id="toc-factor-variables-with-many-levels" class="nav-link" data-scroll-target="#factor-variables-with-many-levels">Factor Variables with many levels</a></li>
  </ul></li>
  <li><a href="#interpreting-the-regression-equation" id="toc-interpreting-the-regression-equation" class="nav-link" data-scroll-target="#interpreting-the-regression-equation">Interpreting the Regression Equation</a>
  <ul class="collapse">
  <li><a href="#correlated-predictors" id="toc-correlated-predictors" class="nav-link" data-scroll-target="#correlated-predictors">Correlated predictors</a></li>
  <li><a href="#confounding-variables" id="toc-confounding-variables" class="nav-link" data-scroll-target="#confounding-variables">Confounding variables</a></li>
  <li><a href="#interactions-and-main-effects" id="toc-interactions-and-main-effects" class="nav-link" data-scroll-target="#interactions-and-main-effects">Interactions and Main Effects</a></li>
  </ul></li>
  <li><a href="#testing-the-assumptions-regression-diagnostics" id="toc-testing-the-assumptions-regression-diagnostics" class="nav-link" data-scroll-target="#testing-the-assumptions-regression-diagnostics">Testing the Assumptions: Regression Diagnostics</a>
  <ul class="collapse">
  <li><a href="#outliers" id="toc-outliers" class="nav-link" data-scroll-target="#outliers">Outliers</a></li>
  <li><a href="#influential-values" id="toc-influential-values" class="nav-link" data-scroll-target="#influential-values">Influential values</a></li>
  <li><a href="#heteroskedasticity-non-normality-and-correlated-errors" id="toc-heteroskedasticity-non-normality-and-correlated-errors" class="nav-link" data-scroll-target="#heteroskedasticity-non-normality-and-correlated-errors">Heteroskedasticity, Non-Normality and Correlated Errors</a></li>
  <li><a href="#partial-residual-plots-and-nonlinearity" id="toc-partial-residual-plots-and-nonlinearity" class="nav-link" data-scroll-target="#partial-residual-plots-and-nonlinearity">Partial Residual Plots and Nonlinearity</a></li>
  <li><a href="#polynomial-and-spline-regression" id="toc-polynomial-and-spline-regression" class="nav-link" data-scroll-target="#polynomial-and-spline-regression">Polynomial and Spline Regression</a></li>
  <li><a href="#splines" id="toc-splines" class="nav-link" data-scroll-target="#splines">Splines</a></li>
  <li><a href="#generalized-additive-models" id="toc-generalized-additive-models" class="nav-link" data-scroll-target="#generalized-additive-models">Generalized Additive Models</a>
  <ul class="collapse">
  <li><a href="#using-statsmodels" id="toc-using-statsmodels" class="nav-link" data-scroll-target="#using-statsmodels">Using statsmodels</a></li>
  <li><a href="#using-pygam" id="toc-using-pygam" class="nav-link" data-scroll-target="#using-pygam">Using pyGAM</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#additional-material---not-in-book" id="toc-additional-material---not-in-book" class="nav-link" data-scroll-target="#additional-material---not-in-book">Additional material - not in book</a></li>
  <li><a href="#regularization" id="toc-regularization" class="nav-link" data-scroll-target="#regularization">Regularization</a>
  <ul class="collapse">
  <li><a href="#lasso" id="toc-lasso" class="nav-link" data-scroll-target="#lasso">Lasso</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Chapter 4 - Regression and Prediction</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="practical-statistics-for-data-scientists-python" class="level1">
<h1>Practical Statistics for Data Scientists (Python)</h1>
<blockquote class="blockquote">
<ol start="3" type="a">
<li>2019 Peter C. Bruce, Andrew Bruce, Peter Gedeck</li>
</ol>
</blockquote>
<p>Import required Python packages.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:56:03.864611Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:56:03.863919Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:56:06.261770Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:56:06.260726Z&quot;}" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> r2_score, mean_squared_error</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.formula.api <span class="im">as</span> smf</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.stats.outliers_influence <span class="im">import</span> OLSInfluence</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pygam <span class="im">import</span> LinearGAM, s, l</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pygam.datasets <span class="im">import</span> wage</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dmba <span class="im">import</span> stepwise_selection</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dmba <span class="im">import</span> AIC_score</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>no display found. Using non-interactive Agg backend</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:56:06.282478Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:56:06.282202Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:56:06.287171Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:56:06.286442Z&quot;}" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:56:06.289924Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:56:06.289724Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:56:07.087244Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:56:07.086047Z&quot;}" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> common</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    DATA <span class="op">=</span> common.dataDirectory()</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">ImportError</span>:</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    DATA <span class="op">=</span> Path().resolve() <span class="op">/</span> <span class="st">'data'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Define paths to data sets. If you don’t keep your data in the same directory as the code, adapt the path names.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:56:07.090267Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:56:07.090082Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:56:07.093554Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:56:07.092838Z&quot;}" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>LUNG_CSV <span class="op">=</span> DATA <span class="op">/</span> <span class="st">'LungDisease.csv'</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>HOUSE_CSV <span class="op">=</span> DATA <span class="op">/</span> <span class="st">'house_sales.csv'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="simple-linear-regression" class="level1">
<h1>Simple Linear Regression</h1>
<section id="the-regression-equation" class="level2">
<h2 class="anchored" data-anchor-id="the-regression-equation">The Regression Equation</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:56:07.096006Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:56:07.095838Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:56:07.230644Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:56:07.229334Z&quot;}" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>lung <span class="op">=</span> pd.read_csv(LUNG_CSV)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>lung.plot.scatter(x<span class="op">=</span><span class="st">'Exposure'</span>, y<span class="op">=</span><span class="st">'PEFR'</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Chapter4-Regression_and_Prediction_files/figure-html/cell-6-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>We can use the <code>LinearRegression</code> model from <em>scikit-learn</em>.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:56:07.234507Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:56:07.233589Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:56:07.242651Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:56:07.241777Z&quot;}" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>predictors <span class="op">=</span> [<span class="st">'Exposure'</span>]</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>outcome <span class="op">=</span> <span class="st">'PEFR'</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> LinearRegression()</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>model.fit(lung[predictors], lung[outcome])</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Intercept: </span><span class="sc">{</span>model<span class="sc">.</span>intercept_<span class="sc">:.3f}</span><span class="ss">'</span>)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Coefficient Exposure: </span><span class="sc">{</span>model<span class="sc">.</span>coef_[<span class="dv">0</span>]<span class="sc">:.3f}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Intercept: 424.583
Coefficient Exposure: -4.185</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:56:07.245654Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:56:07.245475Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:56:07.578355Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:56:07.577348Z&quot;}" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">4</span>))</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>ax.set_xlim(<span class="dv">0</span>, <span class="dv">23</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>ax.set_ylim(<span class="dv">295</span>, <span class="dv">450</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Exposure'</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'PEFR'</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>ax.plot((<span class="dv">0</span>, <span class="dv">23</span>), model.predict(pd.DataFrame({<span class="st">'Exposure'</span>: [<span class="dv">0</span>, <span class="dv">23</span>]})))</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>ax.text(<span class="fl">0.4</span>, model.intercept_, <span class="vs">r'$b_0$'</span>, size<span class="op">=</span><span class="st">'larger'</span>)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> pd.DataFrame({<span class="st">'Exposure'</span>: [<span class="fl">7.5</span>,<span class="fl">17.5</span>]})</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> model.predict(x)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>ax.plot((<span class="fl">7.5</span>, <span class="fl">7.5</span>, <span class="fl">17.5</span>), (y[<span class="dv">0</span>], y[<span class="dv">1</span>], y[<span class="dv">1</span>]), <span class="st">'--'</span>)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>ax.text(<span class="dv">5</span>, np.mean(y), <span class="vs">r'$\Delta Y$'</span>, size<span class="op">=</span><span class="st">'larger'</span>)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>ax.text(<span class="dv">12</span>, y[<span class="dv">1</span>] <span class="op">-</span> <span class="dv">10</span>, <span class="vs">r'$\Delta X$'</span>, size<span class="op">=</span><span class="st">'larger'</span>)</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>ax.text(<span class="dv">12</span>, <span class="dv">390</span>, <span class="vs">r'$b_1 = \frac{\Delta Y}{\Delta X}$'</span>, size<span class="op">=</span><span class="st">'larger'</span>)</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Chapter4-Regression_and_Prediction_files/figure-html/cell-8-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="fitted-values-and-residuals" class="level2">
<h2 class="anchored" data-anchor-id="fitted-values-and-residuals">Fitted Values and Residuals</h2>
<p>The method <code>predict</code> of a fitted <em>scikit-learn</em> model can be used to predict new data points.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:56:07.581443Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:56:07.581202Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:56:07.588861Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:56:07.587630Z&quot;}" data-execution_count="8">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>fitted <span class="op">=</span> model.predict(lung[predictors])</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>residuals <span class="op">=</span> lung[outcome] <span class="op">-</span> fitted</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:56:07.593671Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:56:07.592248Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:56:08.002777Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:56:08.001812Z&quot;}" data-execution_count="9">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> lung.plot.scatter(x<span class="op">=</span><span class="st">'Exposure'</span>, y<span class="op">=</span><span class="st">'PEFR'</span>, figsize<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">4</span>))</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>ax.plot(lung.Exposure, fitted)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x, yactual, yfitted <span class="kw">in</span> <span class="bu">zip</span>(lung.Exposure, lung.PEFR, fitted): </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    ax.plot((x, x), (yactual, yfitted), <span class="st">'--'</span>, color<span class="op">=</span><span class="st">'C1'</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Chapter4-Regression_and_Prediction_files/figure-html/cell-10-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="multiple-linear-regression" class="level1">
<h1>Multiple linear regression</h1>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:56:08.006526Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:56:08.006290Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:56:08.093356Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:56:08.092457Z&quot;}" data-execution_count="10">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>subset <span class="op">=</span> [<span class="st">'AdjSalePrice'</span>, <span class="st">'SqFtTotLiving'</span>, <span class="st">'SqFtLot'</span>, <span class="st">'Bathrooms'</span>, </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>          <span class="st">'Bedrooms'</span>, <span class="st">'BldgGrade'</span>]</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>house <span class="op">=</span> pd.read_csv(HOUSE_CSV, sep<span class="op">=</span><span class="st">'</span><span class="ch">\t</span><span class="st">'</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(house[subset].head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   AdjSalePrice  SqFtTotLiving  SqFtLot  Bathrooms  Bedrooms  BldgGrade
1      300805.0           2400     9373       3.00         6          7
2     1076162.0           3764    20156       3.75         4         10
3      761805.0           2060    26036       1.75         4          8
4      442065.0           3200     8618       3.75         5          7
5      297065.0           1720     8620       1.75         4          7</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:56:08.096825Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:56:08.096583Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:56:08.107587Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:56:08.106911Z&quot;}" data-execution_count="11">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>predictors <span class="op">=</span> [<span class="st">'SqFtTotLiving'</span>, <span class="st">'SqFtLot'</span>, <span class="st">'Bathrooms'</span>, </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>              <span class="st">'Bedrooms'</span>, <span class="st">'BldgGrade'</span>]</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>outcome <span class="op">=</span> <span class="st">'AdjSalePrice'</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>house_lm <span class="op">=</span> LinearRegression()</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>house_lm.fit(house[predictors], house[outcome])</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Intercept: </span><span class="sc">{</span>house_lm<span class="sc">.</span>intercept_<span class="sc">:.3f}</span><span class="ss">'</span>)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Coefficients:'</span>)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, coef <span class="kw">in</span> <span class="bu">zip</span>(predictors, house_lm.coef_):</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f' </span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>coef<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Intercept: -521871.368
Coefficients:
 SqFtTotLiving: 228.83060360240793
 SqFtLot: -0.06046682065307607
 Bathrooms: -19442.840398321066
 Bedrooms: -47769.95518521438
 BldgGrade: 106106.96307898081</code></pre>
</div>
</div>
<section id="assessing-the-model" class="level2">
<h2 class="anchored" data-anchor-id="assessing-the-model">Assessing the Model</h2>
<p><em>Scikit-learn</em> provides a number of metrics to determine the quality of a model. Here we use the <code>r2_score</code>.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:56:08.110572Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:56:08.110302Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:56:08.122546Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:56:08.121440Z&quot;}" data-execution_count="12">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>fitted <span class="op">=</span> house_lm.predict(house[predictors])</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>RMSE <span class="op">=</span> np.sqrt(mean_squared_error(house[outcome], fitted))</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>r2 <span class="op">=</span> r2_score(house[outcome], fitted)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'RMSE: </span><span class="sc">{</span>RMSE<span class="sc">:.0f}</span><span class="ss">'</span>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'r2: </span><span class="sc">{</span>r2<span class="sc">:.4f}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>RMSE: 261220
r2: 0.5406</code></pre>
</div>
</div>
<p>While <em>scikit-learn</em> provides a variety of different metrics, <em>statsmodels</em> provides a more in-depth analysis of the linear regression model. This package has two different ways of specifying the model, one that is similar to <em>scikit-learn</em> and one that allows specifying <em>R</em>-style formulas. Here we use the first approach. As <em>statsmodels</em> doesn’t add an intercept automaticaly, we need to add a constant column with value 1 to the predictors. We can use the <em>pandas</em> method assign for this.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:56:08.127322Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:56:08.126394Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:56:08.149840Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:56:08.148846Z&quot;}" data-execution_count="13">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> sm.OLS(house[outcome], house[predictors].assign(const<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> model.fit()</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(results.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                            OLS Regression Results                            
==============================================================================
Dep. Variable:           AdjSalePrice   R-squared:                       0.541
Model:                            OLS   Adj. R-squared:                  0.540
Method:                 Least Squares   F-statistic:                     5338.
Date:                Tue, 23 May 2023   Prob (F-statistic):               0.00
Time:                        22:26:09   Log-Likelihood:            -3.1517e+05
No. Observations:               22687   AIC:                         6.304e+05
Df Residuals:                   22681   BIC:                         6.304e+05
Df Model:                           5                                         
Covariance Type:            nonrobust                                         
=================================================================================
                    coef    std err          t      P&gt;|t|      [0.025      0.975]
---------------------------------------------------------------------------------
SqFtTotLiving   228.8306      3.899     58.694      0.000     221.189     236.472
SqFtLot          -0.0605      0.061     -0.988      0.323      -0.180       0.059
Bathrooms     -1.944e+04   3625.388     -5.363      0.000   -2.65e+04   -1.23e+04
Bedrooms      -4.777e+04   2489.732    -19.187      0.000   -5.27e+04   -4.29e+04
BldgGrade      1.061e+05   2396.445     44.277      0.000    1.01e+05    1.11e+05
const         -5.219e+05   1.57e+04    -33.342      0.000   -5.53e+05   -4.91e+05
==============================================================================
Omnibus:                    29676.557   Durbin-Watson:                   1.247
Prob(Omnibus):                  0.000   Jarque-Bera (JB):         19390738.346
Skew:                           6.889   Prob(JB):                         0.00
Kurtosis:                     145.559   Cond. No.                     2.86e+05
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
[2] The condition number is large, 2.86e+05. This might indicate that there are
strong multicollinearity or other numerical problems.</code></pre>
</div>
</div>
</section>
<section id="model-selection-and-stepwise-regression" class="level2">
<h2 class="anchored" data-anchor-id="model-selection-and-stepwise-regression">Model Selection and Stepwise Regression</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:56:08.155627Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:56:08.153459Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:56:08.201070Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:56:08.200179Z&quot;}" data-execution_count="14">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>predictors <span class="op">=</span> [<span class="st">'SqFtTotLiving'</span>, <span class="st">'SqFtLot'</span>, <span class="st">'Bathrooms'</span>, <span class="st">'Bedrooms'</span>,</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>              <span class="st">'BldgGrade'</span>, <span class="st">'PropertyType'</span>, <span class="st">'NbrLivingUnits'</span>,</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>              <span class="st">'SqFtFinBasement'</span>, <span class="st">'YrBuilt'</span>, <span class="st">'YrRenovated'</span>, </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>              <span class="st">'NewConstruction'</span>]</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> pd.get_dummies(house[predictors], drop_first<span class="op">=</span><span class="va">True</span>, dtype<span class="op">=</span><span class="bu">int</span>)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>X[<span class="st">'NewConstruction'</span>] <span class="op">=</span> [<span class="dv">1</span> <span class="cf">if</span> nc <span class="cf">else</span> <span class="dv">0</span> <span class="cf">for</span> nc <span class="kw">in</span> X[<span class="st">'NewConstruction'</span>]]</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>house_full <span class="op">=</span> sm.OLS(house[outcome], X.assign(const<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> house_full.fit()</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(results.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                            OLS Regression Results                            
==============================================================================
Dep. Variable:           AdjSalePrice   R-squared:                       0.595
Model:                            OLS   Adj. R-squared:                  0.594
Method:                 Least Squares   F-statistic:                     2771.
Date:                Tue, 23 May 2023   Prob (F-statistic):               0.00
Time:                        22:26:09   Log-Likelihood:            -3.1375e+05
No. Observations:               22687   AIC:                         6.275e+05
Df Residuals:                   22674   BIC:                         6.276e+05
Df Model:                          12                                         
Covariance Type:            nonrobust                                         
==============================================================================================
                                 coef    std err          t      P&gt;|t|      [0.025      0.975]
----------------------------------------------------------------------------------------------
SqFtTotLiving                198.6364      4.234     46.920      0.000     190.338     206.934
SqFtLot                        0.0771      0.058      1.330      0.184      -0.037       0.191
Bathrooms                   4.286e+04   3808.114     11.255      0.000    3.54e+04    5.03e+04
Bedrooms                   -5.187e+04   2396.904    -21.638      0.000   -5.66e+04   -4.72e+04
BldgGrade                   1.373e+05   2441.242     56.228      0.000    1.32e+05    1.42e+05
NbrLivingUnits              5723.8438   1.76e+04      0.326      0.744   -2.87e+04    4.01e+04
SqFtFinBasement                7.0611      4.627      1.526      0.127      -2.009      16.131
YrBuilt                    -3574.2210     77.228    -46.282      0.000   -3725.593   -3422.849
YrRenovated                   -2.5311      3.924     -0.645      0.519     -10.222       5.160
NewConstruction            -2489.1122   5936.692     -0.419      0.675   -1.41e+04    9147.211
PropertyType_Single Family  2.997e+04   2.61e+04      1.149      0.251   -2.12e+04    8.11e+04
PropertyType_Townhouse      9.286e+04    2.7e+04      3.438      0.001    3.99e+04    1.46e+05
const                       6.182e+06   1.55e+05     39.902      0.000    5.88e+06    6.49e+06
==============================================================================
Omnibus:                    31006.128   Durbin-Watson:                   1.393
Prob(Omnibus):                  0.000   Jarque-Bera (JB):         26251977.078
Skew:                           7.427   Prob(JB):                         0.00
Kurtosis:                     168.984   Cond. No.                     2.98e+06
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
[2] The condition number is large, 2.98e+06. This might indicate that there are
strong multicollinearity or other numerical problems.</code></pre>
</div>
</div>
<p>We can use the <code>stepwise_selection</code> method from the <em>dmba</em> package.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:56:08.207210Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:56:08.205495Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:56:08.894313Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:56:08.893197Z&quot;}" data-execution_count="15">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> house[outcome]</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> train_model(variables):</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(variables) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> LinearRegression()</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    model.fit(X[variables], y)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> model</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> score_model(model, variables):</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(variables) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> AIC_score(y, [y.mean()] <span class="op">*</span> <span class="bu">len</span>(y), model, df<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> AIC_score(y, model.predict(X[variables]), model)</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>best_model, best_variables <span class="op">=</span> stepwise_selection(X.columns, train_model, score_model, </span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>                                                verbose<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Intercept: </span><span class="sc">{</span>best_model<span class="sc">.</span>intercept_<span class="sc">:.3f}</span><span class="ss">'</span>)</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Coefficients:'</span>)</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, coef <span class="kw">in</span> <span class="bu">zip</span>(best_variables, best_model.coef_):</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f' </span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>coef<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Variables: SqFtTotLiving, SqFtLot, Bathrooms, Bedrooms, BldgGrade, NbrLivingUnits, SqFtFinBasement, YrBuilt, YrRenovated, NewConstruction, PropertyType_Single Family, PropertyType_Townhouse
Start: score=647988.32, constant
Step: score=633013.35, add SqFtTotLiving
Step: score=630793.74, add BldgGrade
Step: score=628230.29, add YrBuilt
Step: score=627784.16, add Bedrooms
Step: score=627602.21, add Bathrooms
Step: score=627525.65, add PropertyType_Townhouse
Step: score=627525.08, add SqFtFinBasement
Step: score=627524.98, add PropertyType_Single Family
Step: score=627524.98, unchanged None

Intercept: 6178645.017
Coefficients:
 SqFtTotLiving: 199.2775530420188
 BldgGrade: 137159.56022619782
 YrBuilt: -3565.4249392492984
 Bedrooms: -51947.38367361323
 Bathrooms: 42396.16452771774
 PropertyType_Townhouse: 84479.16203300416
 SqFtFinBasement: 7.046974967553979
 PropertyType_Single Family: 22912.055187017646</code></pre>
</div>
</div>
</section>
<section id="weighted-regression" class="level2">
<h2 class="anchored" data-anchor-id="weighted-regression">Weighted regression</h2>
<p>We can calculate the Year from the date column using either a list comprehension or the data frame’s <code>apply</code> method.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:56:08.900576Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:56:08.898874Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:56:08.940872Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:56:08.939879Z&quot;}" data-execution_count="16">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>house[<span class="st">'Year'</span>] <span class="op">=</span> [<span class="bu">int</span>(date.split(<span class="st">'-'</span>)[<span class="dv">0</span>]) <span class="cf">for</span> date <span class="kw">in</span> house.DocumentDate]</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>house[<span class="st">'Year'</span>] <span class="op">=</span> house.DocumentDate.<span class="bu">apply</span>(<span class="kw">lambda</span> d: <span class="bu">int</span>(d.split(<span class="st">'-'</span>)[<span class="dv">0</span>]))</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>house[<span class="st">'Weight'</span>] <span class="op">=</span> house.Year <span class="op">-</span> <span class="dv">2005</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:56:08.946589Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:56:08.945702Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:56:08.980607Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:56:08.979427Z&quot;}" data-execution_count="17">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>predictors <span class="op">=</span> [<span class="st">'SqFtTotLiving'</span>, <span class="st">'SqFtLot'</span>, <span class="st">'Bathrooms'</span>, </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>              <span class="st">'Bedrooms'</span>, <span class="st">'BldgGrade'</span>]</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>outcome <span class="op">=</span> <span class="st">'AdjSalePrice'</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>house_wt <span class="op">=</span> LinearRegression()</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>house_wt.fit(house[predictors], house[outcome], sample_weight<span class="op">=</span>house.Weight)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>pd.concat([</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    pd.DataFrame({</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">'predictor'</span>: predictors,</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">'house_lm'</span>: house_lm.coef_,</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">'house_wt'</span>: house_wt.coef_,    </span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>    }),</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>    pd.DataFrame({</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">'predictor'</span>: [<span class="st">'intercept'</span>],</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">'house_lm'</span>: house_lm.intercept_,</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">'house_wt'</span>: house_wt.intercept_,    </span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">predictor</th>
<th data-quarto-table-cell-role="th">house_lm</th>
<th data-quarto-table-cell-role="th">house_wt</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>SqFtTotLiving</td>
<td>228.830604</td>
<td>245.024089</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>SqFtLot</td>
<td>-0.060467</td>
<td>-0.292415</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Bathrooms</td>
<td>-19442.840398</td>
<td>-26085.970109</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Bedrooms</td>
<td>-47769.955185</td>
<td>-53608.876436</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>BldgGrade</td>
<td>106106.963079</td>
<td>115242.434726</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0</td>
<td>intercept</td>
<td>-521871.368188</td>
<td>-584189.329446</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:56:08.985129Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:56:08.984834Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:56:09.025619Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:56:09.024453Z&quot;}" data-execution_count="18">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>residuals <span class="op">=</span> pd.DataFrame({</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'abs_residual_lm'</span>: np.<span class="bu">abs</span>(house_lm.predict(house[predictors]) <span class="op">-</span> house[outcome]),</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'abs_residual_wt'</span>: np.<span class="bu">abs</span>(house_wt.predict(house[predictors]) <span class="op">-</span> house[outcome]),</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Year'</span>: house[<span class="st">'Year'</span>],</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(residuals.head())</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="co"># axes = residuals.boxplot(['abs_residual_lm', 'abs_residual_wt'], by='Year', figsize=(10, 4))</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="co"># axes[0].set_ylim(0, 300000)</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(([year, np.mean(group[<span class="st">'abs_residual_lm'</span>]), np.mean(group[<span class="st">'abs_residual_wt'</span>])] </span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>              <span class="cf">for</span> year, group <span class="kw">in</span> residuals.groupby(<span class="st">'Year'</span>)),</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>             columns<span class="op">=</span>[<span class="st">'Year'</span>, <span class="st">'mean abs_residual_lm'</span>, <span class="st">'mean abs_residual_wt'</span>])</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="co"># for year, group in residuals.groupby('Year'):</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a><span class="co">#     print(year, np.mean(group['abs_residual_lm']), np.mean(group['abs_residual_wt']))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   abs_residual_lm  abs_residual_wt  Year
1    123750.814194    107108.553965  2014
2     59145.413089     96191.882094  2006
3    190108.725716    187004.492880  2007
4    198788.774412    196132.996857  2008
5     91774.996129     84277.577512  2013</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="18">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Year</th>
<th data-quarto-table-cell-role="th">mean abs_residual_lm</th>
<th data-quarto-table-cell-role="th">mean abs_residual_wt</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2006</td>
<td>140540.303585</td>
<td>146557.454636</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2007</td>
<td>147747.577959</td>
<td>152848.523235</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2008</td>
<td>142086.905943</td>
<td>146360.411668</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2009</td>
<td>147016.720883</td>
<td>151182.924825</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2010</td>
<td>163267.674885</td>
<td>166364.476152</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>2011</td>
<td>169937.385744</td>
<td>172950.876028</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>2012</td>
<td>169506.670053</td>
<td>171874.424266</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>2013</td>
<td>203659.777510</td>
<td>206242.199403</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>2014</td>
<td>184452.840665</td>
<td>186668.573750</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>2015</td>
<td>172323.435147</td>
<td>169842.742053</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
<section id="factor-variables-in-regression" class="level1">
<h1>Factor variables in regression</h1>
<section id="dummy-variables-representation" class="level2">
<h2 class="anchored" data-anchor-id="dummy-variables-representation">Dummy Variables Representation</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:56:09.030898Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:56:09.030053Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:56:09.038247Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:56:09.037195Z&quot;}" data-execution_count="19">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(house.PropertyType.head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1        Multiplex
2    Single Family
3    Single Family
4    Single Family
5    Single Family
Name: PropertyType, dtype: object</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:56:09.044672Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:56:09.043079Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:56:09.052748Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:56:09.051719Z&quot;}" data-execution_count="20">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.get_dummies(house[<span class="st">'PropertyType'</span>]).head(<span class="dv">6</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Multiplex  Single Family  Townhouse
1       True          False      False
2      False           True      False
3      False           True      False
4      False           True      False
5      False           True      False
6      False          False       True</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:56:09.057059Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:56:09.056800Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:56:09.070761Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:56:09.069553Z&quot;}" data-execution_count="21">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.get_dummies(house[<span class="st">'PropertyType'</span>], drop_first<span class="op">=</span><span class="va">True</span>).head(<span class="dv">6</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Single Family  Townhouse
1          False      False
2           True      False
3           True      False
4           True      False
5           True      False
6          False       True</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:56:09.075661Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:56:09.075411Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:56:09.091280Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:56:09.090627Z&quot;}" data-execution_count="22">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>predictors <span class="op">=</span> [<span class="st">'SqFtTotLiving'</span>, <span class="st">'SqFtLot'</span>, <span class="st">'Bathrooms'</span>, <span class="st">'Bedrooms'</span>,</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>              <span class="st">'BldgGrade'</span>, <span class="st">'PropertyType'</span>]</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> pd.get_dummies(house[predictors], drop_first<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>house_lm_factor <span class="op">=</span> LinearRegression()</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>house_lm_factor.fit(X, house[outcome])</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Intercept: </span><span class="sc">{</span>house_lm_factor<span class="sc">.</span>intercept_<span class="sc">:.3f}</span><span class="ss">'</span>)</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Coefficients:'</span>)</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, coef <span class="kw">in</span> <span class="bu">zip</span>(X.columns, house_lm_factor.coef_):</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f' </span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>coef<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Intercept: -446841.366
Coefficients:
 SqFtTotLiving: 223.37362892503828
 SqFtLot: -0.07036798136813083
 Bathrooms: -15979.013473415205
 Bedrooms: -50889.73218483025
 BldgGrade: 109416.30516146179
 PropertyType_Single Family: -84678.21629549257
 PropertyType_Townhouse: -115121.97921609184</code></pre>
</div>
</div>
</section>
<section id="factor-variables-with-many-levels" class="level2">
<h2 class="anchored" data-anchor-id="factor-variables-with-many-levels">Factor Variables with many levels</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:56:09.095028Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:56:09.094649Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:56:09.105305Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:56:09.104193Z&quot;}" data-execution_count="23">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.DataFrame(house[<span class="st">'ZipCode'</span>].value_counts()).transpose())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ZipCode  98038  98103  98042  98115  98117  98052  98034  98033  98059  98074   
count      788    671    641    620    619    614    575    517    513    502  \

ZipCode  ...  98051  98024  98354  98050  98057  98288  98224  98068  98113   
count    ...     32     31      9      7      4      4      3      1      1  \

ZipCode  98043  
count        1  

[1 rows x 80 columns]</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:56:09.110270Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:56:09.109620Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:56:09.217143Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:56:09.216274Z&quot;}" data-execution_count="24">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>house <span class="op">=</span> pd.read_csv(HOUSE_CSV, sep<span class="op">=</span><span class="st">'</span><span class="ch">\t</span><span class="st">'</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>predictors <span class="op">=</span> [<span class="st">'SqFtTotLiving'</span>, <span class="st">'SqFtLot'</span>, <span class="st">'Bathrooms'</span>, </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>              <span class="st">'Bedrooms'</span>, <span class="st">'BldgGrade'</span>]</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>outcome <span class="op">=</span> <span class="st">'AdjSalePrice'</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>house_lm <span class="op">=</span> LinearRegression()</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>house_lm.fit(house[predictors], house[outcome])</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>zip_groups <span class="op">=</span> pd.DataFrame([</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>pd.DataFrame({</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">'ZipCode'</span>: house[<span class="st">'ZipCode'</span>],</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">'residual'</span> : house[outcome] <span class="op">-</span> house_lm.predict(house[predictors]),</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>    .groupby([<span class="st">'ZipCode'</span>])</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">apply</span>(<span class="kw">lambda</span> x: {</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">'ZipCode'</span>: x.iloc[<span class="dv">0</span>,<span class="dv">0</span>],</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">'count'</span>: <span class="bu">len</span>(x),</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">'median_residual'</span>: x.residual.median()</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>]).sort_values(<span class="st">'median_residual'</span>)</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>zip_groups[<span class="st">'cum_count'</span>] <span class="op">=</span> np.cumsum(zip_groups[<span class="st">'count'</span>])</span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>zip_groups[<span class="st">'ZipGroup'</span>] <span class="op">=</span> pd.qcut(zip_groups[<span class="st">'cum_count'</span>], <span class="dv">5</span>, labels<span class="op">=</span><span class="va">False</span>, retbins<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>zip_groups.head()</span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(zip_groups.ZipGroup.value_counts().sort_index())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ZipGroup
0    16
1    16
2    16
3    16
4    16
Name: count, dtype: int64</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:56:09.220428Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:56:09.220087Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:56:09.228817Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:56:09.227993Z&quot;}" data-execution_count="25">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>to_join <span class="op">=</span> zip_groups[[<span class="st">'ZipCode'</span>, <span class="st">'ZipGroup'</span>]].set_index(<span class="st">'ZipCode'</span>)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>house <span class="op">=</span> house.join(to_join, on<span class="op">=</span><span class="st">'ZipCode'</span>)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>house[<span class="st">'ZipGroup'</span>] <span class="op">=</span> house[<span class="st">'ZipGroup'</span>].astype(<span class="st">'category'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="interpreting-the-regression-equation" class="level1">
<h1>Interpreting the Regression Equation</h1>
<section id="correlated-predictors" class="level2">
<h2 class="anchored" data-anchor-id="correlated-predictors">Correlated predictors</h2>
<p>The results from the stepwise regression are.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:56:09.232380Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:56:09.232033Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:56:09.238291Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:56:09.237482Z&quot;}" data-execution_count="26">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Intercept: </span><span class="sc">{</span>best_model<span class="sc">.</span>intercept_<span class="sc">:.3f}</span><span class="ss">'</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Coefficients:'</span>)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, coef <span class="kw">in</span> <span class="bu">zip</span>(best_variables, best_model.coef_):</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f' </span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>coef<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Intercept: 6178645.017
Coefficients:
 SqFtTotLiving: 199.2775530420188
 BldgGrade: 137159.56022619782
 YrBuilt: -3565.4249392492984
 Bedrooms: -51947.38367361323
 Bathrooms: 42396.16452771774
 PropertyType_Townhouse: 84479.16203300416
 SqFtFinBasement: 7.046974967553979
 PropertyType_Single Family: 22912.055187017646</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:56:09.241911Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:56:09.241545Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:56:09.256464Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:56:09.255645Z&quot;}" data-execution_count="27">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>predictors <span class="op">=</span> [<span class="st">'Bedrooms'</span>, <span class="st">'BldgGrade'</span>, <span class="st">'PropertyType'</span>, <span class="st">'YrBuilt'</span>]</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>outcome <span class="op">=</span> <span class="st">'AdjSalePrice'</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> pd.get_dummies(house[predictors], drop_first<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>reduced_lm <span class="op">=</span> LinearRegression()</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>reduced_lm.fit(X, house[outcome])</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Intercept: </span><span class="sc">{</span>reduced_lm<span class="sc">.</span>intercept_<span class="sc">:.3f}</span><span class="ss">'</span>)</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Coefficients:'</span>)</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, coef <span class="kw">in</span> <span class="bu">zip</span>(X.columns, reduced_lm.coef_):</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f' </span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>coef<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Intercept: 4913973.344
Coefficients:
 Bedrooms: 27150.537230215377
 BldgGrade: 248997.79366213758
 YrBuilt: -3211.7448621550866
 PropertyType_Single Family: -19898.495340502435
 PropertyType_Townhouse: -47355.4368733449</code></pre>
</div>
</div>
</section>
<section id="confounding-variables" class="level2">
<h2 class="anchored" data-anchor-id="confounding-variables">Confounding variables</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:56:09.259914Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:56:09.259390Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:56:09.276840Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:56:09.276043Z&quot;}" data-scrolled="true" data-execution_count="28">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>predictors <span class="op">=</span> [<span class="st">'SqFtTotLiving'</span>, <span class="st">'SqFtLot'</span>, <span class="st">'Bathrooms'</span>, <span class="st">'Bedrooms'</span>,</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>              <span class="st">'BldgGrade'</span>, <span class="st">'PropertyType'</span>, <span class="st">'ZipGroup'</span>]</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>outcome <span class="op">=</span> <span class="st">'AdjSalePrice'</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> pd.get_dummies(house[predictors], drop_first<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>confounding_lm <span class="op">=</span> LinearRegression()</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>confounding_lm.fit(X, house[outcome])</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Intercept: </span><span class="sc">{</span>confounding_lm<span class="sc">.</span>intercept_<span class="sc">:.3f}</span><span class="ss">'</span>)</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Coefficients:'</span>)</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, coef <span class="kw">in</span> <span class="bu">zip</span>(X.columns, confounding_lm.coef_):</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f' </span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>coef<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Intercept: -666637.469
Coefficients:
 SqFtTotLiving: 210.61266005580154
 SqFtLot: 0.45498713854658845
 Bathrooms: 5928.42564000163
 Bedrooms: -41682.87184074476
 BldgGrade: 98541.18352725972
 PropertyType_Single Family: 19323.6252879192
 PropertyType_Townhouse: -78198.720927624
 ZipGroup_1: 53317.17330659817
 ZipGroup_2: 116251.58883563551
 ZipGroup_3: 178360.53178793378
 ZipGroup_4: 338408.60185652034</code></pre>
</div>
</div>
</section>
<section id="interactions-and-main-effects" class="level2">
<h2 class="anchored" data-anchor-id="interactions-and-main-effects">Interactions and Main Effects</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:56:09.280114Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:56:09.279683Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:56:09.383306Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:56:09.382454Z&quot;}" data-execution_count="29">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> smf.ols(formula<span class="op">=</span><span class="st">'AdjSalePrice ~  SqFtTotLiving*ZipGroup + SqFtLot + '</span> <span class="op">+</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>     <span class="st">'Bathrooms + Bedrooms + BldgGrade + PropertyType'</span>, data<span class="op">=</span>house)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> model.fit()</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(results.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                            OLS Regression Results                            
==============================================================================
Dep. Variable:           AdjSalePrice   R-squared:                       0.682
Model:                            OLS   Adj. R-squared:                  0.682
Method:                 Least Squares   F-statistic:                     3247.
Date:                Tue, 23 May 2023   Prob (F-statistic):               0.00
Time:                        22:26:11   Log-Likelihood:            -3.1098e+05
No. Observations:               22687   AIC:                         6.220e+05
Df Residuals:                   22671   BIC:                         6.221e+05
Df Model:                          15                                         
Covariance Type:            nonrobust                                         
=================================================================================================
                                    coef    std err          t      P&gt;|t|      [0.025      0.975]
-------------------------------------------------------------------------------------------------
Intercept                     -4.853e+05   2.05e+04    -23.701      0.000   -5.25e+05   -4.45e+05
ZipGroup[T.1]                 -1.113e+04   1.34e+04     -0.830      0.407   -3.74e+04    1.52e+04
ZipGroup[T.2]                  2.032e+04   1.18e+04      1.717      0.086   -2877.441    4.35e+04
ZipGroup[T.3]                   2.05e+04   1.21e+04      1.697      0.090   -3180.870    4.42e+04
ZipGroup[T.4]                 -1.499e+05   1.13e+04    -13.285      0.000   -1.72e+05   -1.28e+05
PropertyType[T.Single Family]  1.357e+04   1.39e+04      0.975      0.330   -1.37e+04    4.09e+04
PropertyType[T.Townhouse]     -5.884e+04   1.51e+04     -3.888      0.000   -8.85e+04   -2.92e+04
SqFtTotLiving                   114.7650      4.863     23.600      0.000     105.233     124.297
SqFtTotLiving:ZipGroup[T.1]      32.6043      5.712      5.708      0.000      21.409      43.799
SqFtTotLiving:ZipGroup[T.2]      41.7822      5.187      8.056      0.000      31.616      51.948
SqFtTotLiving:ZipGroup[T.3]      69.3415      5.619     12.341      0.000      58.329      80.354
SqFtTotLiving:ZipGroup[T.4]     226.6836      4.820     47.032      0.000     217.237     236.131
SqFtLot                           0.6869      0.052     13.296      0.000       0.586       0.788
Bathrooms                     -3619.4533   3202.296     -1.130      0.258   -9896.174    2657.267
Bedrooms                       -4.18e+04   2120.279    -19.715      0.000    -4.6e+04   -3.76e+04
BldgGrade                      1.047e+05   2069.472     50.592      0.000    1.01e+05    1.09e+05
==============================================================================
Omnibus:                    30927.394   Durbin-Watson:                   1.581
Prob(Omnibus):                  0.000   Jarque-Bera (JB):         34361794.502
Skew:                           7.279   Prob(JB):                         0.00
Kurtosis:                     193.101   Cond. No.                     5.80e+05
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
[2] The condition number is large, 5.8e+05. This might indicate that there are
strong multicollinearity or other numerical problems.</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>Results differ from R due to different binning. Enforcing the same binning gives identical results</p>
</blockquote>
</section>
</section>
<section id="testing-the-assumptions-regression-diagnostics" class="level1">
<h1>Testing the Assumptions: Regression Diagnostics</h1>
<section id="outliers" class="level2">
<h2 class="anchored" data-anchor-id="outliers">Outliers</h2>
<p>The <em>statsmodels</em> package has the most developed support for outlier analysis.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:56:09.387297Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:56:09.386934Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:56:09.404017Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:56:09.403142Z&quot;}" data-execution_count="30">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>house_98105 <span class="op">=</span> house.loc[house[<span class="st">'ZipCode'</span>] <span class="op">==</span> <span class="dv">98105</span>, ]</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>predictors <span class="op">=</span> [<span class="st">'SqFtTotLiving'</span>, <span class="st">'SqFtLot'</span>, <span class="st">'Bathrooms'</span>, <span class="st">'Bedrooms'</span>,</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>              <span class="st">'BldgGrade'</span>]</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>outcome <span class="op">=</span> <span class="st">'AdjSalePrice'</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>house_outlier <span class="op">=</span> sm.OLS(house_98105[outcome], house_98105[predictors].assign(const<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>result_98105 <span class="op">=</span> house_outlier.fit()</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(result_98105.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                            OLS Regression Results                            
==============================================================================
Dep. Variable:           AdjSalePrice   R-squared:                       0.795
Model:                            OLS   Adj. R-squared:                  0.792
Method:                 Least Squares   F-statistic:                     238.7
Date:                Tue, 23 May 2023   Prob (F-statistic):          1.69e-103
Time:                        22:26:11   Log-Likelihood:                -4226.0
No. Observations:                 313   AIC:                             8464.
Df Residuals:                     307   BIC:                             8486.
Df Model:                           5                                         
Covariance Type:            nonrobust                                         
=================================================================================
                    coef    std err          t      P&gt;|t|      [0.025      0.975]
---------------------------------------------------------------------------------
SqFtTotLiving   209.6023     24.408      8.587      0.000     161.574     257.631
SqFtLot          38.9333      5.330      7.305      0.000      28.445      49.421
Bathrooms      2282.2641      2e+04      0.114      0.909    -3.7e+04    4.16e+04
Bedrooms      -2.632e+04   1.29e+04     -2.043      0.042   -5.17e+04    -973.867
BldgGrade        1.3e+05   1.52e+04      8.533      0.000       1e+05     1.6e+05
const         -7.725e+05   9.83e+04     -7.861      0.000   -9.66e+05   -5.79e+05
==============================================================================
Omnibus:                       82.127   Durbin-Watson:                   1.508
Prob(Omnibus):                  0.000   Jarque-Bera (JB):              586.561
Skew:                           0.859   Prob(JB):                    4.26e-128
Kurtosis:                       9.483   Cond. No.                     5.63e+04
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
[2] The condition number is large, 5.63e+04. This might indicate that there are
strong multicollinearity or other numerical problems.</code></pre>
</div>
</div>
<p>The <code>OLSInfluence</code> class is initialized with the OLS regression results and gives access to a number of usefule properties. Here we use the studentized residuals.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:56:09.407982Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:56:09.407593Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:56:09.413264Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:56:09.412699Z&quot;}" data-execution_count="31">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>influence <span class="op">=</span> OLSInfluence(result_98105)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>sresiduals <span class="op">=</span> influence.resid_studentized_internal</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sresiduals.idxmin(), sresiduals.<span class="bu">min</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>24333 -4.326731804078564</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:56:09.416547Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:56:09.416168Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:56:09.421280Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:56:09.420293Z&quot;}" data-execution_count="32">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(result_98105.resid.loc[sresiduals.idxmin()])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>-757753.6192115829</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:56:09.425360Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:56:09.424846Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:56:09.432283Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:56:09.431700Z&quot;}" data-execution_count="33">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>outlier <span class="op">=</span> house_98105.loc[sresiduals.idxmin(), :]</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'AdjSalePrice'</span>, outlier[outcome])</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(outlier[predictors])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>AdjSalePrice 119748.0
SqFtTotLiving    2900
SqFtLot          7276
Bathrooms         3.0
Bedrooms            6
BldgGrade           7
Name: 24333, dtype: object</code></pre>
</div>
</div>
</section>
<section id="influential-values" class="level2">
<h2 class="anchored" data-anchor-id="influential-values">Influential values</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:56:09.435459Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:56:09.435106Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:56:09.566921Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:56:09.566008Z&quot;}" data-execution_count="34">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> linregress</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">5</span>)</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.random.normal(size<span class="op">=</span><span class="dv">25</span>)</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> <span class="op">-</span>x <span class="op">/</span> <span class="dv">5</span> <span class="op">+</span> np.random.normal(size<span class="op">=</span><span class="dv">25</span>)</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>x[<span class="dv">0</span>] <span class="op">=</span> <span class="dv">8</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>y[<span class="dv">0</span>] <span class="op">=</span> <span class="dv">8</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> abline(slope, intercept, ax):</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Calculate coordinates of a line based on slope and intercept"""</span></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>    x_vals <span class="op">=</span> np.array(ax.get_xlim())</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (x_vals, intercept <span class="op">+</span> slope <span class="op">*</span> x_vals)</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">4</span>))</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>ax.scatter(x, y)</span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>slope, intercept, _, _, _ <span class="op">=</span> linregress(x, y)</span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>ax.plot(<span class="op">*</span>abline(slope, intercept, ax))</span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>slope, intercept, _, _, _ <span class="op">=</span> linregress(x[<span class="dv">1</span>:], y[<span class="dv">1</span>:])</span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>ax.plot(<span class="op">*</span>abline(slope, intercept, ax), <span class="st">'--'</span>)</span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>ax.set_xlim(<span class="op">-</span><span class="fl">2.5</span>, <span class="fl">8.5</span>)</span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>ax.set_ylim(<span class="op">-</span><span class="fl">2.5</span>, <span class="fl">8.5</span>)</span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Chapter4-Regression_and_Prediction_files/figure-html/cell-35-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>The package <em>statsmodel</em> provides a number of plots to analyze the data point influence</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:56:09.570315Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:56:09.570144Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:56:09.711140Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:56:09.710365Z&quot;}" data-execution_count="35">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>influence <span class="op">=</span> OLSInfluence(result_98105)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">5</span>))</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>ax.axhline(<span class="op">-</span><span class="fl">2.5</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">'C1'</span>)</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>ax.axhline(<span class="fl">2.5</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">'C1'</span>)</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>ax.scatter(influence.hat_matrix_diag, influence.resid_studentized_internal, </span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>           s<span class="op">=</span><span class="dv">1000</span> <span class="op">*</span> np.sqrt(influence.cooks_distance[<span class="dv">0</span>]),</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>           alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'hat values'</span>)</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'studentized residuals'</span>)</span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Chapter4-Regression_and_Prediction_files/figure-html/cell-36-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:56:09.714179Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:56:09.713991Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:56:09.728517Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:56:09.727583Z&quot;}" data-execution_count="36">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>mask <span class="op">=</span> [dist <span class="op">&lt;</span> <span class="fl">.08</span> <span class="cf">for</span> dist <span class="kw">in</span> influence.cooks_distance[<span class="dv">0</span>]]</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>house_infl <span class="op">=</span> house_98105.loc[mask]</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>ols_infl <span class="op">=</span> sm.OLS(house_infl[outcome], house_infl[predictors].assign(const<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>result_infl <span class="op">=</span> ols_infl.fit()</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>pd.DataFrame({</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Original'</span>: result_98105.params,</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Influential removed'</span>: result_infl.params,</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="36">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Original</th>
<th data-quarto-table-cell-role="th">Influential removed</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">SqFtTotLiving</td>
<td>209.602346</td>
<td>230.052569</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">SqFtLot</td>
<td>38.933315</td>
<td>33.141600</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Bathrooms</td>
<td>2282.264145</td>
<td>-16131.879785</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Bedrooms</td>
<td>-26320.268796</td>
<td>-22887.865318</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">BldgGrade</td>
<td>130000.099737</td>
<td>114870.559737</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">const</td>
<td>-772549.862447</td>
<td>-647137.096716</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="heteroskedasticity-non-normality-and-correlated-errors" class="level2">
<h2 class="anchored" data-anchor-id="heteroskedasticity-non-normality-and-correlated-errors">Heteroskedasticity, Non-Normality and Correlated Errors</h2>
<p>The <code>regplot</code> in <em>seaborn</em> allows adding a lowess smoothing line to the scatterplot.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:56:09.731644Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:56:09.731416Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:56:09.882987Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:56:09.881840Z&quot;}" data-execution_count="37">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">5</span>))</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>sns.regplot(x<span class="op">=</span>result_98105.fittedvalues, y<span class="op">=</span>np.<span class="bu">abs</span>(result_98105.resid), </span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>            scatter_kws<span class="op">=</span>{<span class="st">'alpha'</span>: <span class="fl">0.25</span>},</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>            line_kws<span class="op">=</span>{<span class="st">'color'</span>: <span class="st">'C1'</span>},</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>            lowess<span class="op">=</span><span class="va">True</span>, ax<span class="op">=</span>ax)</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'predicted'</span>)</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'abs(residual)'</span>)</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Chapter4-Regression_and_Prediction_files/figure-html/cell-38-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:56:09.886052Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:56:09.885867Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:56:10.014810Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:56:10.014137Z&quot;}" data-execution_count="38">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">4</span>))</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>pd.Series(influence.resid_studentized_internal).hist(ax<span class="op">=</span>ax)</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'std. residual'</span>)</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Frequency'</span>)</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Chapter4-Regression_and_Prediction_files/figure-html/cell-39-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="partial-residual-plots-and-nonlinearity" class="level2">
<h2 class="anchored" data-anchor-id="partial-residual-plots-and-nonlinearity">Partial Residual Plots and Nonlinearity</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:56:10.017767Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:56:10.017593Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:56:10.151978Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:56:10.151139Z&quot;}" data-execution_count="39">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">5</span>))</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> sm.graphics.plot_ccpr(result_98105, <span class="st">'SqFtTotLiving'</span>, ax<span class="op">=</span>ax)</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Chapter4-Regression_and_Prediction_files/figure-html/cell-40-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:56:10.154840Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:56:10.154680Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:56:10.620170Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:56:10.619489Z&quot;}" data-execution_count="40">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">12</span>))</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> sm.graphics.plot_ccpr_grid(result_98105, fig<span class="op">=</span>fig)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Chapter4-Regression_and_Prediction_files/figure-html/cell-41-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="polynomial-and-spline-regression" class="level2">
<h2 class="anchored" data-anchor-id="polynomial-and-spline-regression">Polynomial and Spline Regression</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:56:10.623081Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:56:10.622864Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:56:10.645334Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:56:10.644553Z&quot;}" data-execution_count="41">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>model_poly <span class="op">=</span> smf.ols(formula<span class="op">=</span><span class="st">'AdjSalePrice ~  SqFtTotLiving + np.power(SqFtTotLiving, 2) + '</span> <span class="op">+</span> </span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>                <span class="st">'SqFtLot + Bathrooms + Bedrooms + BldgGrade'</span>, data<span class="op">=</span>house_98105)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>result_poly <span class="op">=</span> model_poly.fit()</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(result_poly.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                            OLS Regression Results                            
==============================================================================
Dep. Variable:           AdjSalePrice   R-squared:                       0.806
Model:                            OLS   Adj. R-squared:                  0.802
Method:                 Least Squares   F-statistic:                     211.6
Date:                Tue, 23 May 2023   Prob (F-statistic):          9.95e-106
Time:                        22:26:12   Log-Likelihood:                -4217.9
No. Observations:                 313   AIC:                             8450.
Df Residuals:                     306   BIC:                             8476.
Df Model:                           6                                         
Covariance Type:            nonrobust                                         
==============================================================================================
                                 coef    std err          t      P&gt;|t|      [0.025      0.975]
----------------------------------------------------------------------------------------------
Intercept                  -6.159e+05   1.03e+05     -5.953      0.000   -8.19e+05   -4.12e+05
SqFtTotLiving                  7.4521     55.418      0.134      0.893    -101.597     116.501
np.power(SqFtTotLiving, 2)     0.0388      0.010      4.040      0.000       0.020       0.058
SqFtLot                       32.5594      5.436      5.990      0.000      21.863      43.256
Bathrooms                  -1435.1231   1.95e+04     -0.074      0.941   -3.99e+04     3.7e+04
Bedrooms                   -9191.9441   1.33e+04     -0.693      0.489   -3.53e+04    1.69e+04
BldgGrade                   1.357e+05   1.49e+04      9.087      0.000    1.06e+05    1.65e+05
==============================================================================
Omnibus:                       75.161   Durbin-Watson:                   1.625
Prob(Omnibus):                  0.000   Jarque-Bera (JB):              637.978
Skew:                           0.699   Prob(JB):                    2.92e-139
Kurtosis:                       9.853   Cond. No.                     7.37e+07
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
[2] The condition number is large, 7.37e+07. This might indicate that there are
strong multicollinearity or other numerical problems.</code></pre>
</div>
</div>
<p>The statsmodels implementation of a partial residual plot works only for linear term. Here is an implementation of a partial residual plot that, while inefficient, works for the polynomial regression.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:56:10.647987Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:56:10.647827Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:56:10.826999Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:56:10.826183Z&quot;}" data-execution_count="42">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> partialResidualPlot(model, df, outcome, feature, ax):</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>    y_pred <span class="op">=</span> model.predict(df)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>    copy_df <span class="op">=</span> df.copy()</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> c <span class="kw">in</span> copy_df.columns:</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> c <span class="op">==</span> feature:</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>        copy_df[c] <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>    feature_prediction <span class="op">=</span> model.predict(copy_df)</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> pd.DataFrame({</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">'feature'</span>: df[feature],</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">'residual'</span>: df[outcome] <span class="op">-</span> y_pred,</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">'ypartial'</span>: feature_prediction <span class="op">-</span> model.params[<span class="dv">0</span>],</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> results.sort_values(by<span class="op">=</span>[<span class="st">'feature'</span>])</span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>    smoothed <span class="op">=</span> sm.nonparametric.lowess(results.ypartial, results.feature, frac<span class="op">=</span><span class="dv">1</span><span class="op">/</span><span class="dv">3</span>)</span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a>    ax.scatter(results.feature, results.ypartial <span class="op">+</span> results.residual)</span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>    ax.plot(smoothed[:, <span class="dv">0</span>], smoothed[:, <span class="dv">1</span>], color<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>    ax.plot(results.feature, results.ypartial, color<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(feature)</span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a>    ax.set_ylabel(<span class="ss">f'Residual + </span><span class="sc">{</span>feature<span class="sc">}</span><span class="ss"> contribution'</span>)</span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ax</span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">5</span>))</span>
<span id="cb66-25"><a href="#cb66-25" aria-hidden="true" tabindex="-1"></a>partialResidualPlot(result_poly, house_98105, <span class="st">'AdjSalePrice'</span>, <span class="st">'SqFtTotLiving'</span>, ax)</span>
<span id="cb66-26"><a href="#cb66-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-27"><a href="#cb66-27" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb66-28"><a href="#cb66-28" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb66-29"><a href="#cb66-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(result_poly.params[<span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Chapter4-Regression_and_Prediction_files/figure-html/cell-43-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>0.0387912816823115</code></pre>
</div>
</div>
</section>
<section id="splines" class="level2">
<h2 class="anchored" data-anchor-id="splines">Splines</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:56:10.829628Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:56:10.829471Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:56:10.936519Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:56:10.935470Z&quot;}" data-execution_count="43">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>formula <span class="op">=</span> (<span class="st">'AdjSalePrice ~ bs(SqFtTotLiving, df=6, degree=3) + '</span> <span class="op">+</span> </span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>           <span class="st">'SqFtLot + Bathrooms + Bedrooms + BldgGrade'</span>)</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>model_spline <span class="op">=</span> smf.ols(formula<span class="op">=</span>formula, data<span class="op">=</span>house_98105)</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>result_spline <span class="op">=</span> model_spline.fit()</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(result_spline.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                            OLS Regression Results                            
==============================================================================
Dep. Variable:           AdjSalePrice   R-squared:                       0.814
Model:                            OLS   Adj. R-squared:                  0.807
Method:                 Least Squares   F-statistic:                     131.8
Date:                Tue, 23 May 2023   Prob (F-statistic):          7.10e-104
Time:                        22:26:13   Log-Likelihood:                -4211.4
No. Observations:                 313   AIC:                             8445.
Df Residuals:                     302   BIC:                             8486.
Df Model:                          10                                         
Covariance Type:            nonrobust                                         
========================================================================================================
                                           coef    std err          t      P&gt;|t|      [0.025      0.975]
--------------------------------------------------------------------------------------------------------
Intercept                            -4.142e+05   1.43e+05     -2.899      0.004   -6.95e+05   -1.33e+05
bs(SqFtTotLiving, df=6, degree=3)[0] -1.995e+05   1.86e+05     -1.076      0.283   -5.65e+05    1.66e+05
bs(SqFtTotLiving, df=6, degree=3)[1] -1.206e+05   1.23e+05     -0.983      0.326   -3.62e+05    1.21e+05
bs(SqFtTotLiving, df=6, degree=3)[2] -7.164e+04   1.36e+05     -0.525      0.600    -3.4e+05    1.97e+05
bs(SqFtTotLiving, df=6, degree=3)[3]  1.957e+05   1.62e+05      1.212      0.227   -1.22e+05    5.14e+05
bs(SqFtTotLiving, df=6, degree=3)[4]  8.452e+05   2.18e+05      3.878      0.000    4.16e+05    1.27e+06
bs(SqFtTotLiving, df=6, degree=3)[5]  6.955e+05   2.14e+05      3.255      0.001    2.75e+05    1.12e+06
SqFtLot                                 33.3258      5.454      6.110      0.000      22.592      44.059
Bathrooms                            -4778.2080   1.94e+04     -0.246      0.806    -4.3e+04    3.34e+04
Bedrooms                             -5778.7045   1.32e+04     -0.437      0.663   -3.18e+04    2.03e+04
BldgGrade                             1.345e+05   1.52e+04      8.842      0.000    1.05e+05    1.64e+05
==============================================================================
Omnibus:                       58.816   Durbin-Watson:                   1.633
Prob(Omnibus):                  0.000   Jarque-Bera (JB):              622.021
Skew:                           0.330   Prob(JB):                    8.51e-136
Kurtosis:                       9.874   Cond. No.                     1.97e+05
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
[2] The condition number is large, 1.97e+05. This might indicate that there are
strong multicollinearity or other numerical problems.</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:56:10.940134Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:56:10.939905Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:56:11.136569Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:56:11.135874Z&quot;}" data-execution_count="44">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">5</span>))</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>partialResidualPlot(result_spline, house_98105, <span class="st">'AdjSalePrice'</span>, <span class="st">'SqFtTotLiving'</span>, ax)</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Chapter4-Regression_and_Prediction_files/figure-html/cell-45-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="generalized-additive-models" class="level2">
<h2 class="anchored" data-anchor-id="generalized-additive-models">Generalized Additive Models</h2>
<section id="using-statsmodels" class="level3">
<h3 class="anchored" data-anchor-id="using-statsmodels">Using statsmodels</h3>
<div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.gam.api <span class="im">import</span> GLMGam, BSplines</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>predictors <span class="op">=</span> [<span class="st">'SqFtTotLiving'</span>, <span class="st">'SqFtLot'</span>, <span class="st">'Bathrooms'</span>, <span class="st">'Bedrooms'</span>, <span class="st">'BldgGrade'</span>]</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>outcome <span class="op">=</span> <span class="st">'AdjSalePrice'</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>x_spline <span class="op">=</span> house_98105[predictors]</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>bs <span class="op">=</span> BSplines(x_spline, df<span class="op">=</span>[<span class="dv">10</span>] <span class="op">+</span> [<span class="dv">3</span>] <span class="op">*</span> <span class="dv">4</span>, degree<span class="op">=</span>[<span class="dv">3</span>] <span class="op">+</span> [<span class="dv">2</span>] <span class="op">*</span> <span class="dv">4</span>)</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a><span class="co"># penalization weight</span></span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span> np.array([<span class="dv">0</span>] <span class="op">*</span> <span class="dv">5</span>)</span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>formula <span class="op">=</span> (<span class="st">'AdjSalePrice ~ SqFtTotLiving + '</span> <span class="op">+</span> </span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>           <span class="st">'SqFtLot + Bathrooms + Bedrooms + BldgGrade'</span>)</span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>gam_sm <span class="op">=</span> GLMGam.from_formula(formula, data<span class="op">=</span>house_98105, smoother<span class="op">=</span>bs, alpha<span class="op">=</span>alpha)</span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a>res_sm <span class="op">=</span> gam_sm.fit()</span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(res_sm.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 Generalized Linear Model Regression Results                  
==============================================================================
Dep. Variable:           AdjSalePrice   No. Observations:                  313
Model:                         GLMGam   Df Residuals:                      295
Model Family:                Gaussian   Df Model:                        17.00
Link Function:               Identity   Scale:                      2.7471e+10
Method:                         PIRLS   Log-Likelihood:                -4196.6
Date:                Tue, 23 May 2023   Deviance:                   8.1039e+12
Time:                        22:26:13   Pearson chi2:                 8.10e+12
No. Iterations:                     3   Pseudo R-squ. (CS):             0.9901
Covariance Type:            nonrobust                                         
====================================================================================
                       coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------------
Intercept        -3.481e+05   1.18e+05     -2.962      0.003   -5.79e+05   -1.18e+05
SqFtTotLiving      192.1472     50.663      3.793      0.000      92.849     291.446
SqFtLot              6.9002      7.654      0.902      0.367      -8.101      21.902
Bathrooms        -7836.2808   2.12e+04     -0.370      0.712   -4.94e+04    3.37e+04
Bedrooms         -8297.4370   1.26e+04     -0.660      0.509   -3.29e+04    1.63e+04
BldgGrade         1.014e+05    1.4e+04      7.249      0.000     7.4e+04    1.29e+05
SqFtTotLiving_s0  1.465e+05   2.34e+05      0.626      0.531   -3.12e+05    6.05e+05
SqFtTotLiving_s1 -6.174e+04   1.33e+05     -0.464      0.642   -3.22e+05    1.99e+05
SqFtTotLiving_s2 -3.186e+04   1.26e+05     -0.253      0.800   -2.78e+05    2.15e+05
SqFtTotLiving_s3 -5.403e+04   1.01e+05     -0.535      0.593   -2.52e+05    1.44e+05
SqFtTotLiving_s4 -1.182e+05   1.01e+05     -1.167      0.243   -3.17e+05    8.03e+04
SqFtTotLiving_s5 -1.295e+05   8.23e+04     -1.574      0.115   -2.91e+05    3.17e+04
SqFtTotLiving_s6 -3.014e+04   1.27e+05     -0.237      0.813    -2.8e+05     2.2e+05
SqFtTotLiving_s7  1.262e+05    1.8e+05      0.702      0.483   -2.26e+05    4.79e+05
SqFtTotLiving_s8  5.325e+04   1.38e+05      0.386      0.700   -2.17e+05    3.24e+05
SqFtLot_s0        5.775e+05   1.58e+05      3.651      0.000    2.68e+05    8.88e+05
SqFtLot_s1       -2.771e+05   7.86e+04     -3.526      0.000   -4.31e+05   -1.23e+05
Bathrooms_s0      3.723e+04   1.06e+05      0.351      0.726   -1.71e+05    2.45e+05
Bathrooms_s1      5.303e+04   5.94e+04      0.892      0.372   -6.35e+04     1.7e+05
Bedrooms_s0       2.298e+05   1.31e+05      1.751      0.080   -2.74e+04    4.87e+05
Bedrooms_s1      -7.241e+04   6.81e+04     -1.063      0.288   -2.06e+05    6.11e+04
BldgGrade_s0     -7.953e+05   2.03e+05     -3.917      0.000   -1.19e+06   -3.97e+05
BldgGrade_s1      6.608e+05   1.14e+05      5.818      0.000    4.38e+05    8.83e+05
====================================================================================</code></pre>
</div>
</div>
<div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>res_sm.plot_partial(<span class="dv">0</span>, cpr<span class="op">=</span><span class="va">True</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Chapter4-Regression_and_Prediction_files/figure-html/cell-47-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="using-pygam" class="level3">
<h3 class="anchored" data-anchor-id="using-pygam">Using pyGAM</h3>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:56:11.139860Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:56:11.139565Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:56:11.307197Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:56:11.305892Z&quot;}" data-execution_count="47">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>predictors <span class="op">=</span> [<span class="st">'SqFtTotLiving'</span>, <span class="st">'SqFtLot'</span>, <span class="st">'Bathrooms'</span>, </span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>              <span class="st">'Bedrooms'</span>, <span class="st">'BldgGrade'</span>]</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>outcome <span class="op">=</span> <span class="st">'AdjSalePrice'</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> house_98105[predictors].values</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> house_98105[outcome]</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a><span class="co">## model</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>gam <span class="op">=</span> LinearGAM(s(<span class="dv">0</span>, n_splines<span class="op">=</span><span class="dv">12</span>) <span class="op">+</span> l(<span class="dv">1</span>) <span class="op">+</span> l(<span class="dv">2</span>) <span class="op">+</span> l(<span class="dv">3</span>) <span class="op">+</span> l(<span class="dv">4</span>))</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>gam.gridsearch(X, y)</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(gam.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>100% (11 of 11) |########################| Elapsed Time: 0:00:00 Time:  0:00:00
/tmp/ipykernel_63/661170992.py:10: UserWarning: KNOWN BUG: p-values computed in this summary are likely much smaller than they should be. 
 
Please do not make inferences based on these values! 

Collaborate on a solution, and stay up to date at: 
github.com/dswah/pyGAM/issues/163 

  print(gam.summary())</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>LinearGAM                                                                                                 
=============================================== ==========================================================
Distribution:                        NormalDist Effective DoF:                                      7.6772
Link Function:                     IdentityLink Log Likelihood:                                 -7833.1159
Number of Samples:                          313 AIC:                                            15683.5863
                                                AICc:                                             15684.14
                                                GCV:                                      30838885095.1676
                                                Scale:                                    29480381715.8292
                                                Pseudo R-Squared:                                   0.8117
==========================================================================================================
Feature Function                  Lambda               Rank         EDoF         P &gt; x        Sig. Code   
================================= ==================== ============ ============ ============ ============
s(0)                              [15.8489]            12           4.3          1.11e-16     ***         
l(1)                              [15.8489]            1            0.9          2.35e-10     ***         
l(2)                              [15.8489]            1            0.8          8.45e-01                 
l(3)                              [15.8489]            1            0.9          3.79e-01                 
l(4)                              [15.8489]            1            0.8          1.11e-16     ***         
intercept                                              1            0.0          9.14e-01                 
==========================================================================================================
Significance codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

WARNING: Fitting splines and a linear function to a feature introduces a model identifiability problem
         which can cause p-values to appear significant when they are not.

WARNING: p-values calculated in this manner behave correctly for un-penalized models or models with
         known smoothing parameters, but when smoothing parameters have been estimated, the p-values
         are typically lower than they should be, meaning that the tests reject the null too readily.
None</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:56:11.310781Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:56:11.310557Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:56:11.815299Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:56:11.814418Z&quot;}" data-execution_count="48">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">8</span>), ncols<span class="op">=</span><span class="dv">2</span>, nrows<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>titles <span class="op">=</span> [<span class="st">'SqFtTotLiving'</span>, <span class="st">'SqFtLot'</span>, <span class="st">'Bathrooms'</span>, <span class="st">'Bedrooms'</span>, <span class="st">'BldgGrade'</span>]</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, title <span class="kw">in</span> <span class="bu">enumerate</span>(titles):</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> axes[i <span class="op">//</span> <span class="dv">2</span>, i <span class="op">%</span> <span class="dv">2</span>]</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>    XX <span class="op">=</span> gam.generate_X_grid(term<span class="op">=</span>i)</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>    ax.plot(XX[:, i], gam.partial_dependence(term<span class="op">=</span>i, X<span class="op">=</span>XX))</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>    ax.plot(XX[:, i], gam.partial_dependence(term<span class="op">=</span>i, X<span class="op">=</span>XX, width<span class="op">=</span><span class="fl">.95</span>)[<span class="dv">1</span>], c<span class="op">=</span><span class="st">'r'</span>, ls<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>    ax.set_title(titles[i])<span class="op">;</span></span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>][<span class="dv">1</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Chapter4-Regression_and_Prediction_files/figure-html/cell-49-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
</section>
<section id="additional-material---not-in-book" class="level1">
<h1>Additional material - not in book</h1>
</section>
<section id="regularization" class="level1">
<h1>Regularization</h1>
<section id="lasso" class="level2">
<h2 class="anchored" data-anchor-id="lasso">Lasso</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:56:11.818542Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:56:11.818285Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:56:11.822331Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:56:11.821601Z&quot;}" data-execution_count="49">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> Lasso, LassoLars, LassoCV, LassoLarsCV</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:56:11.825293Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:56:11.825039Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:56:11.883986Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:56:11.882644Z&quot;}" data-execution_count="50">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>subset <span class="op">=</span> [<span class="st">'AdjSalePrice'</span>, <span class="st">'SqFtTotLiving'</span>, <span class="st">'SqFtLot'</span>, <span class="st">'Bathrooms'</span>, </span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>          <span class="st">'Bedrooms'</span>, <span class="st">'BldgGrade'</span>]</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>house <span class="op">=</span> pd.read_csv(HOUSE_CSV, sep<span class="op">=</span><span class="st">'</span><span class="ch">\t</span><span class="st">'</span>)</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(house[subset].head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   AdjSalePrice  SqFtTotLiving  SqFtLot  Bathrooms  Bedrooms  BldgGrade
1      300805.0           2400     9373       3.00         6          7
2     1076162.0           3764    20156       3.75         4         10
3      761805.0           2060    26036       1.75         4          8
4      442065.0           3200     8618       3.75         5          7
5      297065.0           1720     8620       1.75         4          7</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:56:11.887063Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:56:11.886857Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:56:11.912149Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:56:11.911244Z&quot;}" data-execution_count="51">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>predictors <span class="op">=</span> [<span class="st">'SqFtTotLiving'</span>, <span class="st">'SqFtLot'</span>, <span class="st">'Bathrooms'</span>, <span class="st">'Bedrooms'</span>,</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>              <span class="st">'BldgGrade'</span>, <span class="st">'PropertyType'</span>, <span class="st">'NbrLivingUnits'</span>,</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>              <span class="st">'SqFtFinBasement'</span>, <span class="st">'YrBuilt'</span>, <span class="st">'YrRenovated'</span>, </span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>              <span class="st">'NewConstruction'</span>]</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>outcome <span class="op">=</span> <span class="st">'AdjSalePrice'</span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> pd.get_dummies(house[predictors], drop_first<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>X[<span class="st">'NewConstruction'</span>] <span class="op">=</span> [<span class="dv">1</span> <span class="cf">if</span> nc <span class="cf">else</span> <span class="dv">0</span> <span class="cf">for</span> nc <span class="kw">in</span> X[<span class="st">'NewConstruction'</span>]]</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>columns <span class="op">=</span> X.columns</span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a><span class="co"># X = StandardScaler().fit_transform(X * 1.0)</span></span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> house[outcome]</span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>house_lm <span class="op">=</span> LinearRegression()</span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(house_lm.fit(X, y))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>LinearRegression()</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:56:11.915781Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:56:11.915556Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:56:11.970281Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:56:11.968996Z&quot;}" data-execution_count="52">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>house_lasso <span class="op">=</span> Lasso(alpha<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(house_lasso.fit(X, y))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Lasso(alpha=10)</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:56:11.975061Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:56:11.973890Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:56:12.580755Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:56:12.580040Z&quot;}" data-execution_count="53">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>Method <span class="op">=</span> LassoLars</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>MethodCV <span class="op">=</span> LassoLarsCV</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>Method <span class="op">=</span> Lasso</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>MethodCV <span class="op">=</span> LassoCV</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>alpha_values <span class="op">=</span> []</span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> []</span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> alpha <span class="kw">in</span> [<span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">100</span>, <span class="dv">1000</span>, <span class="dv">10000</span>, <span class="dv">100000</span>, <span class="dv">1000000</span>, <span class="dv">10000000</span>]:</span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> Method(alpha<span class="op">=</span>alpha)</span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>    model.fit(X, y)</span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a>    alpha_values.append(alpha)</span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a>    results.append(model.coef_)</span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a>modelCV <span class="op">=</span> MethodCV(cv<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a>modelCV.fit(X, y)</span>
<span id="cb85-15"><a href="#cb85-15" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> pd.DataFrame(results, index<span class="op">=</span>alpha_values, columns<span class="op">=</span>columns).plot(logx<span class="op">=</span><span class="va">True</span>, legend<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb85-16"><a href="#cb85-16" aria-hidden="true" tabindex="-1"></a>ax.axvline(modelCV.alpha_)</span>
<span id="cb85-17"><a href="#cb85-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Chapter4-Regression_and_Prediction_files/figure-html/cell-54-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:56:12.583354Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:56:12.583179Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:56:12.591183Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:56:12.590579Z&quot;}" data-execution_count="54">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame({</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'name'</span>: columns,</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'coef'</span>: modelCV.coef_, </span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="54">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">coef</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>SqFtTotLiving</td>
<td>289.048846</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>SqFtLot</td>
<td>0.029471</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Bathrooms</td>
<td>0.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Bedrooms</td>
<td>-0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>BldgGrade</td>
<td>0.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>NbrLivingUnits</td>
<td>-0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>SqFtFinBasement</td>
<td>3.316479</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>YrBuilt</td>
<td>-0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>YrRenovated</td>
<td>45.727472</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>NewConstruction</td>
<td>-0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>PropertyType_Single Family</td>
<td>-0.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>PropertyType_Townhouse</td>
<td>0.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:56:12.594193Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:56:12.593979Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:56:12.597523Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:56:12.596762Z&quot;}" data-execution_count="55">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Intercept: 6177658.144</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Coefficients:</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="co">#  SqFtTotLiving: 199.27474217544048</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a><span class="co">#  BldgGrade: 137181.13724627026</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a><span class="co">#  YrBuilt: -3564.934870415041</span></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a><span class="co">#  Bedrooms: -51974.76845567939</span></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a><span class="co">#  Bathrooms: 42403.059999677665</span></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a><span class="co">#  PropertyType_Townhouse: 84378.9333363999</span></span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a><span class="co">#  SqFtFinBasement: 7.032178917565108</span></span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a><span class="co">#  PropertyType_Single Family: 22854.87954019308</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>