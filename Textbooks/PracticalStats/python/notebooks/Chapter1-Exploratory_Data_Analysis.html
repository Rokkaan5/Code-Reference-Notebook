<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Chapter 1 - Exploratory Data Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Chapter1-Exploratory_Data_Analysis_files/libs/clipboard/clipboard.min.js"></script>
<script src="Chapter1-Exploratory_Data_Analysis_files/libs/quarto-html/quarto.js"></script>
<script src="Chapter1-Exploratory_Data_Analysis_files/libs/quarto-html/popper.min.js"></script>
<script src="Chapter1-Exploratory_Data_Analysis_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Chapter1-Exploratory_Data_Analysis_files/libs/quarto-html/anchor.min.js"></script>
<link href="Chapter1-Exploratory_Data_Analysis_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Chapter1-Exploratory_Data_Analysis_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Chapter1-Exploratory_Data_Analysis_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Chapter1-Exploratory_Data_Analysis_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Chapter1-Exploratory_Data_Analysis_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#practical-statistics-for-data-scientists-python" id="toc-practical-statistics-for-data-scientists-python" class="nav-link active" data-scroll-target="#practical-statistics-for-data-scientists-python">Practical Statistics for Data Scientists (Python)</a></li>
  <li><a href="#estimates-of-location" id="toc-estimates-of-location" class="nav-link" data-scroll-target="#estimates-of-location">Estimates of Location</a>
  <ul class="collapse">
  <li><a href="#example-location-estimates-of-population-and-murder-rates" id="toc-example-location-estimates-of-population-and-murder-rates" class="nav-link" data-scroll-target="#example-location-estimates-of-population-and-murder-rates">Example: Location Estimates of Population and Murder Rates</a></li>
  </ul></li>
  <li><a href="#estimates-of-variability" id="toc-estimates-of-variability" class="nav-link" data-scroll-target="#estimates-of-variability">Estimates of Variability</a>
  <ul class="collapse">
  <li><a href="#percentiles-and-boxplots" id="toc-percentiles-and-boxplots" class="nav-link" data-scroll-target="#percentiles-and-boxplots">Percentiles and Boxplots</a></li>
  <li><a href="#frequency-table-and-histograms" id="toc-frequency-table-and-histograms" class="nav-link" data-scroll-target="#frequency-table-and-histograms">Frequency Table and Histograms</a></li>
  <li><a href="#density-estimates" id="toc-density-estimates" class="nav-link" data-scroll-target="#density-estimates">Density Estimates</a></li>
  </ul></li>
  <li><a href="#exploring-binary-and-categorical-data" id="toc-exploring-binary-and-categorical-data" class="nav-link" data-scroll-target="#exploring-binary-and-categorical-data">Exploring Binary and Categorical Data</a></li>
  <li><a href="#correlation" id="toc-correlation" class="nav-link" data-scroll-target="#correlation">Correlation</a>
  <ul class="collapse">
  <li><a href="#scatterplots" id="toc-scatterplots" class="nav-link" data-scroll-target="#scatterplots">Scatterplots</a></li>
  </ul></li>
  <li><a href="#exploring-two-or-more-variables" id="toc-exploring-two-or-more-variables" class="nav-link" data-scroll-target="#exploring-two-or-more-variables">Exploring Two or More Variables</a>
  <ul class="collapse">
  <li><a href="#hexagonal-binning-and-contours" id="toc-hexagonal-binning-and-contours" class="nav-link" data-scroll-target="#hexagonal-binning-and-contours">Hexagonal binning and Contours</a>
  <ul class="collapse">
  <li><a href="#plotting-numeric-versus-numeric-data" id="toc-plotting-numeric-versus-numeric-data" class="nav-link" data-scroll-target="#plotting-numeric-versus-numeric-data">Plotting numeric versus numeric data</a></li>
  </ul></li>
  <li><a href="#two-categorical-variables" id="toc-two-categorical-variables" class="nav-link" data-scroll-target="#two-categorical-variables">Two Categorical Variables</a></li>
  <li><a href="#categorical-and-numeric-data" id="toc-categorical-and-numeric-data" class="nav-link" data-scroll-target="#categorical-and-numeric-data">Categorical and Numeric Data</a></li>
  <li><a href="#visualizing-multiple-variables" id="toc-visualizing-multiple-variables" class="nav-link" data-scroll-target="#visualizing-multiple-variables">Visualizing Multiple Variables</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Chapter 1 - Exploratory Data Analysis</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="practical-statistics-for-data-scientists-python" class="level1">
<h1>Practical Statistics for Data Scientists (Python)</h1>
<blockquote class="blockquote">
<ol start="3" type="a">
<li>2019 Peter C. Bruce, Andrew Bruce, Peter Gedeck</li>
</ol>
</blockquote>
<p>Import required Python packages.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:41:32.294296Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:41:32.293278Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:41:34.654458Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:41:34.653515Z&quot;}" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> trim_mean</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels <span class="im">import</span> robust</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> wquantiles</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pylab <span class="im">as</span> plt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:41:34.658338Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:41:34.658135Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:41:35.666930Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:41:35.666004Z&quot;}" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> common</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    DATA <span class="op">=</span> common.dataDirectory()</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">ImportError</span>:</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    DATA <span class="op">=</span> Path().resolve() <span class="op">/</span> <span class="st">'data'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Define paths to data sets. If you don’t keep your data in the same directory as the code, adapt the path names.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:41:35.671310Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:41:35.671080Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:41:35.675307Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:41:35.674572Z&quot;}" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>AIRLINE_STATS_CSV <span class="op">=</span> DATA <span class="op">/</span> <span class="st">'airline_stats.csv'</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>KC_TAX_CSV <span class="op">=</span> DATA <span class="op">/</span> <span class="st">'kc_tax.csv.gz'</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>LC_LOANS_CSV <span class="op">=</span> DATA <span class="op">/</span> <span class="st">'lc_loans.csv'</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>AIRPORT_DELAYS_CSV <span class="op">=</span> DATA <span class="op">/</span> <span class="st">'dfw_airline.csv'</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>SP500_DATA_CSV <span class="op">=</span> DATA <span class="op">/</span> <span class="st">'sp500_data.csv.gz'</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>SP500_SECTORS_CSV <span class="op">=</span> DATA <span class="op">/</span> <span class="st">'sp500_sectors.csv'</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>STATE_CSV <span class="op">=</span> DATA <span class="op">/</span> <span class="st">'state.csv'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="estimates-of-location" class="level1">
<h1>Estimates of Location</h1>
<section id="example-location-estimates-of-population-and-murder-rates" class="level2">
<h2 class="anchored" data-anchor-id="example-location-estimates-of-population-and-murder-rates">Example: Location Estimates of Population and Murder Rates</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:41:35.678420Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:41:35.678202Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:41:35.691453Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:41:35.690552Z&quot;}" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 1-2</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> pd.read_csv(STATE_CSV)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(state.head(<span class="dv">8</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         State  Population  Murder.Rate Abbreviation
0      Alabama     4779736          5.7           AL
1       Alaska      710231          5.6           AK
2      Arizona     6392017          4.7           AZ
3     Arkansas     2915918          5.6           AR
4   California    37253956          4.4           CA
5     Colorado     5029196          2.8           CO
6  Connecticut     3574097          2.4           CT
7     Delaware      897934          5.8           DE</code></pre>
</div>
</div>
<p>Compute the mean, trimmed mean, and median for Population. For <code>mean</code> and <code>median</code> we can use the <em>pandas</em> methods of the data frame. The trimmed mean requires the <code>trim_mean</code> function in <em>scipy.stats</em>.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:41:35.720234Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:41:35.719289Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:41:35.728249Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:41:35.727173Z&quot;}" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> pd.read_csv(STATE_CSV)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(state[<span class="st">'Population'</span>].mean())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>6162876.3</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:41:35.731743Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:41:35.731507Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:41:35.736311Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:41:35.735324Z&quot;}" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(trim_mean(state[<span class="st">'Population'</span>], <span class="fl">0.1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>4783697.125</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:41:35.739570Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:41:35.738914Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:41:35.743616Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:41:35.742791Z&quot;}" data-execution_count="7">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(state[<span class="st">'Population'</span>].median())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>4436369.5</code></pre>
</div>
</div>
<p>Weighted mean is available with numpy. For weighted median, we can use the specialised package <code>wquantiles</code> (https://pypi.org/project/wquantiles/).</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:41:35.747867Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:41:35.746718Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:41:35.751766Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:41:35.750725Z&quot;}" data-execution_count="8">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(state[<span class="st">'Murder.Rate'</span>].mean())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>4.066</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:41:35.754703Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:41:35.754436Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:41:35.758428Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:41:35.757718Z&quot;}" data-execution_count="9">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(np.average(state[<span class="st">'Murder.Rate'</span>], weights<span class="op">=</span>state[<span class="st">'Population'</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>4.445833981123393</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:41:35.762385Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:41:35.761389Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:41:35.767182Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:41:35.766512Z&quot;}" data-scrolled="true" data-execution_count="10">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(wquantiles.median(state[<span class="st">'Murder.Rate'</span>], weights<span class="op">=</span>state[<span class="st">'Population'</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>4.4</code></pre>
</div>
</div>
</section>
</section>
<section id="estimates-of-variability" class="level1">
<h1>Estimates of Variability</h1>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:41:35.770317Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:41:35.770083Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:41:35.776432Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:41:35.775632Z&quot;}" data-execution_count="11">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 1-2</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(state.head(<span class="dv">8</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         State  Population  Murder.Rate Abbreviation
0      Alabama     4779736          5.7           AL
1       Alaska      710231          5.6           AK
2      Arizona     6392017          4.7           AZ
3     Arkansas     2915918          5.6           AR
4   California    37253956          4.4           CA
5     Colorado     5029196          2.8           CO
6  Connecticut     3574097          2.4           CT
7     Delaware      897934          5.8           DE</code></pre>
</div>
</div>
<p>Standard deviation</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:41:35.779557Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:41:35.779301Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:41:35.784171Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:41:35.783323Z&quot;}" data-execution_count="12">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(state[<span class="st">'Population'</span>].std())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>6848235.347401142</code></pre>
</div>
</div>
<p>Interquartile range is calculated as the difference of the 75% and 25% quantile.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:41:35.787566Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:41:35.787016Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:41:35.792405Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:41:35.791742Z&quot;}" data-execution_count="13">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(state[<span class="st">'Population'</span>].quantile(<span class="fl">0.75</span>) <span class="op">-</span> state[<span class="st">'Population'</span>].quantile(<span class="fl">0.25</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>4847308.0</code></pre>
</div>
</div>
<p>Median absolute deviation from the median can be calculated with a method in <em>statsmodels</em></p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:41:35.795428Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:41:35.795210Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:41:35.801633Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:41:35.800953Z&quot;}" data-execution_count="14">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(robust.scale.mad(state[<span class="st">'Population'</span>]))</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">abs</span>(state[<span class="st">'Population'</span>] <span class="op">-</span> state[<span class="st">'Population'</span>].median()).median() <span class="op">/</span> <span class="fl">0.6744897501960817</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>3849876.1459979336
3849876.1459979336</code></pre>
</div>
</div>
<section id="percentiles-and-boxplots" class="level2">
<h2 class="anchored" data-anchor-id="percentiles-and-boxplots">Percentiles and Boxplots</h2>
<p><em>Pandas</em> has the <code>quantile</code> method for data frames.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:41:35.805389Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:41:35.804986Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:41:35.813654Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:41:35.812743Z&quot;}" data-execution_count="15">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(state[<span class="st">'Murder.Rate'</span>].quantile([<span class="fl">0.05</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">0.95</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.05    1.600
0.25    2.425
0.50    4.000
0.75    5.550
0.95    6.510
Name: Murder.Rate, dtype: float64</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:41:35.816851Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:41:35.816645Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:41:35.825931Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:41:35.825018Z&quot;}" data-execution_count="16">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 1.4</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>percentages <span class="op">=</span> [<span class="fl">0.05</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">0.95</span>]</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(state[<span class="st">'Murder.Rate'</span>].quantile(percentages))</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>df.index <span class="op">=</span> [<span class="ss">f'</span><span class="sc">{</span>p <span class="op">*</span> <span class="dv">100</span><span class="sc">}</span><span class="ss">%'</span> <span class="cf">for</span> p <span class="kw">in</span> percentages]</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.transpose())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             5.0%  25.0%  50.0%  75.0%  95.0%
Murder.Rate   1.6  2.425    4.0   5.55   6.51</code></pre>
</div>
</div>
<p><em>Pandas</em> provides a number of basic exploratory plots; one of them are boxplots</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:41:35.829031Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:41:35.828825Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:41:36.009799Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:41:36.008741Z&quot;}" data-execution_count="17">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> (state[<span class="st">'Population'</span>]<span class="op">/</span><span class="dv">1_000_000</span>).plot.box(figsize<span class="op">=</span>(<span class="dv">3</span>, <span class="dv">4</span>))</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Population (millions)'</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Chapter1-Exploratory_Data_Analysis_files/figure-html/cell-18-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="frequency-table-and-histograms" class="level2">
<h2 class="anchored" data-anchor-id="frequency-table-and-histograms">Frequency Table and Histograms</h2>
<p>The <code>cut</code> method for <em>pandas</em> data splits the dataset into bins. There are a number of arguments for the method. The following code creates equal sized bins. The method <code>value_counts</code> returns a frequency table.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:41:36.013220Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:41:36.013014Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:41:36.024317Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:41:36.023625Z&quot;}" data-execution_count="18">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>binnedPopulation <span class="op">=</span> pd.cut(state[<span class="st">'Population'</span>], <span class="dv">10</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(binnedPopulation.value_counts())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(526935.67, 4232659.0]      24
(4232659.0, 7901692.0]      14
(7901692.0, 11570725.0]      6
(11570725.0, 15239758.0]     2
(15239758.0, 18908791.0]     1
(18908791.0, 22577824.0]     1
(22577824.0, 26246857.0]     1
(33584923.0, 37253956.0]     1
(26246857.0, 29915890.0]     0
(29915890.0, 33584923.0]     0
Name: Population, dtype: int64</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:41:36.027414Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:41:36.027172Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:41:36.043921Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:41:36.043149Z&quot;}" data-execution_count="19">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 1.5</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>binnedPopulation.name <span class="op">=</span> <span class="st">'binnedPopulation'</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.concat([state, binnedPopulation], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.sort_values(by<span class="op">=</span><span class="st">'Population'</span>)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>groups <span class="op">=</span> []</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> group, subset <span class="kw">in</span> df.groupby(by<span class="op">=</span><span class="st">'binnedPopulation'</span>):</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>    groups.append({</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">'BinRange'</span>: group,</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Count'</span>: <span class="bu">len</span>(subset),</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">'States'</span>: <span class="st">','</span>.join(subset.Abbreviation)</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pd.DataFrame(groups))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   BinRange  Count  \
0    (526935.67, 4232659.0]     24   
1    (4232659.0, 7901692.0]     14   
2   (7901692.0, 11570725.0]      6   
3  (11570725.0, 15239758.0]      2   
4  (15239758.0, 18908791.0]      1   
5  (18908791.0, 22577824.0]      1   
6  (22577824.0, 26246857.0]      1   
7  (26246857.0, 29915890.0]      0   
8  (29915890.0, 33584923.0]      0   
9  (33584923.0, 37253956.0]      1   

                                              States  
0  WY,VT,ND,AK,SD,DE,MT,RI,NH,ME,HI,ID,NE,WV,NM,N...  
1          KY,LA,SC,AL,CO,MN,WI,MD,MO,TN,AZ,IN,MA,WA  
2                                  VA,NJ,NC,GA,MI,OH  
3                                              PA,IL  
4                                                 FL  
5                                                 NY  
6                                                 TX  
7                                                     
8                                                     
9                                                 CA  </code></pre>
</div>
</div>
<p><em>Pandas</em> also supports histograms for exploratory data analysis.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:41:36.047730Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:41:36.047476Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:41:36.184054Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:41:36.183237Z&quot;}" data-execution_count="20">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> (state[<span class="st">'Population'</span>] <span class="op">/</span> <span class="dv">1_000_000</span>).plot.hist(figsize<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">4</span>))</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Population (millions)'</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Chapter1-Exploratory_Data_Analysis_files/figure-html/cell-21-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="density-estimates" class="level2">
<h2 class="anchored" data-anchor-id="density-estimates">Density Estimates</h2>
<p>Density is an alternative to histograms that can provide more insight into the distribution of the data points. Use the argument <code>bw_method</code> to control the smoothness of the density curve.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:41:36.202105Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:41:36.201867Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:41:36.366117Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:41:36.365240Z&quot;}" data-execution_count="21">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> state[<span class="st">'Murder.Rate'</span>].plot.hist(density<span class="op">=</span><span class="va">True</span>, xlim<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">12</span>], </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>                                    bins<span class="op">=</span><span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">12</span>), figsize<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">4</span>))</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>state[<span class="st">'Murder.Rate'</span>].plot.density(ax<span class="op">=</span>ax)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Murder Rate (per 100,000)'</span>)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Chapter1-Exploratory_Data_Analysis_files/figure-html/cell-22-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="exploring-binary-and-categorical-data" class="level1">
<h1>Exploring Binary and Categorical Data</h1>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:41:36.369880Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:41:36.369186Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:41:36.379958Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:41:36.379056Z&quot;}" data-execution_count="22">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 1-6</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>dfw <span class="op">=</span> pd.read_csv(AIRPORT_DELAYS_CSV)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="dv">100</span> <span class="op">*</span> dfw <span class="op">/</span> dfw.values.<span class="bu">sum</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Carrier        ATC   Weather  Security    Inbound
0  23.022989  30.400781  4.025214  0.122937  42.428079</code></pre>
</div>
</div>
<p><em>Pandas</em> also supports bar charts for displaying a single categorical variable.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:41:36.383643Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:41:36.383383Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:41:36.498392Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:41:36.497651Z&quot;}" data-execution_count="23">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> dfw.transpose().plot.bar(figsize<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">4</span>), legend<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Cause of delay'</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Count'</span>)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Chapter1-Exploratory_Data_Analysis_files/figure-html/cell-24-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="correlation" class="level1">
<h1>Correlation</h1>
<p>First read the required datasets</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:41:36.501519Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:41:36.501289Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:41:37.559617Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:41:37.558569Z&quot;}" data-execution_count="24">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>sp500_sym <span class="op">=</span> pd.read_csv(SP500_SECTORS_CSV)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>sp500_px <span class="op">=</span> pd.read_csv(SP500_DATA_CSV, index_col<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:41:37.563195Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:41:37.563002Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:41:37.573188Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:41:37.572360Z&quot;}" data-execution_count="25">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 1-7</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Determine telecommunications symbols</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>telecomSymbols <span class="op">=</span> sp500_sym[sp500_sym[<span class="st">'sector'</span>] <span class="op">==</span> <span class="st">'telecommunications_services'</span>][<span class="st">'symbol'</span>]</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter data for dates July 2012 through June 2015</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>telecom <span class="op">=</span> sp500_px.loc[sp500_px.index <span class="op">&gt;=</span> <span class="st">'2012-07-01'</span>, telecomSymbols]</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>telecom.corr()</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(telecom)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   T       CTL       FTR        VZ      LVLT
2012-07-02  0.422496  0.140847  0.070879  0.554180 -0.519998
2012-07-03 -0.177448  0.066280  0.070879 -0.025976 -0.049999
2012-07-05 -0.160548 -0.132563  0.055128 -0.051956 -0.180000
2012-07-06  0.342205  0.132563  0.007875  0.140106 -0.359999
2012-07-09  0.136883  0.124279 -0.023626  0.253943  0.180000
...              ...       ...       ...       ...       ...
2015-06-25  0.049342 -1.600000 -0.040000 -0.187790 -0.330002
2015-06-26 -0.256586  0.039999 -0.070000  0.029650 -0.739998
2015-06-29 -0.098685 -0.559999 -0.060000 -0.504063 -1.360000
2015-06-30 -0.503298 -0.420000 -0.070000 -0.523829  0.199997
2015-07-01 -0.019737  0.080000 -0.050000  0.355811  0.139999

[754 rows x 5 columns]</code></pre>
</div>
</div>
<p>Next we focus on funds traded on major exchanges (sector == ‘etf’).</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:41:37.576401Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:41:37.576201Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:41:37.588251Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:41:37.587426Z&quot;}" data-execution_count="26">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>etfs <span class="op">=</span> sp500_px.loc[sp500_px.index <span class="op">&gt;</span> <span class="st">'2012-07-01'</span>, </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>                    sp500_sym[sp500_sym[<span class="st">'sector'</span>] <span class="op">==</span> <span class="st">'etf'</span>][<span class="st">'symbol'</span>]]</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(etfs.head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 XLI       QQQ       SPY       DIA       GLD    VXX       USO  \
2012-07-02 -0.376098  0.096313  0.028223 -0.242796  0.419998 -10.40  0.000000   
2012-07-03  0.376099  0.481576  0.874936  0.728405  0.490006  -3.52  0.250000   
2012-07-05  0.150440  0.096313 -0.103487  0.149420  0.239991   6.56 -0.070000   
2012-07-06 -0.141040 -0.491201  0.018819 -0.205449 -0.519989  -8.80 -0.180000   
2012-07-09  0.244465 -0.048160 -0.056445 -0.168094  0.429992  -0.48  0.459999   

                 IWM       XLE       XLY       XLU       XLB       XTL  \
2012-07-02  0.534641  0.028186  0.095759  0.098311 -0.093713  0.019076   
2012-07-03  0.926067  0.995942  0.000000 -0.044686  0.337373  0.000000   
2012-07-05 -0.171848 -0.460387  0.306431 -0.151938  0.103086  0.019072   
2012-07-06 -0.229128  0.206706  0.153214  0.080437  0.018744 -0.429213   
2012-07-09 -0.190939 -0.234892 -0.201098 -0.035751 -0.168687  0.000000   

                 XLV       XLP       XLF       XLK  
2012-07-02 -0.009529  0.313499  0.018999  0.075668  
2012-07-03  0.000000  0.129087  0.104492  0.236462  
2012-07-05 -0.142955 -0.073766 -0.142490  0.066211  
2012-07-06 -0.095304  0.119865  0.066495 -0.227003  
2012-07-09  0.352630 -0.064548  0.018999  0.009457  </code></pre>
</div>
</div>
<p>Due to the large number of columns in this table, looking at the correlation matrix is cumbersome and it’s more convenient to plot the correlation as a heatmap. The <em>seaborn</em> package provides a convenient implementation for heatmaps.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:41:37.591316Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:41:37.591125Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:41:37.859238Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:41:37.858610Z&quot;}" data-execution_count="27">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">4</span>))</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> sns.heatmap(etfs.corr(), vmin<span class="op">=-</span><span class="dv">1</span>, vmax<span class="op">=</span><span class="dv">1</span>, </span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>                 cmap<span class="op">=</span>sns.diverging_palette(<span class="dv">20</span>, <span class="dv">220</span>, as_cmap<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>                 ax<span class="op">=</span>ax)</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Chapter1-Exploratory_Data_Analysis_files/figure-html/cell-28-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>The above heatmap works when you have color. For the greyscale images, as used in the book, we need to visualize the direction as well. The following code shows the strength of the correlation using ellipses.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:41:37.862840Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:41:37.862681Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:41:38.085375Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:41:38.084653Z&quot;}" data-execution_count="28">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.collections <span class="im">import</span> EllipseCollection</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.colors <span class="im">import</span> Normalize</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_corr_ellipses(data, figsize<span class="op">=</span><span class="va">None</span>, <span class="op">**</span>kwargs):</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">''' https://stackoverflow.com/a/34558488 '''</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> np.array(data)</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> M.ndim <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">'data must be a 2D array'</span>)</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>figsize, subplot_kw<span class="op">=</span>{<span class="st">'aspect'</span>:<span class="st">'equal'</span>})</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>    ax.set_xlim(<span class="op">-</span><span class="fl">0.5</span>, M.shape[<span class="dv">1</span>] <span class="op">-</span> <span class="fl">0.5</span>)</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>    ax.set_ylim(<span class="op">-</span><span class="fl">0.5</span>, M.shape[<span class="dv">0</span>] <span class="op">-</span> <span class="fl">0.5</span>)</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>    ax.invert_yaxis()</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># xy locations of each ellipse center</span></span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>    xy <span class="op">=</span> np.indices(M.shape)[::<span class="op">-</span><span class="dv">1</span>].reshape(<span class="dv">2</span>, <span class="op">-</span><span class="dv">1</span>).T</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># set the relative sizes of the major/minor axes according to the strength of</span></span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># the positive/negative correlation</span></span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>    w <span class="op">=</span> np.ones_like(M).ravel() <span class="op">+</span> <span class="fl">0.01</span></span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>    h <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> np.<span class="bu">abs</span>(M).ravel() <span class="op">-</span> <span class="fl">0.01</span></span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="dv">45</span> <span class="op">*</span> np.sign(M).ravel()</span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a>    ec <span class="op">=</span> EllipseCollection(widths<span class="op">=</span>w, heights<span class="op">=</span>h, angles<span class="op">=</span>a, units<span class="op">=</span><span class="st">'x'</span>, offsets<span class="op">=</span>xy,</span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a>                           norm<span class="op">=</span>Normalize(vmin<span class="op">=-</span><span class="dv">1</span>, vmax<span class="op">=</span><span class="dv">1</span>),</span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a>                           transOffset<span class="op">=</span>ax.transData, array<span class="op">=</span>M.ravel(), <span class="op">**</span>kwargs)</span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a>    ax.add_collection(ec)</span>
<span id="cb46-27"><a href="#cb46-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-28"><a href="#cb46-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># if data is a DataFrame, use the row/column names as tick labels</span></span>
<span id="cb46-29"><a href="#cb46-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">isinstance</span>(data, pd.DataFrame):</span>
<span id="cb46-30"><a href="#cb46-30" aria-hidden="true" tabindex="-1"></a>        ax.set_xticks(np.arange(M.shape[<span class="dv">1</span>]))</span>
<span id="cb46-31"><a href="#cb46-31" aria-hidden="true" tabindex="-1"></a>        ax.set_xticklabels(data.columns, rotation<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb46-32"><a href="#cb46-32" aria-hidden="true" tabindex="-1"></a>        ax.set_yticks(np.arange(M.shape[<span class="dv">0</span>]))</span>
<span id="cb46-33"><a href="#cb46-33" aria-hidden="true" tabindex="-1"></a>        ax.set_yticklabels(data.index)</span>
<span id="cb46-34"><a href="#cb46-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-35"><a href="#cb46-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ec, ax</span>
<span id="cb46-36"><a href="#cb46-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-37"><a href="#cb46-37" aria-hidden="true" tabindex="-1"></a>m, ax <span class="op">=</span> plot_corr_ellipses(etfs.corr(), figsize<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">4</span>), cmap<span class="op">=</span><span class="st">'bwr_r'</span>)</span>
<span id="cb46-38"><a href="#cb46-38" aria-hidden="true" tabindex="-1"></a>cb <span class="op">=</span> fig.colorbar(m, ax<span class="op">=</span>ax)</span>
<span id="cb46-39"><a href="#cb46-39" aria-hidden="true" tabindex="-1"></a>cb.set_label(<span class="st">'Correlation coefficient'</span>)</span>
<span id="cb46-40"><a href="#cb46-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-41"><a href="#cb46-41" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb46-42"><a href="#cb46-42" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Chapter1-Exploratory_Data_Analysis_files/figure-html/cell-29-output-1.png" class="img-fluid"></p>
</div>
</div>
<section id="scatterplots" class="level2">
<h2 class="anchored" data-anchor-id="scatterplots">Scatterplots</h2>
<p>Simple scatterplots are supported by <em>pandas</em>. Specifying the marker as <code>$\u25EF$</code> uses an open circle for each point.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:41:38.088751Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:41:38.088496Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:41:38.360367Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:41:38.359445Z&quot;}" data-scrolled="true" data-execution_count="29">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> telecom.plot.scatter(x<span class="op">=</span><span class="st">'T'</span>, y<span class="op">=</span><span class="st">'VZ'</span>, figsize<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">4</span>), marker<span class="op">=</span><span class="st">'$</span><span class="ch">\u25EF</span><span class="st">$'</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'ATT (T)'</span>)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Verizon (VZ)'</span>)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>ax.axhline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">'grey'</span>, lw<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>ax.axvline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">'grey'</span>, lw<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Chapter1-Exploratory_Data_Analysis_files/figure-html/cell-30-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:41:38.363544Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:41:38.363347Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:41:38.499518Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:41:38.498761Z&quot;}" data-execution_count="30">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> telecom.plot.scatter(x<span class="op">=</span><span class="st">'T'</span>, y<span class="op">=</span><span class="st">'VZ'</span>, figsize<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">4</span>), marker<span class="op">=</span><span class="st">'$</span><span class="ch">\u25EF</span><span class="st">$'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'ATT (T)'</span>)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Verizon (VZ)'</span>)</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>ax.axhline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">'grey'</span>, lw<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ax.axvline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">'grey'</span>, lw<span class="op">=</span><span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Line2D(_child2)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Chapter1-Exploratory_Data_Analysis_files/figure-html/cell-31-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="exploring-two-or-more-variables" class="level1">
<h1>Exploring Two or More Variables</h1>
<p>Load the kc_tax dataset and filter based on a variety of criteria</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:41:38.509031Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:41:38.507149Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:41:38.722378Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:41:38.721537Z&quot;}" data-execution_count="31">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>kc_tax <span class="op">=</span> pd.read_csv(KC_TAX_CSV)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>kc_tax0 <span class="op">=</span> kc_tax.loc[(kc_tax.TaxAssessedValue <span class="op">&lt;</span> <span class="dv">750000</span>) <span class="op">&amp;</span> </span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>                     (kc_tax.SqFtTotLiving <span class="op">&gt;</span> <span class="dv">100</span>) <span class="op">&amp;</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>                     (kc_tax.SqFtTotLiving <span class="op">&lt;</span> <span class="dv">3500</span>), :]</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(kc_tax0.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(432693, 3)</code></pre>
</div>
</div>
<section id="hexagonal-binning-and-contours" class="level2">
<h2 class="anchored" data-anchor-id="hexagonal-binning-and-contours">Hexagonal binning and Contours</h2>
<section id="plotting-numeric-versus-numeric-data" class="level3">
<h3 class="anchored" data-anchor-id="plotting-numeric-versus-numeric-data">Plotting numeric versus numeric data</h3>
<p>If the number of data points gets large, scatter plots will no longer be meaningful. Here methods that visualize densities are more useful. The <code>hexbin</code> method for <em>pandas</em> data frames is one powerful approach.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:41:38.729374Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:41:38.729102Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:41:39.130929Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:41:39.129237Z&quot;}" data-scrolled="true" data-execution_count="32">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> kc_tax0.plot.hexbin(x<span class="op">=</span><span class="st">'SqFtTotLiving'</span>, y<span class="op">=</span><span class="st">'TaxAssessedValue'</span>,</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>                         gridsize<span class="op">=</span><span class="dv">30</span>, sharex<span class="op">=</span><span class="va">False</span>, figsize<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">4</span>))</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Finished Square Feet'</span>)</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Tax Assessed Value'</span>)</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Chapter1-Exploratory_Data_Analysis_files/figure-html/cell-33-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>The <em>seaborn</em> kdeplot is a two-dimensional extension of the density plot. The calculation of the 2D-density for the full dataset takes several minutes. It is sufficient to create the visualization with a smaller sample of the dataset. With 10,000 data points, creating the graph takes only seconds. While some details may be lost, the overall shape is preserved.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:41:39.137141Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:41:39.136603Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:41:43.526285Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:41:43.525736Z&quot;}" data-scrolled="true" data-execution_count="33">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">4</span>, <span class="dv">4</span>))</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>sns.kdeplot(data<span class="op">=</span>kc_tax0.sample(<span class="dv">10000</span>), x<span class="op">=</span><span class="st">'SqFtTotLiving'</span>, y<span class="op">=</span><span class="st">'TaxAssessedValue'</span>, ax<span class="op">=</span>ax)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Finished Square Feet'</span>)</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Tax Assessed Value'</span>)</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Chapter1-Exploratory_Data_Analysis_files/figure-html/cell-34-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="two-categorical-variables" class="level2">
<h2 class="anchored" data-anchor-id="two-categorical-variables">Two Categorical Variables</h2>
<p>Load the <code>lc_loans</code> dataset</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:41:43.530303Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:41:43.529012Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:41:43.626716Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:41:43.626048Z&quot;}" data-execution_count="34">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>lc_loans <span class="op">=</span> pd.read_csv(LC_LOANS_CSV)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:41:43.630123Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:41:43.629381Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:41:43.888611Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:41:43.887946Z&quot;}" data-execution_count="35">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 1-8(1)</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>crosstab <span class="op">=</span> lc_loans.pivot_table(index<span class="op">=</span><span class="st">'grade'</span>, columns<span class="op">=</span><span class="st">'status'</span>, </span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>                                aggfunc<span class="op">=</span><span class="kw">lambda</span> x: <span class="bu">len</span>(x), margins<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(crosstab)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>status  Charged Off  Current  Fully Paid  Late     All
grade                                                 
A              1562    50051       20408   469   72490
B              5302    93852       31160  2056  132370
C              6023    88928       23147  2777  120875
D              5007    53281       13681  2308   74277
E              2842    24639        5949  1374   34804
F              1526     8444        2328   606   12904
G               409     1990         643   199    3241
All           22671   321185       97316  9789  450961</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:41:43.892014Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:41:43.891253Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:41:43.902378Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:41:43.901751Z&quot;}" data-scrolled="true" data-execution_count="36">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 1-8(2)</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> crosstab.copy().loc[<span class="st">'A'</span>:<span class="st">'G'</span>,:]</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>df.loc[:,<span class="st">'Charged Off'</span>:<span class="st">'Late'</span>] <span class="op">=</span> df.loc[:,<span class="st">'Charged Off'</span>:<span class="st">'Late'</span>].div(df[<span class="st">'All'</span>], axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'All'</span>] <span class="op">=</span> df[<span class="st">'All'</span>] <span class="op">/</span> <span class="bu">sum</span>(df[<span class="st">'All'</span>])</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>perc_crosstab <span class="op">=</span> df</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(perc_crosstab)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>status  Charged Off   Current  Fully Paid      Late       All
grade                                                        
A          0.021548  0.690454    0.281528  0.006470  0.160746
B          0.040054  0.709013    0.235401  0.015532  0.293529
C          0.049828  0.735702    0.191495  0.022974  0.268039
D          0.067410  0.717328    0.184189  0.031073  0.164708
E          0.081657  0.707936    0.170929  0.039478  0.077177
F          0.118258  0.654371    0.180409  0.046962  0.028614
G          0.126196  0.614008    0.198396  0.061401  0.007187</code></pre>
</div>
</div>
</section>
<section id="categorical-and-numeric-data" class="level2">
<h2 class="anchored" data-anchor-id="categorical-and-numeric-data">Categorical and Numeric Data</h2>
<p><em>Pandas</em> boxplots of a column can be grouped by a different column.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:41:43.907303Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:41:43.906520Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:41:44.102351Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:41:44.101632Z&quot;}" data-execution_count="37">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>airline_stats <span class="op">=</span> pd.read_csv(AIRLINE_STATS_CSV)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>airline_stats.head()</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> airline_stats.boxplot(by<span class="op">=</span><span class="st">'airline'</span>, column<span class="op">=</span><span class="st">'pct_carrier_delay'</span>,</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>                           figsize<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">5</span>))</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">''</span>)</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Daily </span><span class="sc">% o</span><span class="st">f Delayed Flights'</span>)</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">''</span>)</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Chapter1-Exploratory_Data_Analysis_files/figure-html/cell-38-output-1.png" class="img-fluid"></p>
</div>
</div>
<p><em>Pandas</em> also supports a variation of boxplots called <em>violinplot</em>.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:41:44.106286Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:41:44.105258Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:41:44.289049Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:41:44.288573Z&quot;}" data-execution_count="38">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">5</span>))</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>sns.violinplot(data<span class="op">=</span>airline_stats, x<span class="op">=</span><span class="st">'airline'</span>, y<span class="op">=</span><span class="st">'pct_carrier_delay'</span>,</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>               ax<span class="op">=</span>ax, inner<span class="op">=</span><span class="st">'quartile'</span>, color<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">''</span>)</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Daily </span><span class="sc">% o</span><span class="st">f Delayed Flights'</span>)</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Chapter1-Exploratory_Data_Analysis_files/figure-html/cell-39-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="visualizing-multiple-variables" class="level2">
<h2 class="anchored" data-anchor-id="visualizing-multiple-variables">Visualizing Multiple Variables</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T19:41:44.292201Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T19:41:44.291815Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T19:41:44.783055Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T19:41:44.782390Z&quot;}" data-execution_count="39">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>zip_codes <span class="op">=</span> [<span class="dv">98188</span>, <span class="dv">98105</span>, <span class="dv">98108</span>, <span class="dv">98126</span>]</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>kc_tax_zip <span class="op">=</span> kc_tax0.loc[kc_tax0.ZipCode.isin(zip_codes),:]</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>kc_tax_zip</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> hexbin(x, y, color, <span class="op">**</span>kwargs):</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>    cmap <span class="op">=</span> sns.light_palette(color, as_cmap<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>    plt.hexbin(x, y, gridsize<span class="op">=</span><span class="dv">25</span>, cmap<span class="op">=</span>cmap, <span class="op">**</span>kwargs)</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> sns.FacetGrid(kc_tax_zip, col<span class="op">=</span><span class="st">'ZipCode'</span>, col_wrap<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>g.<span class="bu">map</span>(hexbin, <span class="st">'SqFtTotLiving'</span>, <span class="st">'TaxAssessedValue'</span>, </span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>      extent<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">3500</span>, <span class="dv">0</span>, <span class="dv">700000</span>])</span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>g.set_axis_labels(<span class="st">'Finished Square Feet'</span>, <span class="st">'Tax Assessed Value'</span>)</span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>g.set_titles(<span class="st">'Zip code </span><span class="sc">{col_name:.0f}</span><span class="st">'</span>)</span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Chapter1-Exploratory_Data_Analysis_files/figure-html/cell-40-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>