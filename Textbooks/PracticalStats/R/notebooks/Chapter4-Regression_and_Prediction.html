<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Chapter 4 - Regression and Prediction</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Chapter4-Regression_and_Prediction_files/libs/clipboard/clipboard.min.js"></script>
<script src="Chapter4-Regression_and_Prediction_files/libs/quarto-html/quarto.js"></script>
<script src="Chapter4-Regression_and_Prediction_files/libs/quarto-html/popper.min.js"></script>
<script src="Chapter4-Regression_and_Prediction_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Chapter4-Regression_and_Prediction_files/libs/quarto-html/anchor.min.js"></script>
<link href="Chapter4-Regression_and_Prediction_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Chapter4-Regression_and_Prediction_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Chapter4-Regression_and_Prediction_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Chapter4-Regression_and_Prediction_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Chapter4-Regression_and_Prediction_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#practical-statistics-for-data-scientists-r" id="toc-practical-statistics-for-data-scientists-r" class="nav-link active" data-scroll-target="#practical-statistics-for-data-scientists-r">Practical Statistics for Data Scientists (R)</a></li>
  <li><a href="#simple-linear-regression" id="toc-simple-linear-regression" class="nav-link" data-scroll-target="#simple-linear-regression">Simple Linear Regression</a>
  <ul class="collapse">
  <li><a href="#the-regression-equation" id="toc-the-regression-equation" class="nav-link" data-scroll-target="#the-regression-equation">The Regression Equation</a></li>
  <li><a href="#fitted-values-and-residuals" id="toc-fitted-values-and-residuals" class="nav-link" data-scroll-target="#fitted-values-and-residuals">Fitted Values and Residuals</a></li>
  </ul></li>
  <li><a href="#multiple-linear-regression" id="toc-multiple-linear-regression" class="nav-link" data-scroll-target="#multiple-linear-regression">Multiple linear regression</a>
  <ul class="collapse">
  <li><a href="#assessing-the-model" id="toc-assessing-the-model" class="nav-link" data-scroll-target="#assessing-the-model">Assessing the Model</a></li>
  <li><a href="#model-selection-and-stepwise-regression" id="toc-model-selection-and-stepwise-regression" class="nav-link" data-scroll-target="#model-selection-and-stepwise-regression">Model Selection and Stepwise Regression</a></li>
  <li><a href="#weighted-regression" id="toc-weighted-regression" class="nav-link" data-scroll-target="#weighted-regression">Weighted regression</a></li>
  </ul></li>
  <li><a href="#factor-variables-in-regression" id="toc-factor-variables-in-regression" class="nav-link" data-scroll-target="#factor-variables-in-regression">Factor variables in regression</a>
  <ul class="collapse">
  <li><a href="#dummy-variables-representation" id="toc-dummy-variables-representation" class="nav-link" data-scroll-target="#dummy-variables-representation">Dummy Variables Representation</a></li>
  <li><a href="#factor-variables-with-many-levels" id="toc-factor-variables-with-many-levels" class="nav-link" data-scroll-target="#factor-variables-with-many-levels">Factor Variables with many levels</a></li>
  </ul></li>
  <li><a href="#interpreting-the-regression-equation" id="toc-interpreting-the-regression-equation" class="nav-link" data-scroll-target="#interpreting-the-regression-equation">Interpreting the Regression Equation</a>
  <ul class="collapse">
  <li><a href="#correlated-predictors" id="toc-correlated-predictors" class="nav-link" data-scroll-target="#correlated-predictors">Correlated predictors</a></li>
  <li><a href="#confounding-variables" id="toc-confounding-variables" class="nav-link" data-scroll-target="#confounding-variables">Confounding variables</a></li>
  <li><a href="#interactions-and-main-effects" id="toc-interactions-and-main-effects" class="nav-link" data-scroll-target="#interactions-and-main-effects">Interactions and Main Effects</a></li>
  </ul></li>
  <li><a href="#testing-the-assumptions-regression-diagnostics" id="toc-testing-the-assumptions-regression-diagnostics" class="nav-link" data-scroll-target="#testing-the-assumptions-regression-diagnostics">Testing the Assumptions: Regression Diagnostics</a>
  <ul class="collapse">
  <li><a href="#outliers" id="toc-outliers" class="nav-link" data-scroll-target="#outliers">Outliers</a></li>
  <li><a href="#influential-values" id="toc-influential-values" class="nav-link" data-scroll-target="#influential-values">Influential values</a></li>
  <li><a href="#heteroskedasticity-non-normality-and-correlated-errors" id="toc-heteroskedasticity-non-normality-and-correlated-errors" class="nav-link" data-scroll-target="#heteroskedasticity-non-normality-and-correlated-errors">Heteroskedasticity, Non-Normality and Correlated Errors</a></li>
  <li><a href="#partial-residual-plots-and-nonlinearity" id="toc-partial-residual-plots-and-nonlinearity" class="nav-link" data-scroll-target="#partial-residual-plots-and-nonlinearity">Partial Residual Plots and Nonlinearity</a></li>
  <li><a href="#polynomial-and-spline-regression" id="toc-polynomial-and-spline-regression" class="nav-link" data-scroll-target="#polynomial-and-spline-regression">Polynomial and Spline Regression</a></li>
  <li><a href="#splines" id="toc-splines" class="nav-link" data-scroll-target="#splines">Splines</a></li>
  <li><a href="#generalized-additive-models" id="toc-generalized-additive-models" class="nav-link" data-scroll-target="#generalized-additive-models">Generalized Additive Models</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Chapter 4 - Regression and Prediction</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="practical-statistics-for-data-scientists-r" class="level1">
<h1>Practical Statistics for Data Scientists (R)</h1>
<blockquote class="blockquote">
<ol start="3" type="a">
<li>2019 Peter C. Bruce, Andrew Bruce, Peter Gedeck</li>
</ol>
</blockquote>
<p>Import required R packages.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T20:06:15.055153Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T20:06:15.052065Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T20:06:16.306559Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T20:06:16.305210Z&quot;}" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(splines)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mgcv)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning message:
“package ‘MASS’ was built under R version 4.1.3”
Warning message:
“package ‘dplyr’ was built under R version 4.1.2”

Attaching package: ‘dplyr’


The following object is masked from ‘package:MASS’:

    select


The following objects are masked from ‘package:stats’:

    filter, lag


The following objects are masked from ‘package:base’:

    intersect, setdiff, setequal, union


Warning message:
“package ‘tidyr’ was built under R version 4.1.2”

Attaching package: ‘lubridate’


The following objects are masked from ‘package:base’:

    date, intersect, setdiff, union


Warning message:
“package ‘mgcv’ was built under R version 4.1.3”
Loading required package: nlme

Warning message:
“package ‘nlme’ was built under R version 4.1.2”

Attaching package: ‘nlme’


The following object is masked from ‘package:dplyr’:

    collapse


This is mgcv 1.8-40. For overview type 'help("mgcv-package")'.
</code></pre>
</div>
</div>
<p>Define paths to data sets. If you don’t keep your data in the same directory as the code, adapt the path names.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T20:06:16.332510Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T20:06:16.309878Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T20:06:16.483284Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T20:06:16.482084Z&quot;}" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>PSDS_PATH <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="fu">dirname</span>(<span class="fu">dirname</span>(<span class="fu">getwd</span>())))</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>lung <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">file.path</span>(PSDS_PATH, <span class="st">'data'</span>, <span class="st">'LungDisease.csv'</span>))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>house <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">file.path</span>(PSDS_PATH, <span class="st">'data'</span>, <span class="st">'house_sales.csv'</span>), <span class="at">sep=</span><span class="st">'</span><span class="sc">\t</span><span class="st">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="simple-linear-regression" class="level1">
<h1>Simple Linear Regression</h1>
<section id="the-regression-equation" class="level2">
<h2 class="anchored" data-anchor-id="the-regression-equation">The Regression Equation</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T20:06:16.488035Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T20:06:16.487137Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T20:06:16.554107Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T20:06:16.552848Z&quot;}" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lung<span class="sc">$</span>Exposure, lung<span class="sc">$</span>PEFR, <span class="at">xlab=</span><span class="st">"Exposure"</span>, <span class="at">ylab=</span><span class="st">"PEFR"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Chapter4-Regression_and_Prediction_files/figure-html/cell-4-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T20:06:16.557982Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T20:06:16.556917Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T20:06:16.573095Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T20:06:16.571829Z&quot;}" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(PEFR <span class="sc">~</span> Exposure, <span class="at">data=</span>lung)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>
Call:
lm(formula = PEFR ~ Exposure, data = lung)

Coefficients:
(Intercept)     Exposure  
    424.583       -4.185  </code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T20:06:16.577496Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T20:06:16.576447Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T20:06:16.667167Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T20:06:16.666073Z&quot;}" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lung<span class="sc">$</span>Exposure, lung<span class="sc">$</span>PEFR, <span class="at">xlab=</span><span class="st">"Exposure"</span>, <span class="at">ylab=</span><span class="st">"PEFR"</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">300</span>,<span class="dv">450</span>), <span class="at">type=</span><span class="st">"n"</span>, <span class="at">xaxs=</span><span class="st">"i"</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a=</span>model<span class="sc">$</span>coefficients[<span class="dv">1</span>], <span class="at">b=</span>model<span class="sc">$</span>coefficients[<span class="dv">2</span>], <span class="at">col=</span><span class="st">"blue"</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x=</span>.<span class="dv">3</span>, <span class="at">y=</span>model<span class="sc">$</span>coefficients[<span class="dv">1</span>], <span class="at">labels=</span><span class="fu">expression</span>(<span class="st">"b"</span>[<span class="dv">0</span>]),  <span class="at">adj=</span><span class="dv">0</span>, <span class="at">cex=</span><span class="fl">1.5</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">7.5</span>, <span class="fl">17.5</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, <span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">Exposure=</span>x))</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="fu">segments</span>(x[<span class="dv">1</span>], y[<span class="dv">2</span>], x[<span class="dv">2</span>], y[<span class="dv">2</span>] , <span class="at">col=</span><span class="st">"red"</span>, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="fu">segments</span>(x[<span class="dv">1</span>], y[<span class="dv">1</span>], x[<span class="dv">1</span>], y[<span class="dv">2</span>] , <span class="at">col=</span><span class="st">"red"</span>, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(x[<span class="dv">1</span>], <span class="fu">mean</span>(y), <span class="at">labels=</span><span class="fu">expression</span>(Delta<span class="sc">~</span>Y), <span class="at">pos=</span><span class="dv">2</span>, <span class="at">cex=</span><span class="fl">1.5</span>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="fu">mean</span>(x), y[<span class="dv">2</span>], <span class="at">labels=</span><span class="fu">expression</span>(Delta<span class="sc">~</span>X), <span class="at">pos=</span><span class="dv">1</span>, <span class="at">cex=</span><span class="fl">1.5</span>)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="fu">mean</span>(x), <span class="dv">400</span>, <span class="at">labels=</span><span class="fu">expression</span>(b[<span class="dv">1</span>] <span class="sc">==</span> <span class="fu">frac</span>(Delta <span class="sc">~</span> Y, Delta <span class="sc">~</span> X)), <span class="at">cex=</span><span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Chapter4-Regression_and_Prediction_files/figure-html/cell-6-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="fitted-values-and-residuals" class="level2">
<h2 class="anchored" data-anchor-id="fitted-values-and-residuals">Fitted Values and Residuals</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T20:06:16.670647Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T20:06:16.669682Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T20:06:16.681874Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T20:06:16.679663Z&quot;}" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>fitted <span class="ot">&lt;-</span> <span class="fu">predict</span>(model)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>resid <span class="ot">&lt;-</span> <span class="fu">residuals</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T20:06:16.686378Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T20:06:16.685368Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T20:06:16.792088Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T20:06:16.790696Z&quot;}" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>lung1 <span class="ot">&lt;-</span> lung <span class="sc">%&gt;%</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Fitted=</span>fitted,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">positive =</span> PEFR<span class="sc">&gt;</span>Fitted) <span class="sc">%&gt;%</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Exposure, positive) <span class="sc">%&gt;%</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">PEFR_max =</span> <span class="fu">max</span>(PEFR), </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">PEFR_min =</span> <span class="fu">min</span>(PEFR),</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">Fitted =</span> <span class="fu">first</span>(Fitted), </span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups=</span><span class="st">'keep'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">PEFR =</span> <span class="fu">ifelse</span>(positive, PEFR_max, PEFR_min)) <span class="sc">%&gt;%</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Exposure)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lung<span class="sc">$</span>Exposure, lung<span class="sc">$</span>PEFR, <span class="at">xlab=</span><span class="st">"Exposure"</span>, <span class="at">ylab=</span><span class="st">"PEFR"</span>)</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a=</span>model<span class="sc">$</span>coefficients[<span class="dv">1</span>], <span class="at">b=</span>model<span class="sc">$</span>coefficients[<span class="dv">2</span>], <span class="at">col=</span><span class="st">"blue"</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="fu">segments</span>(lung1<span class="sc">$</span>Exposure, lung1<span class="sc">$</span>PEFR, lung1<span class="sc">$</span>Exposure, lung1<span class="sc">$</span>Fitted, <span class="at">col=</span><span class="st">"red"</span>, <span class="at">lty=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Chapter4-Regression_and_Prediction_files/figure-html/cell-8-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="multiple-linear-regression" class="level1">
<h1>Multiple linear regression</h1>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T20:06:16.796815Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T20:06:16.795698Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T20:06:16.807769Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T20:06:16.806485Z&quot;}" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="8">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">head</span>(house[, <span class="fu">c</span>(<span class="st">'AdjSalePrice'</span>, <span class="st">'SqFtTotLiving'</span>, <span class="st">'SqFtLot'</span>, <span class="st">'Bathrooms'</span>, </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">'Bedrooms'</span>, <span class="st">'BldgGrade'</span>)]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  AdjSalePrice SqFtTotLiving SqFtLot Bathrooms Bedrooms BldgGrade
1       300805          2400    9373      3.00        6         7
2      1076162          3764   20156      3.75        4        10
3       761805          2060   26036      1.75        4         8
4       442065          3200    8618      3.75        5         7
5       297065          1720    8620      1.75        4         7
6       411781           930    1012      1.50        2         8</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T20:06:16.811989Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T20:06:16.810924Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T20:06:16.828691Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T20:06:16.827384Z&quot;}" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="9">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>house_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(AdjSalePrice <span class="sc">~</span> SqFtTotLiving <span class="sc">+</span> SqFtLot <span class="sc">+</span> Bathrooms <span class="sc">+</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>                 Bedrooms <span class="sc">+</span> BldgGrade,  </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">data=</span>house, <span class="at">na.action=</span>na.omit)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>house_lm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>
Call:
lm(formula = AdjSalePrice ~ SqFtTotLiving + SqFtLot + Bathrooms + 
    Bedrooms + BldgGrade, data = house, na.action = na.omit)

Coefficients:
  (Intercept)  SqFtTotLiving        SqFtLot      Bathrooms       Bedrooms  
   -5.219e+05      2.288e+02     -6.047e-02     -1.944e+04     -4.777e+04  
    BldgGrade  
    1.061e+05  </code></pre>
</div>
</div>
<section id="assessing-the-model" class="level2">
<h2 class="anchored" data-anchor-id="assessing-the-model">Assessing the Model</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T20:06:16.834725Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T20:06:16.833678Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T20:06:16.851688Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T20:06:16.850464Z&quot;}" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="10">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(house_lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>
Call:
lm(formula = AdjSalePrice ~ SqFtTotLiving + SqFtLot + Bathrooms + 
    Bedrooms + BldgGrade, data = house, na.action = na.omit)

Residuals:
     Min       1Q   Median       3Q      Max 
-1199479  -118908   -20977    87435  9473035 

Coefficients:
                Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   -5.219e+05  1.565e+04 -33.342  &lt; 2e-16 ***
SqFtTotLiving  2.288e+02  3.899e+00  58.694  &lt; 2e-16 ***
SqFtLot       -6.047e-02  6.118e-02  -0.988    0.323    
Bathrooms     -1.944e+04  3.625e+03  -5.363 8.27e-08 ***
Bedrooms      -4.777e+04  2.490e+03 -19.187  &lt; 2e-16 ***
BldgGrade      1.061e+05  2.396e+03  44.277  &lt; 2e-16 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 261300 on 22681 degrees of freedom
Multiple R-squared:  0.5406,    Adjusted R-squared:  0.5405 
F-statistic:  5338 on 5 and 22681 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
</section>
<section id="model-selection-and-stepwise-regression" class="level2">
<h2 class="anchored" data-anchor-id="model-selection-and-stepwise-regression">Model Selection and Stepwise Regression</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T20:06:16.855668Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T20:06:16.854627Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T20:06:17.576037Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T20:06:17.574697Z&quot;}" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="11">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>house_full <span class="ot">&lt;-</span> <span class="fu">lm</span>(AdjSalePrice <span class="sc">~</span> SqFtTotLiving <span class="sc">+</span> SqFtLot <span class="sc">+</span> Bathrooms <span class="sc">+</span> </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>                   Bedrooms <span class="sc">+</span> BldgGrade <span class="sc">+</span> PropertyType <span class="sc">+</span> NbrLivingUnits <span class="sc">+</span> </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>                   SqFtFinBasement <span class="sc">+</span> YrBuilt <span class="sc">+</span> YrRenovated <span class="sc">+</span> NewConstruction,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data=</span>house, <span class="at">na.action=</span>na.omit)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Code snippet 4.8</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>step_lm <span class="ot">&lt;-</span> <span class="fu">stepAIC</span>(house_full, <span class="at">direction=</span><span class="st">"both"</span>)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>step_lm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Start:  AIC=563145.4
AdjSalePrice ~ SqFtTotLiving + SqFtLot + Bathrooms + Bedrooms + 
    BldgGrade + PropertyType + NbrLivingUnits + SqFtFinBasement + 
    YrBuilt + YrRenovated + NewConstruction

                  Df  Sum of Sq        RSS    AIC
- NbrLivingUnits   1 6.4007e+09 1.3662e+15 563144
- NewConstruction  1 1.0592e+10 1.3662e+15 563144
- YrRenovated      1 2.5069e+10 1.3662e+15 563144
- SqFtLot          1 1.0657e+11 1.3663e+15 563145
&lt;none&gt;                          1.3662e+15 563145
- SqFtFinBasement  1 1.4030e+11 1.3663e+15 563146
- PropertyType     2 4.4207e+12 1.3706e+15 563215
- Bathrooms        1 7.6325e+12 1.3738e+15 563270
- Bedrooms         1 2.8212e+13 1.3944e+15 563607
- YrBuilt          1 1.2906e+14 1.4952e+15 565191
- SqFtTotLiving    1 1.3264e+14 1.4988e+15 565246
- BldgGrade        1 1.9050e+14 1.5567e+15 566105

Step:  AIC=563143.6
AdjSalePrice ~ SqFtTotLiving + SqFtLot + Bathrooms + Bedrooms + 
    BldgGrade + PropertyType + SqFtFinBasement + YrBuilt + YrRenovated + 
    NewConstruction

                  Df  Sum of Sq        RSS    AIC
- NewConstruction  1 1.0801e+10 1.3662e+15 563142
- YrRenovated      1 2.5628e+10 1.3662e+15 563142
- SqFtLot          1 1.0731e+11 1.3663e+15 563143
&lt;none&gt;                          1.3662e+15 563144
- SqFtFinBasement  1 1.3828e+11 1.3663e+15 563144
+ NbrLivingUnits   1 6.4007e+09 1.3662e+15 563145
- PropertyType     2 4.4301e+12 1.3706e+15 563213
- Bathrooms        1 7.7500e+12 1.3739e+15 563270
- Bedrooms         1 2.8273e+13 1.3944e+15 563606
- YrBuilt          1 1.3013e+14 1.4963e+15 565206
- SqFtTotLiving    1 1.3288e+14 1.4990e+15 565247
- BldgGrade        1 1.9177e+14 1.5579e+15 566122

Step:  AIC=563141.7
AdjSalePrice ~ SqFtTotLiving + SqFtLot + Bathrooms + Bedrooms + 
    BldgGrade + PropertyType + SqFtFinBasement + YrBuilt + YrRenovated

                  Df  Sum of Sq        RSS    AIC
- YrRenovated      1 2.5893e+10 1.3662e+15 563140
- SqFtLot          1 1.1494e+11 1.3663e+15 563142
&lt;none&gt;                          1.3662e+15 563142
- SqFtFinBasement  1 1.4534e+11 1.3663e+15 563142
+ NewConstruction  1 1.0801e+10 1.3662e+15 563144
+ NbrLivingUnits   1 6.6093e+09 1.3662e+15 563144
- PropertyType     2 4.5301e+12 1.3707e+15 563213
- Bathrooms        1 7.7487e+12 1.3739e+15 563268
- Bedrooms         1 2.8269e+13 1.3945e+15 563604
- SqFtTotLiving    1 1.3390e+14 1.5001e+15 565261
- YrBuilt          1 1.3760e+14 1.5038e+15 565317
- BldgGrade        1 1.9244e+14 1.5586e+15 566129

Step:  AIC=563140.2
AdjSalePrice ~ SqFtTotLiving + SqFtLot + Bathrooms + Bedrooms + 
    BldgGrade + PropertyType + SqFtFinBasement + YrBuilt

                  Df  Sum of Sq        RSS    AIC
- SqFtLot          1 1.1425e+11 1.3663e+15 563140
&lt;none&gt;                          1.3662e+15 563140
- SqFtFinBasement  1 1.4999e+11 1.3664e+15 563141
+ YrRenovated      1 2.5893e+10 1.3662e+15 563142
+ NewConstruction  1 1.1065e+10 1.3662e+15 563142
+ NbrLivingUnits   1 7.1825e+09 1.3662e+15 563142
- PropertyType     2 4.5076e+12 1.3707e+15 563211
- Bathrooms        1 7.7790e+12 1.3740e+15 563267
- Bedrooms         1 2.8251e+13 1.3945e+15 563603
- SqFtTotLiving    1 1.3388e+14 1.5001e+15 565259
- YrBuilt          1 1.5091e+14 1.5171e+15 565515
- BldgGrade        1 1.9244e+14 1.5587e+15 566128

Step:  AIC=563140.1
AdjSalePrice ~ SqFtTotLiving + Bathrooms + Bedrooms + BldgGrade + 
    PropertyType + SqFtFinBasement + YrBuilt

                  Df  Sum of Sq        RSS    AIC
&lt;none&gt;                          1.3663e+15 563140
+ SqFtLot          1 1.1425e+11 1.3662e+15 563140
- SqFtFinBasement  1 1.4116e+11 1.3665e+15 563140
+ YrRenovated      1 2.5199e+10 1.3663e+15 563142
+ NewConstruction  1 1.8750e+10 1.3663e+15 563142
+ NbrLivingUnits   1 8.0521e+09 1.3663e+15 563142
- PropertyType     2 4.4415e+12 1.3708e+15 563210
- Bathrooms        1 7.7109e+12 1.3740e+15 563266
- Bedrooms         1 2.8553e+13 1.3949e+15 563607
- SqFtTotLiving    1 1.3748e+14 1.5038e+15 565313
- YrBuilt          1 1.5080e+14 1.5171e+15 565513
- BldgGrade        1 1.9234e+14 1.5587e+15 566126</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>
Call:
lm(formula = AdjSalePrice ~ SqFtTotLiving + Bathrooms + Bedrooms + 
    BldgGrade + PropertyType + SqFtFinBasement + YrBuilt, data = house, 
    na.action = na.omit)

Coefficients:
              (Intercept)              SqFtTotLiving  
                6.179e+06                  1.993e+02  
                Bathrooms                   Bedrooms  
                4.240e+04                 -5.195e+04  
                BldgGrade  PropertyTypeSingle Family  
                1.372e+05                  2.291e+04  
    PropertyTypeTownhouse            SqFtFinBasement  
                8.448e+04                  7.047e+00  
                  YrBuilt  
               -3.565e+03  </code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T20:06:17.580011Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T20:06:17.578923Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T20:06:17.598455Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T20:06:17.597181Z&quot;}" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="12">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(AdjSalePrice <span class="sc">~</span>  Bedrooms, <span class="at">data=</span>house)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>
Call:
lm(formula = AdjSalePrice ~ Bedrooms, data = house)

Coefficients:
(Intercept)     Bedrooms  
     117354       132991  </code></pre>
</div>
</div>
</section>
<section id="weighted-regression" class="level2">
<h2 class="anchored" data-anchor-id="weighted-regression">Weighted regression</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T20:06:17.605717Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T20:06:17.603966Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T20:06:17.681922Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T20:06:17.679766Z&quot;}" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="13">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>house<span class="sc">$</span>Year <span class="ot">=</span> <span class="fu">year</span>(house<span class="sc">$</span>DocumentDate)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>house<span class="sc">$</span>Weight <span class="ot">=</span> house<span class="sc">$</span>Year <span class="sc">-</span> <span class="dv">2005</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>house_wt <span class="ot">&lt;-</span> <span class="fu">lm</span>(AdjSalePrice <span class="sc">~</span> SqFtTotLiving <span class="sc">+</span> SqFtLot <span class="sc">+</span> Bathrooms <span class="sc">+</span> </span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>                 Bedrooms <span class="sc">+</span> BldgGrade,</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">data=</span>house, <span class="at">weight=</span>Weight, <span class="at">na.action=</span>na.omit)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">cbind</span>(<span class="at">house_lm=</span>house_lm<span class="sc">$</span>coefficients, </span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">house_wt=</span>house_wt<span class="sc">$</span>coefficients), <span class="at">digits=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A matrix: 6 × 2 of type dbl</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th" scope="col">house_lm</th>
<th data-quarto-table-cell-role="th" scope="col">house_wt</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">(Intercept)</td>
<td>-521871.368</td>
<td>-584189.329</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">SqFtTotLiving</td>
<td>228.831</td>
<td>245.024</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">SqFtLot</td>
<td>-0.060</td>
<td>-0.292</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">Bathrooms</td>
<td>-19442.840</td>
<td>-26085.970</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">Bedrooms</td>
<td>-47769.955</td>
<td>-53608.876</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">BldgGrade</td>
<td>106106.963</td>
<td>115242.435</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="factor-variables-in-regression" class="level1">
<h1>Factor variables in regression</h1>
<section id="dummy-variables-representation" class="level2">
<h2 class="anchored" data-anchor-id="dummy-variables-representation">Dummy Variables Representation</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T20:06:17.686735Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T20:06:17.685015Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T20:06:17.699462Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T20:06:17.697699Z&quot;}" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="14">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(house[, <span class="st">'PropertyType'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<style>
.list-inline {list-style: none; margin:0; padding: 0}
.list-inline>li {display: inline-block}
.list-inline>li:not(:last-child)::after {content: "\00b7"; padding: 0 .5ex}
</style>
<ol class="list-inline"><li>'Multiplex'</li><li>'Single Family'</li><li>'Single Family'</li><li>'Single Family'</li><li>'Single Family'</li><li>'Townhouse'</li></ol>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T20:06:17.704023Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T20:06:17.702250Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T20:06:17.724942Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T20:06:17.723011Z&quot;}" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="15">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>prop_type_dummies <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span>PropertyType <span class="sc">-</span><span class="dv">1</span>, <span class="at">data=</span>house)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(prop_type_dummies)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A matrix: 6 × 3 of type dbl</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th" scope="col">PropertyTypeMultiplex</th>
<th data-quarto-table-cell-role="th" scope="col">PropertyTypeSingle Family</th>
<th data-quarto-table-cell-role="th" scope="col">PropertyTypeTownhouse</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">1</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">2</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">3</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">4</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">5</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th" scope="row">6</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T20:06:17.730747Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T20:06:17.728940Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T20:06:17.754961Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T20:06:17.753039Z&quot;}" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="16">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(AdjSalePrice <span class="sc">~</span> SqFtTotLiving <span class="sc">+</span> SqFtLot <span class="sc">+</span> Bathrooms <span class="sc">+</span> </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>     Bedrooms <span class="sc">+</span>  BldgGrade <span class="sc">+</span> PropertyType, <span class="at">data=</span>house)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>
Call:
lm(formula = AdjSalePrice ~ SqFtTotLiving + SqFtLot + Bathrooms + 
    Bedrooms + BldgGrade + PropertyType, data = house)

Coefficients:
              (Intercept)              SqFtTotLiving  
               -4.468e+05                  2.234e+02  
                  SqFtLot                  Bathrooms  
               -7.037e-02                 -1.598e+04  
                 Bedrooms                  BldgGrade  
               -5.089e+04                  1.094e+05  
PropertyTypeSingle Family      PropertyTypeTownhouse  
               -8.468e+04                 -1.151e+05  </code></pre>
</div>
</div>
</section>
<section id="factor-variables-with-many-levels" class="level2">
<h2 class="anchored" data-anchor-id="factor-variables-with-many-levels">Factor Variables with many levels</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T20:06:17.760281Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T20:06:17.758321Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T20:06:17.776782Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T20:06:17.775539Z&quot;}" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="17">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(house<span class="sc">$</span>ZipCode)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>
98001 98002 98003 98004 98005 98006 98007 98008 98010 98011 98014 98019 98022 
  358   180   241   293   133   460   112   291    56   163    85   242   188 
98023 98024 98027 98028 98029 98030 98031 98032 98033 98034 98038 98039 98040 
  455    31   366   252   475   263   308   121   517   575   788    47   244 
98042 98043 98045 98047 98050 98051 98052 98053 98055 98056 98057 98058 98059 
  641     1   222    48     7    32   614   499   332   402     4   420   513 
98065 98068 98070 98072 98074 98075 98077 98092 98102 98103 98105 98106 98107 
  430     1    89   245   502   388   204   289   106   671   313   361   296 
98108 98109 98112 98113 98115 98116 98117 98118 98119 98122 98125 98126 98133 
  155   149   357     1   620   364   619   492   260   380   409   473   465 
98136 98144 98146 98148 98155 98166 98168 98177 98178 98188 98198 98199 98224 
  310   332   287    40   358   193   332   216   266   101   225   393     3 
98288 98354 
    4     9 </code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T20:06:17.782208Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T20:06:17.780550Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T20:06:17.823796Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T20:06:17.821626Z&quot;}" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="18">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>zip_groups <span class="ot">&lt;-</span> house <span class="sc">%&gt;%</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">resid =</span> <span class="fu">residuals</span>(house_lm)) <span class="sc">%&gt;%</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ZipCode) <span class="sc">%&gt;%</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">med_resid =</span> <span class="fu">median</span>(resid),</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">cnt =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sort the zip codes by the median residual</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(med_resid) <span class="sc">%&gt;%</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cum_cnt =</span> <span class="fu">cumsum</span>(cnt),</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">ZipGroup =</span> <span class="fu">factor</span>(<span class="fu">ntile</span>(cum_cnt, <span class="dv">5</span>)))</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>house <span class="ot">&lt;-</span> house <span class="sc">%&gt;%</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">select</span>(zip_groups, ZipCode, ZipGroup), <span class="at">by=</span><span class="st">'ZipCode'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T20:06:17.828734Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T20:06:17.826987Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T20:06:17.841894Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T20:06:17.839817Z&quot;}" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="19">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(zip_groups[<span class="fu">c</span>(<span class="st">'ZipGroup'</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>
 1  2  3  4  5 
16 16 16 16 16 </code></pre>
</div>
</div>
</section>
</section>
<section id="interpreting-the-regression-equation" class="level1">
<h1>Interpreting the Regression Equation</h1>
<section id="correlated-predictors" class="level2">
<h2 class="anchored" data-anchor-id="correlated-predictors">Correlated predictors</h2>
<p>The results from the stepwise regression are.</p>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T20:06:17.847016Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T20:06:17.845295Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T20:06:17.859697Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T20:06:17.857572Z&quot;}" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="20">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>step_lm<span class="sc">$</span>coefficients</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<style>
.dl-inline {width: auto; margin:0; padding: 0}
.dl-inline>dt, .dl-inline>dd {float: none; width: auto; display: inline-block}
.dl-inline>dt::after {content: ":\0020"; padding-right: .5ex}
.dl-inline>dt:not(:first-of-type) {padding-left: .5ex}
</style><dl class="dl-inline"><dt>(Intercept)</dt><dd>6178645.01703279</dd><dt>SqFtTotLiving</dt><dd>199.277553042012</dd><dt>Bathrooms</dt><dd>42396.16452772</dd><dt>Bedrooms</dt><dd>-51947.3836736137</dd><dt>BldgGrade</dt><dd>137159.560226199</dd><dt>PropertyTypeSingle Family</dt><dd>22912.0551870182</dd><dt>PropertyTypeTownhouse</dt><dd>84479.1620329981</dd><dt>SqFtFinBasement</dt><dd>7.04697496756521</dd><dt>YrBuilt</dt><dd>-3565.42493924941</dd></dl>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T20:06:17.863681Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T20:06:17.862756Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T20:06:17.997023Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T20:06:17.995804Z&quot;}" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="21">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">update</span>(step_lm, . <span class="sc">~</span> . <span class="sc">-</span>SqFtTotLiving <span class="sc">-</span> SqFtFinBasement <span class="sc">-</span> Bathrooms)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>
Call:
lm(formula = AdjSalePrice ~ Bedrooms + BldgGrade + PropertyType + 
    YrBuilt, data = house, na.action = na.omit)

Coefficients:
              (Intercept)                   Bedrooms  
                  4913973                      27151  
                BldgGrade  PropertyTypeSingle Family  
                   248998                     -19898  
    PropertyTypeTownhouse                    YrBuilt  
                   -47355                      -3212  </code></pre>
</div>
</div>
</section>
<section id="confounding-variables" class="level2">
<h2 class="anchored" data-anchor-id="confounding-variables">Confounding variables</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T20:06:18.002167Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T20:06:18.001046Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T20:06:18.024792Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T20:06:18.022531Z&quot;}" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="22">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(AdjSalePrice <span class="sc">~</span>  SqFtTotLiving <span class="sc">+</span> SqFtLot <span class="sc">+</span> </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>     Bathrooms <span class="sc">+</span> Bedrooms <span class="sc">+</span> </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>     BldgGrade <span class="sc">+</span> PropertyType <span class="sc">+</span> ZipGroup,</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>   <span class="at">data=</span>house, <span class="at">na.action=</span>na.omit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>
Call:
lm(formula = AdjSalePrice ~ SqFtTotLiving + SqFtLot + Bathrooms + 
    Bedrooms + BldgGrade + PropertyType + ZipGroup, data = house, 
    na.action = na.omit)

Coefficients:
              (Intercept)              SqFtTotLiving  
               -6.666e+05                  2.106e+02  
                  SqFtLot                  Bathrooms  
                4.550e-01                  5.928e+03  
                 Bedrooms                  BldgGrade  
               -4.168e+04                  9.854e+04  
PropertyTypeSingle Family      PropertyTypeTownhouse  
                1.932e+04                 -7.820e+04  
                ZipGroup2                  ZipGroup3  
                5.332e+04                  1.163e+05  
                ZipGroup4                  ZipGroup5  
                1.784e+05                  3.384e+05  </code></pre>
</div>
</div>
</section>
<section id="interactions-and-main-effects" class="level2">
<h2 class="anchored" data-anchor-id="interactions-and-main-effects">Interactions and Main Effects</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T20:06:18.029696Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T20:06:18.028450Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T20:06:18.053764Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T20:06:18.051806Z&quot;}" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="23">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(AdjSalePrice <span class="sc">~</span>  SqFtTotLiving<span class="sc">*</span>ZipGroup <span class="sc">+</span> SqFtLot <span class="sc">+</span> </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>     Bathrooms <span class="sc">+</span> Bedrooms <span class="sc">+</span> </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>     BldgGrade <span class="sc">+</span> PropertyType,</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>   <span class="at">data=</span>house, <span class="at">na.action=</span>na.omit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>
Call:
lm(formula = AdjSalePrice ~ SqFtTotLiving * ZipGroup + SqFtLot + 
    Bathrooms + Bedrooms + BldgGrade + PropertyType, data = house, 
    na.action = na.omit)

Coefficients:
              (Intercept)              SqFtTotLiving  
               -4.853e+05                  1.148e+02  
                ZipGroup2                  ZipGroup3  
               -1.113e+04                  2.032e+04  
                ZipGroup4                  ZipGroup5  
                2.050e+04                 -1.499e+05  
                  SqFtLot                  Bathrooms  
                6.869e-01                 -3.619e+03  
                 Bedrooms                  BldgGrade  
               -4.180e+04                  1.047e+05  
PropertyTypeSingle Family      PropertyTypeTownhouse  
                1.357e+04                 -5.884e+04  
  SqFtTotLiving:ZipGroup2    SqFtTotLiving:ZipGroup3  
                3.260e+01                  4.178e+01  
  SqFtTotLiving:ZipGroup4    SqFtTotLiving:ZipGroup5  
                6.934e+01                  2.267e+02  </code></pre>
</div>
</div>
</section>
</section>
<section id="testing-the-assumptions-regression-diagnostics" class="level1">
<h1>Testing the Assumptions: Regression Diagnostics</h1>
<section id="outliers" class="level2">
<h2 class="anchored" data-anchor-id="outliers">Outliers</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T20:06:18.058777Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T20:06:18.056941Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T20:06:18.071477Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T20:06:18.069515Z&quot;}" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="24">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>house_98105 <span class="ot">&lt;-</span> house[house<span class="sc">$</span>ZipCode <span class="sc">==</span> <span class="dv">98105</span>,]</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>lm_98105 <span class="ot">&lt;-</span> <span class="fu">lm</span>(AdjSalePrice <span class="sc">~</span> SqFtTotLiving <span class="sc">+</span> SqFtLot <span class="sc">+</span> Bathrooms <span class="sc">+</span> </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>                 Bedrooms <span class="sc">+</span> BldgGrade, <span class="at">data=</span>house_98105)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T20:06:18.076463Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T20:06:18.074536Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T20:06:18.089765Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T20:06:18.087899Z&quot;}" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="25">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm_98105)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>
Call:
lm(formula = AdjSalePrice ~ SqFtTotLiving + SqFtLot + Bathrooms + 
    Bedrooms + BldgGrade, data = house_98105)

Residuals:
    Min      1Q  Median      3Q     Max 
-757754  -91807   -9668   77586  953911 

Coefficients:
                Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   -772549.86   98277.27  -7.861 6.51e-14 ***
SqFtTotLiving     209.60      24.41   8.587 4.54e-16 ***
SqFtLot            38.93       5.33   7.305 2.41e-12 ***
Bathrooms        2282.26   19983.57   0.114   0.9091    
Bedrooms       -26320.27   12881.09  -2.043   0.0419 *  
BldgGrade      130000.10   15234.12   8.533 6.63e-16 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 178500 on 307 degrees of freedom
Multiple R-squared:  0.7954,    Adjusted R-squared:  0.7921 
F-statistic: 238.7 on 5 and 307 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T20:06:18.094478Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T20:06:18.092612Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T20:06:18.115254Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T20:06:18.113258Z&quot;}" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="26">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>sresid <span class="ot">&lt;-</span> <span class="fu">rstandard</span>(lm_98105)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>idx <span class="ot">&lt;-</span> <span class="fu">order</span>(sresid, <span class="at">decreasing=</span><span class="cn">FALSE</span>)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>sresid[idx[<span class="dv">1</span>]]</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="fu">resid</span>(lm_98105)[idx[<span class="dv">1</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<strong>20429:</strong> -4.32673180407856
</div>
<div class="cell-output cell-output-display">
<strong>20429:</strong> -757753.619211582
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T20:06:18.119758Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T20:06:18.118114Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T20:06:18.136609Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T20:06:18.134621Z&quot;}" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="27">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>house_98105[idx[<span class="dv">1</span>], <span class="fu">c</span>(<span class="st">'AdjSalePrice'</span>, <span class="st">'SqFtTotLiving'</span>, <span class="st">'SqFtLot'</span>,</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>                      <span class="st">'Bathrooms'</span>, <span class="st">'Bedrooms'</span>, <span class="st">'BldgGrade'</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true">
<caption>A data.frame: 1 × 6</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th" scope="col">AdjSalePrice</th>
<th data-quarto-table-cell-role="th" scope="col">SqFtTotLiving</th>
<th data-quarto-table-cell-role="th" scope="col">SqFtLot</th>
<th data-quarto-table-cell-role="th" scope="col">Bathrooms</th>
<th data-quarto-table-cell-role="th" scope="col">Bedrooms</th>
<th data-quarto-table-cell-role="th" scope="col">BldgGrade</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;dbl&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
<th data-quarto-table-cell-role="th" scope="col">&lt;int&gt;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th" scope="row">20429</td>
<td>119748</td>
<td>2900</td>
<td>7276</td>
<td>3</td>
<td>6</td>
<td>7</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="influential-values" class="level2">
<h2 class="anchored" data-anchor-id="influential-values">Influential values</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T20:06:18.141444Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T20:06:18.139765Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T20:06:18.217603Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T20:06:18.213578Z&quot;}" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="28">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>seed <span class="ot">&lt;-</span> <span class="dv">11</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(seed)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">25</span>)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="sc">-</span>x<span class="sc">/</span><span class="dv">5</span> <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">25</span>)</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>x[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">8</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>y[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">8</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, y, <span class="at">xlab=</span><span class="st">''</span>, <span class="at">ylab=</span><span class="st">''</span>, <span class="at">pch=</span><span class="dv">16</span>)</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(y<span class="sc">~</span>x)</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a=</span>model<span class="sc">$</span>coefficients[<span class="dv">1</span>], <span class="at">b=</span>model<span class="sc">$</span>coefficients[<span class="dv">2</span>], <span class="at">col=</span><span class="st">"blue"</span>, <span class="at">lwd=</span><span class="dv">3</span>)</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(y[<span class="sc">-</span><span class="dv">1</span>]<span class="sc">~</span>x[<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a=</span>model<span class="sc">$</span>coefficients[<span class="dv">1</span>], <span class="at">b=</span>model<span class="sc">$</span>coefficients[<span class="dv">2</span>], <span class="at">col=</span><span class="st">"red"</span>, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">lty=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Chapter4-Regression_and_Prediction_files/figure-html/cell-29-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T20:06:18.224638Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T20:06:18.223596Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T20:06:18.292604Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T20:06:18.285603Z&quot;}" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="29">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># influential observations</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>std_resid <span class="ot">&lt;-</span> <span class="fu">rstandard</span>(lm_98105)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>cooks_D <span class="ot">&lt;-</span> <span class="fu">cooks.distance</span>(lm_98105)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>hat_values <span class="ot">&lt;-</span> <span class="fu">hatvalues</span>(lm_98105)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">subset</span>(hat_values, cooks_D <span class="sc">&gt;</span> <span class="fl">0.08</span>), <span class="fu">subset</span>(std_resid, cooks_D <span class="sc">&gt;</span> <span class="fl">0.08</span>), </span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">'hat_values'</span>, <span class="at">ylab=</span><span class="st">'std_resid'</span>,</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex=</span><span class="dv">10</span><span class="sc">*</span><span class="fu">sqrt</span>(<span class="fu">subset</span>(cooks_D, cooks_D <span class="sc">&gt;</span> <span class="fl">0.08</span>)), <span class="at">pch=</span><span class="dv">16</span>, <span class="at">col=</span><span class="st">'lightgrey'</span>)</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(hat_values, std_resid, <span class="at">cex=</span><span class="dv">10</span><span class="sc">*</span><span class="fu">sqrt</span>(cooks_D))</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">2.5</span>, <span class="fl">2.5</span>), <span class="at">lty=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Chapter4-Regression_and_Prediction_files/figure-html/cell-30-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T20:06:18.297278Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T20:06:18.296061Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T20:06:18.310516Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T20:06:18.308796Z&quot;}" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="30">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>lm_98105_inf <span class="ot">&lt;-</span> <span class="fu">lm</span>(AdjSalePrice <span class="sc">~</span> SqFtTotLiving <span class="sc">+</span> SqFtLot <span class="sc">+</span> </span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>                     Bathrooms <span class="sc">+</span>  Bedrooms <span class="sc">+</span> BldgGrade,</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">subset=</span>cooks_D<span class="sc">&lt;</span>.<span class="dv">08</span>, <span class="at">data=</span>house_98105)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="heteroskedasticity-non-normality-and-correlated-errors" class="level2">
<h2 class="anchored" data-anchor-id="heteroskedasticity-non-normality-and-correlated-errors">Heteroskedasticity, Non-Normality and Correlated Errors</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T20:06:18.315593Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T20:06:18.314280Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T20:06:18.540583Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T20:06:18.539442Z&quot;}" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="31">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">resid =</span> <span class="fu">residuals</span>(lm_98105),</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">pred =</span> <span class="fu">predict</span>(lm_98105))</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>graph <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(pred, <span class="fu">abs</span>(resid))) <span class="sc">+</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">formula=</span>y<span class="sc">~</span>x, <span class="at">method=</span><span class="st">'loess'</span>) <span class="sc">+</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> <span class="cf">function</span>(x) <span class="fu">format</span>(x, <span class="at">scientific =</span> <span class="cn">FALSE</span>)) <span class="sc">+</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>graph</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Chapter4-Regression_and_Prediction_files/figure-html/cell-32-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T20:06:18.544900Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T20:06:18.543939Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T20:06:18.579201Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T20:06:18.577958Z&quot;}" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="32">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(std_resid, <span class="at">main=</span><span class="st">''</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Chapter4-Regression_and_Prediction_files/figure-html/cell-33-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="partial-residual-plots-and-nonlinearity" class="level2">
<h2 class="anchored" data-anchor-id="partial-residual-plots-and-nonlinearity">Partial Residual Plots and Nonlinearity</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T20:06:18.583009Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T20:06:18.582048Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T20:06:18.821116Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T20:06:18.820038Z&quot;}" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="33">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>terms <span class="ot">&lt;-</span> <span class="fu">predict</span>(lm_98105, <span class="at">type=</span><span class="st">'terms'</span>)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>partial_resid <span class="ot">&lt;-</span> <span class="fu">resid</span>(lm_98105) <span class="sc">+</span> terms</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">SqFtTotLiving =</span> house_98105[, <span class="st">'SqFtTotLiving'</span>],</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">Terms =</span> terms[, <span class="st">'SqFtTotLiving'</span>],</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">PartialResid =</span> partial_resid[, <span class="st">'SqFtTotLiving'</span>])</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>graph <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(SqFtTotLiving, PartialResid)) <span class="sc">+</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape=</span><span class="dv">1</span>) <span class="sc">+</span> <span class="fu">scale_shape</span>(<span class="at">solid =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">linetype=</span><span class="dv">2</span>, <span class="at">formula=</span>y<span class="sc">~</span>x, <span class="at">method=</span><span class="st">'loess'</span>) <span class="sc">+</span> </span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(SqFtTotLiving, Terms)) <span class="sc">+</span> </span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="cf">function</span>(x) <span class="fu">format</span>(x, <span class="at">scientific =</span> <span class="cn">FALSE</span>))</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>graph</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Chapter4-Regression_and_Prediction_files/figure-html/cell-34-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="polynomial-and-spline-regression" class="level2">
<h2 class="anchored" data-anchor-id="polynomial-and-spline-regression">Polynomial and Spline Regression</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T20:06:18.825383Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T20:06:18.824406Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T20:06:18.840243Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T20:06:18.839235Z&quot;}" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="34">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>lm_poly <span class="ot">&lt;-</span> <span class="fu">lm</span>(AdjSalePrice <span class="sc">~</span>  <span class="fu">poly</span>(SqFtTotLiving, <span class="dv">2</span>) <span class="sc">+</span> SqFtLot <span class="sc">+</span> </span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>                BldgGrade <span class="sc">+</span>  Bathrooms <span class="sc">+</span>  Bedrooms,</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">data=</span>house_98105)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>terms <span class="ot">&lt;-</span> <span class="fu">predict</span>(lm_poly, <span class="at">type=</span><span class="st">'terms'</span>)</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>partial_resid <span class="ot">&lt;-</span> <span class="fu">resid</span>(lm_poly) <span class="sc">+</span> terms</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>lm_poly</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>
Call:
lm(formula = AdjSalePrice ~ poly(SqFtTotLiving, 2) + SqFtLot + 
    BldgGrade + Bathrooms + Bedrooms, data = house_98105)

Coefficients:
            (Intercept)  poly(SqFtTotLiving, 2)1  poly(SqFtTotLiving, 2)2  
             -402530.47               3271519.49                776934.02  
                SqFtLot                BldgGrade                Bathrooms  
                  32.56                135717.06                 -1435.12  
               Bedrooms  
               -9191.94  </code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T20:06:18.843895Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T20:06:18.843038Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T20:06:19.022664Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T20:06:19.021319Z&quot;}" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="35">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">SqFtTotLiving =</span> house_98105[, <span class="st">'SqFtTotLiving'</span>],</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">Terms =</span> terms[, <span class="dv">1</span>],</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">PartialResid =</span> partial_resid[, <span class="dv">1</span>])</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>graph <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(SqFtTotLiving, PartialResid)) <span class="sc">+</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape=</span><span class="dv">1</span>) <span class="sc">+</span> <span class="fu">scale_shape</span>(<span class="at">solid =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">linetype=</span><span class="dv">2</span>, <span class="at">formula=</span>y<span class="sc">~</span>x, <span class="at">method=</span><span class="st">'loess'</span>) <span class="sc">+</span> </span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(SqFtTotLiving, Terms)) <span class="sc">+</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="cf">function</span>(x) <span class="fu">format</span>(x, <span class="at">scientific =</span> <span class="cn">FALSE</span>))</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>graph</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Chapter4-Regression_and_Prediction_files/figure-html/cell-36-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="splines" class="level2">
<h2 class="anchored" data-anchor-id="splines">Splines</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T20:06:19.028584Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T20:06:19.027672Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T20:06:19.049350Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T20:06:19.047888Z&quot;}" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="36">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>knots <span class="ot">&lt;-</span> <span class="fu">quantile</span>(house_98105<span class="sc">$</span>SqFtTotLiving, <span class="at">p=</span><span class="fu">c</span>(.<span class="dv">25</span>, .<span class="dv">5</span>, .<span class="dv">75</span>))</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>lm_spline <span class="ot">&lt;-</span> <span class="fu">lm</span>(AdjSalePrice <span class="sc">~</span> <span class="fu">bs</span>(SqFtTotLiving, <span class="at">knots=</span>knots, <span class="at">degree=</span><span class="dv">3</span>) <span class="sc">+</span>  SqFtLot <span class="sc">+</span>  </span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>                  Bathrooms <span class="sc">+</span> Bedrooms <span class="sc">+</span> BldgGrade,  <span class="at">data=</span>house_98105)</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>lm_spline</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>terms1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(lm_spline, <span class="at">type=</span><span class="st">'terms'</span>)</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>partial_resid1 <span class="ot">&lt;-</span> <span class="fu">resid</span>(lm_spline) <span class="sc">+</span> terms1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>
Call:
lm(formula = AdjSalePrice ~ bs(SqFtTotLiving, knots = knots, 
    degree = 3) + SqFtLot + Bathrooms + Bedrooms + BldgGrade, 
    data = house_98105)

Coefficients:
                                  (Intercept)  
                                   -414157.61  
bs(SqFtTotLiving, knots = knots, degree = 3)1  
                                   -199529.76  
bs(SqFtTotLiving, knots = knots, degree = 3)2  
                                   -120580.64  
bs(SqFtTotLiving, knots = knots, degree = 3)3  
                                    -71644.39  
bs(SqFtTotLiving, knots = knots, degree = 3)4  
                                    195677.89  
bs(SqFtTotLiving, knots = knots, degree = 3)5  
                                    845244.25  
bs(SqFtTotLiving, knots = knots, degree = 3)6  
                                    695545.67  
                                      SqFtLot  
                                        33.33  
                                    Bathrooms  
                                     -4778.21  
                                     Bedrooms  
                                     -5778.70  
                                    BldgGrade  
                                    134462.37  </code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T20:06:19.053170Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T20:06:19.052226Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T20:06:19.238722Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T20:06:19.237663Z&quot;}" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="37">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">SqFtTotLiving =</span> house_98105[, <span class="st">'SqFtTotLiving'</span>],</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">Terms =</span> terms1[, <span class="dv">1</span>],</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">PartialResid =</span> partial_resid1[, <span class="dv">1</span>])</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>graph <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df1, <span class="fu">aes</span>(SqFtTotLiving, PartialResid)) <span class="sc">+</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape=</span><span class="dv">1</span>) <span class="sc">+</span> <span class="fu">scale_shape</span>(<span class="at">solid =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">linetype=</span><span class="dv">2</span>, <span class="at">formula=</span>y<span class="sc">~</span>x, <span class="at">method=</span><span class="st">'loess'</span>) <span class="sc">+</span> </span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(SqFtTotLiving, Terms)) <span class="sc">+</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="cf">function</span>(x) <span class="fu">format</span>(x, <span class="at">scientific =</span> <span class="cn">FALSE</span>))</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>graph</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Chapter4-Regression_and_Prediction_files/figure-html/cell-38-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="generalized-additive-models" class="level2">
<h2 class="anchored" data-anchor-id="generalized-additive-models">Generalized Additive Models</h2>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T20:06:19.243362Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T20:06:19.241957Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T20:06:19.300351Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T20:06:19.298822Z&quot;}" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="38">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>lm_gam <span class="ot">&lt;-</span> <span class="fu">gam</span>(AdjSalePrice <span class="sc">~</span> <span class="fu">s</span>(SqFtTotLiving) <span class="sc">+</span> SqFtLot <span class="sc">+</span> </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>              Bathrooms <span class="sc">+</span>  Bedrooms <span class="sc">+</span> BldgGrade, </span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">data=</span>house_98105)</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>terms <span class="ot">&lt;-</span> <span class="fu">predict.gam</span>(lm_gam, <span class="at">type=</span><span class="st">'terms'</span>)</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>partial_resid <span class="ot">&lt;-</span> <span class="fu">resid</span>(lm_gam) <span class="sc">+</span> terms</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>lm_gam</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>
Family: gaussian 
Link function: identity 

Formula:
AdjSalePrice ~ s(SqFtTotLiving) + SqFtLot + Bathrooms + Bedrooms + 
    BldgGrade

Estimated degrees of freedom:
4.49  total = 9.49 

GCV score: 30148051324     </code></pre>
</div>
</div>
<div class="cell" data-execution="{&quot;iopub.execute_input&quot;:&quot;2022-04-26T20:06:19.304141Z&quot;,&quot;iopub.status.busy&quot;:&quot;2022-04-26T20:06:19.303029Z&quot;,&quot;iopub.status.idle&quot;:&quot;2022-04-26T20:06:19.487935Z&quot;,&quot;shell.execute_reply&quot;:&quot;2022-04-26T20:06:19.486878Z&quot;}" data-vscode="{&quot;languageId&quot;:&quot;r&quot;}" data-execution_count="39">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">SqFtTotLiving =</span> house_98105[, <span class="st">'SqFtTotLiving'</span>],</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">Terms =</span> terms[, <span class="dv">5</span>],</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">PartialResid =</span> partial_resid[, <span class="dv">5</span>])</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>graph <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(SqFtTotLiving, PartialResid)) <span class="sc">+</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape=</span><span class="dv">1</span>) <span class="sc">+</span> <span class="fu">scale_shape</span>(<span class="at">solid =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">linetype=</span><span class="dv">2</span>, <span class="at">formula=</span>y<span class="sc">~</span>x, <span class="at">method=</span><span class="st">'loess'</span>) <span class="sc">+</span> </span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(SqFtTotLiving, Terms)) <span class="sc">+</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="cf">function</span>(x) <span class="fu">format</span>(x, <span class="at">scientific =</span> <span class="cn">FALSE</span>))</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>graph</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Chapter4-Regression_and_Prediction_files/figure-html/cell-40-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>